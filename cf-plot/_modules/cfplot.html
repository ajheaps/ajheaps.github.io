<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>cfplot &mdash; cf-plot 2.1.12 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.1.12',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="cf-plot 2.1.12 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">cf-plot 2.1.12 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for cfplot</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Routines for making climate contour/vector plots using cf-python, matplotlib</span>
<span class="sd">and basemap.</span>
<span class="sd">Andy Heaps NCAS-CMS January 2017</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plot</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span><span class="p">,</span> <span class="n">shiftgrid</span><span class="p">,</span> <span class="n">addcyclic</span>


<span class="k">class</span> <span class="nc">pvars</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Initialize a new Pvars instance&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;x.__str__() &lt;==&gt; str(x)&#39;&#39;&#39;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

<span class="n">cf_version_min</span> <span class="o">=</span> <span class="s1">&#39;1.0.1&#39;</span>
<span class="n">cf_errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> cf-python &gt; &#39;</span> <span class="o">+</span> <span class="n">cf_version_min</span> <span class="o">+</span> \
    <span class="s1">&#39; needs to be installed to use cf-plot </span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cf</span>
    <span class="k">if</span> <span class="n">cf</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&lt;</span> <span class="n">cf_version_min</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">cf_errstr</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">cf_errstr</span><span class="p">)</span>


<span class="c1"># Check for a display and use the Agg backing store if none is present</span>
<span class="c1"># This is for batch mode processing</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">disp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DISPLAY&quot;</span><span class="p">]</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>


<span class="c1"># Code to check if the ImageMagick display command is available</span>
<span class="k">def</span> <span class="nf">which</span><span class="p">(</span><span class="n">program</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">is_exe</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ext_candidates</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">fpath</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PATHEXT&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">fpath</span> <span class="o">+</span> <span class="n">ext</span>

    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PATH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
        <span class="n">exe_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">program</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">ext_candidates</span><span class="p">(</span><span class="n">exe_file</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">is_exe</span><span class="p">(</span><span class="n">candidate</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">candidate</span>

    <span class="k">return</span> <span class="bp">None</span>


<span class="c1"># Default colour scales</span>
<span class="c1"># cscale1 is a differential data scale - blue to red</span>
<span class="n">cscale1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#0a3278&#39;</span><span class="p">,</span> <span class="s1">&#39;#0f4ba5&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e6ec8&#39;</span><span class="p">,</span> <span class="s1">&#39;#3ca0f0&#39;</span><span class="p">,</span> <span class="s1">&#39;#50b4fa&#39;</span><span class="p">,</span> <span class="s1">&#39;#82d2ff&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#a0f0ff&#39;</span><span class="p">,</span> <span class="s1">&#39;#c8faff&#39;</span><span class="p">,</span> <span class="s1">&#39;#e6ffff&#39;</span><span class="p">,</span> <span class="s1">&#39;#fffadc&#39;</span><span class="p">,</span> <span class="s1">&#39;#ffe878&#39;</span><span class="p">,</span> <span class="s1">&#39;#ffc03c&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#ffa000&#39;</span><span class="p">,</span> <span class="s1">&#39;#ff6000&#39;</span><span class="p">,</span> <span class="s1">&#39;#ff3200&#39;</span><span class="p">,</span> <span class="s1">&#39;#e11400&#39;</span><span class="p">,</span> <span class="s1">&#39;#c00000&#39;</span><span class="p">,</span> <span class="s1">&#39;#a50000&#39;</span><span class="p">]</span>

<span class="c1"># viridis is a continuous data scale - blue, green, yellow</span>
<span class="n">viridis</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#440154&#39;</span><span class="p">,</span> <span class="s1">&#39;#440255&#39;</span><span class="p">,</span> <span class="s1">&#39;#440357&#39;</span><span class="p">,</span> <span class="s1">&#39;#450558&#39;</span><span class="p">,</span> <span class="s1">&#39;#45065a&#39;</span><span class="p">,</span> <span class="s1">&#39;#45085b&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#46095c&#39;</span><span class="p">,</span> <span class="s1">&#39;#460b5e&#39;</span><span class="p">,</span> <span class="s1">&#39;#460c5f&#39;</span><span class="p">,</span> <span class="s1">&#39;#460e61&#39;</span><span class="p">,</span> <span class="s1">&#39;#470f62&#39;</span><span class="p">,</span> <span class="s1">&#39;#471163&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#471265&#39;</span><span class="p">,</span> <span class="s1">&#39;#471466&#39;</span><span class="p">,</span> <span class="s1">&#39;#471567&#39;</span><span class="p">,</span> <span class="s1">&#39;#471669&#39;</span><span class="p">,</span> <span class="s1">&#39;#47186a&#39;</span><span class="p">,</span> <span class="s1">&#39;#48196b&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#481a6c&#39;</span><span class="p">,</span> <span class="s1">&#39;#481c6e&#39;</span><span class="p">,</span> <span class="s1">&#39;#481d6f&#39;</span><span class="p">,</span> <span class="s1">&#39;#481e70&#39;</span><span class="p">,</span> <span class="s1">&#39;#482071&#39;</span><span class="p">,</span> <span class="s1">&#39;#482172&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#482273&#39;</span><span class="p">,</span> <span class="s1">&#39;#482374&#39;</span><span class="p">,</span> <span class="s1">&#39;#472575&#39;</span><span class="p">,</span> <span class="s1">&#39;#472676&#39;</span><span class="p">,</span> <span class="s1">&#39;#472777&#39;</span><span class="p">,</span> <span class="s1">&#39;#472878&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#472a79&#39;</span><span class="p">,</span> <span class="s1">&#39;#472b7a&#39;</span><span class="p">,</span> <span class="s1">&#39;#472c7b&#39;</span><span class="p">,</span> <span class="s1">&#39;#462d7c&#39;</span><span class="p">,</span> <span class="s1">&#39;#462f7c&#39;</span><span class="p">,</span> <span class="s1">&#39;#46307d&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#46317e&#39;</span><span class="p">,</span> <span class="s1">&#39;#45327f&#39;</span><span class="p">,</span> <span class="s1">&#39;#45347f&#39;</span><span class="p">,</span> <span class="s1">&#39;#453580&#39;</span><span class="p">,</span> <span class="s1">&#39;#453681&#39;</span><span class="p">,</span> <span class="s1">&#39;#443781&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#443982&#39;</span><span class="p">,</span> <span class="s1">&#39;#433a83&#39;</span><span class="p">,</span> <span class="s1">&#39;#433b83&#39;</span><span class="p">,</span> <span class="s1">&#39;#433c84&#39;</span><span class="p">,</span> <span class="s1">&#39;#423d84&#39;</span><span class="p">,</span> <span class="s1">&#39;#423e85&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#424085&#39;</span><span class="p">,</span> <span class="s1">&#39;#414186&#39;</span><span class="p">,</span> <span class="s1">&#39;#414286&#39;</span><span class="p">,</span> <span class="s1">&#39;#404387&#39;</span><span class="p">,</span> <span class="s1">&#39;#404487&#39;</span><span class="p">,</span> <span class="s1">&#39;#3f4587&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#3f4788&#39;</span><span class="p">,</span> <span class="s1">&#39;#3e4888&#39;</span><span class="p">,</span> <span class="s1">&#39;#3e4989&#39;</span><span class="p">,</span> <span class="s1">&#39;#3d4a89&#39;</span><span class="p">,</span> <span class="s1">&#39;#3d4b89&#39;</span><span class="p">,</span> <span class="s1">&#39;#3d4c89&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#3c4d8a&#39;</span><span class="p">,</span> <span class="s1">&#39;#3c4e8a&#39;</span><span class="p">,</span> <span class="s1">&#39;#3b508a&#39;</span><span class="p">,</span> <span class="s1">&#39;#3b518a&#39;</span><span class="p">,</span> <span class="s1">&#39;#3a528b&#39;</span><span class="p">,</span> <span class="s1">&#39;#3a538b&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#39548b&#39;</span><span class="p">,</span> <span class="s1">&#39;#39558b&#39;</span><span class="p">,</span> <span class="s1">&#39;#38568b&#39;</span><span class="p">,</span> <span class="s1">&#39;#38578c&#39;</span><span class="p">,</span> <span class="s1">&#39;#37588c&#39;</span><span class="p">,</span> <span class="s1">&#39;#37598c&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#365a8c&#39;</span><span class="p">,</span> <span class="s1">&#39;#365b8c&#39;</span><span class="p">,</span> <span class="s1">&#39;#355c8c&#39;</span><span class="p">,</span> <span class="s1">&#39;#355d8c&#39;</span><span class="p">,</span> <span class="s1">&#39;#345e8d&#39;</span><span class="p">,</span> <span class="s1">&#39;#345f8d&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#33608d&#39;</span><span class="p">,</span> <span class="s1">&#39;#33618d&#39;</span><span class="p">,</span> <span class="s1">&#39;#32628d&#39;</span><span class="p">,</span> <span class="s1">&#39;#32638d&#39;</span><span class="p">,</span> <span class="s1">&#39;#31648d&#39;</span><span class="p">,</span> <span class="s1">&#39;#31658d&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#31668d&#39;</span><span class="p">,</span> <span class="s1">&#39;#30678d&#39;</span><span class="p">,</span> <span class="s1">&#39;#30688d&#39;</span><span class="p">,</span> <span class="s1">&#39;#2f698d&#39;</span><span class="p">,</span> <span class="s1">&#39;#2f6a8d&#39;</span><span class="p">,</span> <span class="s1">&#39;#2e6b8e&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#2e6c8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2e6d8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2d6e8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2d6f8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2c708e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2c718e&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#2c728e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2b738e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2b748e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2a758e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2a768e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2a778e&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#29788e&#39;</span><span class="p">,</span> <span class="s1">&#39;#29798e&#39;</span><span class="p">,</span> <span class="s1">&#39;#287a8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#287a8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#287b8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#277c8e&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#277d8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#277e8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#267f8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#26808e&#39;</span><span class="p">,</span> <span class="s1">&#39;#26818e&#39;</span><span class="p">,</span> <span class="s1">&#39;#25828e&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#25838d&#39;</span><span class="p">,</span> <span class="s1">&#39;#24848d&#39;</span><span class="p">,</span> <span class="s1">&#39;#24858d&#39;</span><span class="p">,</span> <span class="s1">&#39;#24868d&#39;</span><span class="p">,</span> <span class="s1">&#39;#23878d&#39;</span><span class="p">,</span> <span class="s1">&#39;#23888d&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#23898d&#39;</span><span class="p">,</span> <span class="s1">&#39;#22898d&#39;</span><span class="p">,</span> <span class="s1">&#39;#228a8d&#39;</span><span class="p">,</span> <span class="s1">&#39;#228b8d&#39;</span><span class="p">,</span> <span class="s1">&#39;#218c8d&#39;</span><span class="p">,</span> <span class="s1">&#39;#218d8c&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#218e8c&#39;</span><span class="p">,</span> <span class="s1">&#39;#208f8c&#39;</span><span class="p">,</span> <span class="s1">&#39;#20908c&#39;</span><span class="p">,</span> <span class="s1">&#39;#20918c&#39;</span><span class="p">,</span> <span class="s1">&#39;#1f928c&#39;</span><span class="p">,</span> <span class="s1">&#39;#1f938b&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#1f948b&#39;</span><span class="p">,</span> <span class="s1">&#39;#1f958b&#39;</span><span class="p">,</span> <span class="s1">&#39;#1f968b&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e978a&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e988a&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e998a&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#1e998a&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e9a89&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e9b89&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e9c89&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e9d88&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e9e88&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#1e9f88&#39;</span><span class="p">,</span> <span class="s1">&#39;#1ea087&#39;</span><span class="p">,</span> <span class="s1">&#39;#1fa187&#39;</span><span class="p">,</span> <span class="s1">&#39;#1fa286&#39;</span><span class="p">,</span> <span class="s1">&#39;#1fa386&#39;</span><span class="p">,</span> <span class="s1">&#39;#20a485&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#20a585&#39;</span><span class="p">,</span> <span class="s1">&#39;#21a685&#39;</span><span class="p">,</span> <span class="s1">&#39;#21a784&#39;</span><span class="p">,</span> <span class="s1">&#39;#22a784&#39;</span><span class="p">,</span> <span class="s1">&#39;#23a883&#39;</span><span class="p">,</span> <span class="s1">&#39;#23a982&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#24aa82&#39;</span><span class="p">,</span> <span class="s1">&#39;#25ab81&#39;</span><span class="p">,</span> <span class="s1">&#39;#26ac81&#39;</span><span class="p">,</span> <span class="s1">&#39;#27ad80&#39;</span><span class="p">,</span> <span class="s1">&#39;#28ae7f&#39;</span><span class="p">,</span> <span class="s1">&#39;#29af7f&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#2ab07e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2bb17d&#39;</span><span class="p">,</span> <span class="s1">&#39;#2cb17d&#39;</span><span class="p">,</span> <span class="s1">&#39;#2eb27c&#39;</span><span class="p">,</span> <span class="s1">&#39;#2fb37b&#39;</span><span class="p">,</span> <span class="s1">&#39;#30b47a&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#32b57a&#39;</span><span class="p">,</span> <span class="s1">&#39;#33b679&#39;</span><span class="p">,</span> <span class="s1">&#39;#35b778&#39;</span><span class="p">,</span> <span class="s1">&#39;#36b877&#39;</span><span class="p">,</span> <span class="s1">&#39;#38b976&#39;</span><span class="p">,</span> <span class="s1">&#39;#39b976&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#3bba75&#39;</span><span class="p">,</span> <span class="s1">&#39;#3dbb74&#39;</span><span class="p">,</span> <span class="s1">&#39;#3ebc73&#39;</span><span class="p">,</span> <span class="s1">&#39;#40bd72&#39;</span><span class="p">,</span> <span class="s1">&#39;#42be71&#39;</span><span class="p">,</span> <span class="s1">&#39;#44be70&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#45bf6f&#39;</span><span class="p">,</span> <span class="s1">&#39;#47c06e&#39;</span><span class="p">,</span> <span class="s1">&#39;#49c16d&#39;</span><span class="p">,</span> <span class="s1">&#39;#4bc26c&#39;</span><span class="p">,</span> <span class="s1">&#39;#4dc26b&#39;</span><span class="p">,</span> <span class="s1">&#39;#4fc369&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#51c468&#39;</span><span class="p">,</span> <span class="s1">&#39;#53c567&#39;</span><span class="p">,</span> <span class="s1">&#39;#55c666&#39;</span><span class="p">,</span> <span class="s1">&#39;#57c665&#39;</span><span class="p">,</span> <span class="s1">&#39;#59c764&#39;</span><span class="p">,</span> <span class="s1">&#39;#5bc862&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#5ec961&#39;</span><span class="p">,</span> <span class="s1">&#39;#60c960&#39;</span><span class="p">,</span> <span class="s1">&#39;#62ca5f&#39;</span><span class="p">,</span> <span class="s1">&#39;#64cb5d&#39;</span><span class="p">,</span> <span class="s1">&#39;#67cc5c&#39;</span><span class="p">,</span> <span class="s1">&#39;#69cc5b&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#6bcd59&#39;</span><span class="p">,</span> <span class="s1">&#39;#6dce58&#39;</span><span class="p">,</span> <span class="s1">&#39;#70ce56&#39;</span><span class="p">,</span> <span class="s1">&#39;#72cf55&#39;</span><span class="p">,</span> <span class="s1">&#39;#74d054&#39;</span><span class="p">,</span> <span class="s1">&#39;#77d052&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#79d151&#39;</span><span class="p">,</span> <span class="s1">&#39;#7cd24f&#39;</span><span class="p">,</span> <span class="s1">&#39;#7ed24e&#39;</span><span class="p">,</span> <span class="s1">&#39;#81d34c&#39;</span><span class="p">,</span> <span class="s1">&#39;#83d34b&#39;</span><span class="p">,</span> <span class="s1">&#39;#86d449&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#88d547&#39;</span><span class="p">,</span> <span class="s1">&#39;#8bd546&#39;</span><span class="p">,</span> <span class="s1">&#39;#8dd644&#39;</span><span class="p">,</span> <span class="s1">&#39;#90d643&#39;</span><span class="p">,</span> <span class="s1">&#39;#92d741&#39;</span><span class="p">,</span> <span class="s1">&#39;#95d73f&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#97d83e&#39;</span><span class="p">,</span> <span class="s1">&#39;#9ad83c&#39;</span><span class="p">,</span> <span class="s1">&#39;#9dd93a&#39;</span><span class="p">,</span> <span class="s1">&#39;#9fd938&#39;</span><span class="p">,</span> <span class="s1">&#39;#a2da37&#39;</span><span class="p">,</span> <span class="s1">&#39;#a5da35&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#a7db33&#39;</span><span class="p">,</span> <span class="s1">&#39;#aadb32&#39;</span><span class="p">,</span> <span class="s1">&#39;#addc30&#39;</span><span class="p">,</span> <span class="s1">&#39;#afdc2e&#39;</span><span class="p">,</span> <span class="s1">&#39;#b2dd2c&#39;</span><span class="p">,</span> <span class="s1">&#39;#b5dd2b&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#b7dd29&#39;</span><span class="p">,</span> <span class="s1">&#39;#bade27&#39;</span><span class="p">,</span> <span class="s1">&#39;#bdde26&#39;</span><span class="p">,</span> <span class="s1">&#39;#bfdf24&#39;</span><span class="p">,</span> <span class="s1">&#39;#c2df22&#39;</span><span class="p">,</span> <span class="s1">&#39;#c5df21&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#c7e01f&#39;</span><span class="p">,</span> <span class="s1">&#39;#cae01e&#39;</span><span class="p">,</span> <span class="s1">&#39;#cde01d&#39;</span><span class="p">,</span> <span class="s1">&#39;#cfe11c&#39;</span><span class="p">,</span> <span class="s1">&#39;#d2e11b&#39;</span><span class="p">,</span> <span class="s1">&#39;#d4e11a&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#d7e219&#39;</span><span class="p">,</span> <span class="s1">&#39;#dae218&#39;</span><span class="p">,</span> <span class="s1">&#39;#dce218&#39;</span><span class="p">,</span> <span class="s1">&#39;#dfe318&#39;</span><span class="p">,</span> <span class="s1">&#39;#e1e318&#39;</span><span class="p">,</span> <span class="s1">&#39;#e4e318&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#e7e419&#39;</span><span class="p">,</span> <span class="s1">&#39;#e9e419&#39;</span><span class="p">,</span> <span class="s1">&#39;#ece41a&#39;</span><span class="p">,</span> <span class="s1">&#39;#eee51b&#39;</span><span class="p">,</span> <span class="s1">&#39;#f1e51c&#39;</span><span class="p">,</span> <span class="s1">&#39;#f3e51e&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#f6e61f&#39;</span><span class="p">,</span> <span class="s1">&#39;#f8e621&#39;</span><span class="p">,</span> <span class="s1">&#39;#fae622&#39;</span><span class="p">,</span> <span class="s1">&#39;#fde724&#39;</span><span class="p">]</span>


<span class="c1">#####################################</span>
<span class="c1"># plotvars - global plotting variables</span>
<span class="c1">#####################################</span>
<span class="n">plotvars</span> <span class="o">=</span> <span class="n">pvars</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=-</span><span class="mi">180</span><span class="p">,</span> <span class="n">lonmax</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">latmin</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">latmax</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;cyl&#39;</span><span class="p">,</span>
                 <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">boundinglat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">lat_0</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">lat_1</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">lat_2</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span> <span class="n">lcc_width</span><span class="o">=</span><span class="mi">12000000</span><span class="p">,</span>
                 <span class="n">lcc_height</span><span class="o">=</span><span class="mi">900000</span><span class="p">,</span> <span class="n">lcc_plimits</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">levels_min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">levels_max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">levels_step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">norm</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">levels_extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">xmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;landscape&#39;</span><span class="p">,</span>
                 <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cscale_flag</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">user_levs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">master_plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cs</span><span class="o">=</span><span class="n">cscale1</span><span class="p">,</span>
                 <span class="n">cs_user</span><span class="o">=</span><span class="s1">&#39;cscale1&#39;</span><span class="p">,</span> <span class="n">mymap</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">xticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xstep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ystep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                 <span class="n">axis_label_fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">text_fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
                 <span class="n">text_fontweight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">axis_label_fontweight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span>
                 <span class="n">title_fontweight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">continent_thickness</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">continent_color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">viewer</span><span class="o">=</span><span class="s1">&#39;display&#39;</span><span class="p">,</span>
                 <span class="n">tspace_year</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tspace_month</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tspace_day</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">tspace_hour</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xtick_label_rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">xtick_label_align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ytick_label_rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">ytick_label_align</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">legend_text_size</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
                 <span class="n">legend_text_weight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">cs_uniform</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<div class="viewcode-block" id="con"><a class="viewcode-back" href="../con.html#cfplot.con">[docs]</a><span class="k">def</span> <span class="nf">con</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">line_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">colorbar_label_skip</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">negative_linestyle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">blockfill</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">zero_thick</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">colorbar_shrink</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">colorbar_orientation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">colorbar_position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlog</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">ylog</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | con is the interface to contouring in cf-plot. The minimum use is con(f)</span>
<span class="sd">     | where f is a 2 dimensional array. If a cf field is passed then an</span>
<span class="sd">     | appropriate plot will be produced i.e. a longitude-latitude or</span>
<span class="sd">     | latitude-height plot for example. If a 2d numeric array is passed then</span>
<span class="sd">     | the optional arrays x and y can be used to describe the x and y data</span>
<span class="sd">     | point locations.</span>
<span class="sd">     |</span>
<span class="sd">     | f - array to contour</span>
<span class="sd">     | x - x locations of data in f (optional)</span>
<span class="sd">     | y - y locations of data in f (optional)</span>
<span class="sd">     | fill=True - colour fill contours</span>
<span class="sd">     | lines=True - draw contour lines and labels</span>
<span class="sd">     | line_labels=True - label contour lines</span>
<span class="sd">     | title=title - title for the plot</span>
<span class="sd">     | ptype=0 - plot type - not needed for cf fields.</span>
<span class="sd">     |                       0 = no specific plot type,</span>
<span class="sd">     |                       1 = longitude-latitude,</span>
<span class="sd">     |                       2 = latitude - height,</span>
<span class="sd">     |                       3 = longitude - height,</span>
<span class="sd">     |                       4 = latitude - time,</span>
<span class="sd">     |                       5 = longitude - time</span>
<span class="sd">     |                       6 = rotated pole</span>
<span class="sd">     | negative_linestyle=False - set to True to get dashed negative contours</span>
<span class="sd">     | zero_thick=False - add a thick zero contour line. Set to 3 for example.</span>
<span class="sd">     | blockfill=False - set to True for a blockfill plot</span>
<span class="sd">     | colorbar_title=colbar_title - title for the colour bar</span>
<span class="sd">     | colorbar=1 - add a colour bar if a filled contour plot</span>
<span class="sd">     | colorbar_label_skip=None - skip colour bar labels. Set to 2 to skip</span>
<span class="sd">     |                            every other label.</span>
<span class="sd">     | colorbar_orientation=None - options are &#39;horizontal&#39; and &#39;vertical&#39;</span>
<span class="sd">     |                      The default for most plots is horizontal but</span>
<span class="sd">     |                      for polar stereographic plots this is vertical.</span>
<span class="sd">     | colorbar_shrink=None - value to shrink the colorbar by.  If the colorbar</span>
<span class="sd">     |                        exceeds the plot area then values of 1.0, 0.55</span>
<span class="sd">     |                        or 0.5m ay help it better fit the plot area.</span>
<span class="sd">     | colorbar_position=None - position of colorbar</span>
<span class="sd">     |                          [xmin, ymin, x_extent,y_extent]in normalised</span>
<span class="sd">     |                          coordinates. Use when a common colorbar</span>
<span class="sd">     |                          is required for a set of plots. A typical set</span>
<span class="sd">     |                          of values would be [0.1, 0.05, 0.8, 0.02]</span>
<span class="sd">     | colors=&#39;k&#39; - contour line colors</span>
<span class="sd">     | xlog=False - logarithmic x axis</span>
<span class="sd">     | ylog=False - logarithmic y axis</span>
<span class="sd">     | axes=True - plot x and y axes</span>
<span class="sd">     | xaxis=True - plot xaxis</span>
<span class="sd">     | yaxis=True - plot y axis</span>
<span class="sd">     | xticks=None - xtick positions</span>
<span class="sd">     | xticklabels=None - xtick labels</span>
<span class="sd">     | yticks=None - y tick positions</span>
<span class="sd">     | yticklabels=None - ytick labels</span>
<span class="sd">     | xlabel=None - label for x axis</span>
<span class="sd">     | ylabel=None - label for y axis</span>
<span class="sd">     | verbose=None - change to 1 to get a verbose listing of what con</span>
<span class="sd">     |                is doing</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Turn off divide warning in contour routine which is a numpy issue</span>
    <span class="n">old_settings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

    <span class="c1"># Set potential user axis labels</span>
    <span class="n">user_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
    <span class="n">user_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>

    <span class="c1"># Extract required data for contouring</span>
    <span class="c1"># If a cf-python field</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="c1"># Check if this is a cf.Fieldlist and reject if it is</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> cf_data_assign error - passed field is a &#39;</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;cf.Fieldlist</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;Please pass one field for contouring</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;i.e. f[0]</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="c1"># Extract data</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;con - calling cf_data_assign&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span> <span class="o">=</span>\
            <span class="n">cf_data_assign</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">user_xlabel</span>
        <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">user_ylabel</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;con - using user assigned data&#39;</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">f</span>  <span class="c1"># field data passed in as f</span>
        <span class="n">check_data</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Set contour line styles</span>
    <span class="k">if</span> <span class="n">negative_linestyle</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;contour.negative_linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;solid&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;contour.negative_linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Dashed&#39;</span>

    <span class="c1"># Set contour lines off on block plots</span>
    <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
        <span class="n">fill</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">field_orig</span> <span class="o">=</span> <span class="n">field</span>
        <span class="n">x_orig</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">y_orig</span> <span class="o">=</span> <span class="n">y</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">):</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> con error - blockfill not supported for polar &#39;</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;stereograpic plots</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Turn off colorbar if fill is turned off</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fill</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill</span><span class="p">:</span>
        <span class="n">colorbar</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c1"># Revert to default colour scale if cscale_flag flag is set</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="n">cscale1</span>

    <span class="c1"># Set the orientation of the colorbar</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">colorbar_orientation</span> <span class="o">=</span> <span class="s1">&#39;vertical&#39;</span>
    <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">colorbar_orientation</span> <span class="o">=</span> <span class="s1">&#39;horizontal&#39;</span>

    <span class="n">proj</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span>
    <span class="c1"># Set size of color bar if not specified</span>
    <span class="k">if</span> <span class="n">colorbar_shrink</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">colorbar_shrink</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span> <span class="o">/</span> \
                <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">scale</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">colorbar_shrink</span> <span class="o">=</span> <span class="mf">0.55</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;landscape&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span> <span class="ow">and</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">):</span>
                    <span class="n">colorbar_shrink</span> <span class="o">=</span> <span class="mf">0.5</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span> <span class="ow">and</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">):</span>
                    <span class="n">colorbar_shrink</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;portrait&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">projj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span> <span class="ow">and</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">):</span>
                    <span class="n">colorbar_shrink</span> <span class="o">=</span> <span class="mf">0.25</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span> <span class="ow">and</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">):</span>
                    <span class="n">colorbar_shrink</span> <span class="o">=</span> <span class="mf">1.0</span>

            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;landscape&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
                        <span class="n">colorbar_shrink</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
                        <span class="n">colorbar_shrink</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;portrait&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
                        <span class="n">colorbar_shrink</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
                        <span class="n">colorbar_shrink</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># Set plot type if user specified</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ptype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="n">ptype</span>

    <span class="c1"># Get contour levels</span>
    <span class="n">includes_zero</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># User defined</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;con - using user defined contour levels&#39;</span>
        <span class="n">clevs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fmult</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Automatic levels</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;con - generating automatic contour levels&#39;</span>
        <span class="n">clevs</span><span class="p">,</span> <span class="n">mult</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span>
            <span class="n">field</span><span class="p">),</span> <span class="n">dmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">field</span><span class="p">),</span> <span class="n">tight</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">fmult</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="n">mult</span>

    <span class="c1"># Set the colour scale</span>
    <span class="c1"># Nothing defined</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">includes_zero</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">col_zero</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">cval</span> <span class="ow">in</span> <span class="n">clevs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">includes_zero</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">col_zero</span> <span class="o">=</span> <span class="n">col_zero</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">cval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">includes_zero</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">includes_zero</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cs_below</span> <span class="o">=</span> <span class="n">col_zero</span>
            <span class="n">cs_above</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">-</span> <span class="n">col_zero</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
                <span class="n">cs_below</span> <span class="o">=</span> <span class="n">cs_below</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">cs_above</span> <span class="o">=</span> <span class="n">cs_above</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">uniform</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs_uniform</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                <span class="n">uniform</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;scale1&#39;</span><span class="p">,</span> <span class="n">below</span><span class="o">=</span><span class="n">cs_below</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="n">cs_above</span><span class="p">,</span> <span class="n">uniform</span><span class="o">=</span><span class="n">uniform</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># User selected colour map but no mods so fit to levels</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cscale</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs_user</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Set colorbar labels</span>
    <span class="c1"># Set a sensible label spacing if the user hasn&#39;t already done so</span>
    <span class="k">if</span> <span class="n">colorbar_label_skip</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
            <span class="n">nchars</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">lev</span> <span class="ow">in</span> <span class="n">clevs</span><span class="p">:</span>
                <span class="n">nchars</span> <span class="o">=</span> <span class="n">nchars</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lev</span><span class="p">))</span>
            <span class="n">colorbar_label_skip</span> <span class="o">=</span> <span class="n">nchars</span> <span class="o">/</span> <span class="mi">80</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">colorbar_label_skip</span> <span class="o">=</span> <span class="n">nchars</span> <span class="o">*</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colorbar_label_skip</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">colorbar_label_skip</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">includes_zero</span><span class="p">:</span>
            <span class="c1"># include zero in the colorbar labels</span>
            <span class="n">zero_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mylev</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="k">if</span> <span class="n">mylev</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">colorbar_labels</span> <span class="o">=</span> <span class="n">clevs</span><span class="p">[</span><span class="n">zero_pos</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">zero_pos</span> <span class="o">+</span> <span class="n">colorbar_label_skip</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">colorbar_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colorbar_labels</span><span class="p">,</span> <span class="n">clevs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">colorbar_label_skip</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">zero_pos</span> <span class="o">-</span> <span class="n">colorbar_label_skip</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">colorbar_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clevs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">colorbar_labels</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">colorbar_label_skip</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colorbar_labels</span> <span class="o">=</span> <span class="n">clevs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">colorbar_label_skip</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">colorbar_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colorbar_labels</span><span class="p">,</span> <span class="n">clevs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">colorbar_label_skip</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">colorbar_labels</span> <span class="o">=</span> <span class="n">clevs</span>

    <span class="c1"># Add mult to colorbar_title if used</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">colorbar_title</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mult</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">colorbar_title</span> <span class="o">+</span> <span class="s1">&#39; *10$^{&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mult</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}$&#39;</span>

    <span class="c1"># Catch null titles</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span>

    <span class="c1"># Set plot variables</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span>
    <span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span>
    <span class="n">axis_label_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span>
    <span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
    <span class="n">continent_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
    <span class="n">text_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span>
    <span class="n">title_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span>
    <span class="n">axis_label_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span>
    <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>

    <span class="c1"># Select contour triangulation based on input grid dimensions</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">tri</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">tri</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">tri</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">cb_orient</span> <span class="o">=</span> <span class="n">colorbar_orientation</span>

    <span class="c1">##########</span>
    <span class="c1"># Map plot</span>
    <span class="c1">##########</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;con - making a map plot&#39;</span>
        <span class="c1"># Open a new plot is necessary</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Set up mapping</span>
        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># Reset mapping</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">=</span> <span class="mi">180</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">=</span> <span class="mi">90</span>

        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">set_map</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mapset</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">lonmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                   <span class="n">latmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">latmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
                   <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">set_map</span><span class="p">()</span>

        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
        <span class="n">user_mapset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span>

        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

            <span class="c1"># Add cyclic information if missing.</span>
            <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
                <span class="n">field</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">addcyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="c1"># Shift grid if needed</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">360</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">360</span>
            <span class="n">field</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">shiftgrid</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

            <span class="c1"># Add cyclic information if missing.</span>
            <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
            <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
                <span class="n">field</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">addcyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># Flip latitudes and field if latitudes are in descending order</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

        <span class="c1"># Plotting a sub-area of the grid produces stray contour labels</span>
        <span class="c1"># in polar plots. Subsample the grid to remove this problem</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span><span class="p">:</span>
            <span class="n">myypos</span> <span class="o">=</span> <span class="n">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">myypos</span><span class="p">:]</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="n">myypos</span><span class="p">:,</span> <span class="p">:]</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
            <span class="n">myypos</span> <span class="o">=</span> <span class="n">find_pos_in_array</span><span class="p">(</span>
                <span class="n">vals</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">myypos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">myypos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># Create the meshgrid if required</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">y</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">y</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">mymap</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

        <span class="c1"># Set the plot limits</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">(</span>
                <span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span>
                <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span>
                <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span>
                <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span>
                <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">gset</span><span class="p">(</span>
                    <span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span>
                    <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span>
                    <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span>
                    <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span>
                    <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gset</span><span class="p">(</span>
                    <span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span>
                    <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span>
                    <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span>
                    <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span>
                    <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Filled contours</span>
        <span class="k">if</span> <span class="n">fill</span> <span class="ow">or</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;con - adding filled contours&#39;</span>
            <span class="c1"># Get colour scale for use in contouring</span>
            <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
            <span class="c1"># from 1 to ncols-2.  The colours for the colour bar extensions</span>
            <span class="c1"># are then changed on the colourbar and plot after the plot is made</span>
            <span class="n">cscale_ncols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
            <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>

            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># filled colour contours</span>
            <span class="n">cfill</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span>
                                   <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                                   <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>

        <span class="c1"># Block fill</span>
        <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;con - adding blockfill&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">),</span> <span class="s1">&#39;hasbounds&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="c1"># Add last longitude point</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="c1"># Add last latitude point</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">bfill</span><span class="p">(</span>
                        <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span>
                        <span class="n">fmult</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span>
                        <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                        <span class="n">lonlat</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">bound</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bfill</span><span class="p">(</span>
                        <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span>
                        <span class="n">fmult</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span>
                        <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                        <span class="n">lonlat</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">bfill</span><span class="p">(</span>
                    <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span>
                    <span class="n">fmult</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span>
                    <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                    <span class="n">lonlat</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Contour lines and labels</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;con - adding contour lines and labels&#39;</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                               <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line_labels</span><span class="p">:</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%1.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f&#39;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                     <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span>
                                     <span class="n">fontweight</span><span class="o">=</span><span class="n">text_fontweight</span><span class="p">)</span>

            <span class="c1"># Thick zero contour line</span>
            <span class="k">if</span> <span class="n">zero_thick</span><span class="p">:</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                   <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span>
                                   <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>

        <span class="c1"># axes</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;con - adding cylindrical axes&#39;</span>
            <span class="n">lonticks</span><span class="p">,</span> <span class="n">lonlabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span>
                <span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">latticks</span><span class="p">,</span> <span class="n">latlabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span>
                <span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">lonticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">lonlabels</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticks</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">axes_plot</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">latticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">latlabels</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">axes_plot</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticks</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">axes_plot</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">user_xlabel</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">user_ylabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;con - adding stereograpic axes&#39;</span>
            <span class="n">latstep</span> <span class="o">=</span> <span class="mi">30</span>
            <span class="k">if</span> <span class="mi">90</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">:</span>
                <span class="n">latstep</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">mymap</span><span class="o">.</span><span class="n">drawmeridians</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                                <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span>
                                <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">mymap</span><span class="o">.</span><span class="n">drawmeridians</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">mymap</span><span class="o">.</span><span class="n">drawparallels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="n">latstep</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">mymap</span><span class="o">.</span><span class="n">drawparallels</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>

        <span class="c1"># Coastlines and title</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">(</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">continent_color</span><span class="p">)</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="n">title</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>

        <span class="c1"># Color bar</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;con - adding colour bar&#39;</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.10</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.15</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.20</span>
            <span class="k">if</span> <span class="n">colorbar_position</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cfill</span><span class="p">,</span>
                                                     <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span>
                                                     <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">,</span>
                                                     <span class="n">aspect</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span>
                                                     <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">colorbar_position</span><span class="p">)</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
                    <span class="n">cfill</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="n">colorbar_orientation</span><span class="p">)</span>
                <span class="n">gpos</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span>
                <span class="n">colorbar_title</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>

            <span class="c1"># Bug in Matplotlib colorbar labelling</span>
            <span class="c1"># With clevs=[-1, 1, 10000, 20000, 30000, 40000, 50000, 60000]</span>
            <span class="c1"># Labels are [0, 2, 10001, 20001, 30001, 40001, 50001, 60001]</span>
            <span class="c1"># With a +1 near to the colorbar label</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colorbar_labels</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
                <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">text_fontsize</span><span class="p">)</span>
                <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">text_fontweight</span><span class="p">)</span>

        <span class="c1"># Mask off selected area in Lambert Conformal projection if requested</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;lcc&#39;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lcc_plimits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lcc_plimits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c1"># Create polygons and fill with white</span>
                <span class="n">xmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lcc_plimits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">xmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lcc_plimits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lcc_plimits</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lcc_plimits</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                <span class="c1"># Mask left of plot</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="mi">176</span>
                <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span><span class="o">+</span><span class="n">xmin</span><span class="p">,</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span><span class="o">+</span><span class="n">xmin</span><span class="o">-</span><span class="mi">90</span><span class="p">])</span>
                <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span><span class="o">-</span><span class="mi">85</span><span class="p">,</span> <span class="mi">85</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">pts</span><span class="p">)])</span>
                <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">mymap</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                   <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>

                <span class="c1"># Mask right of plot</span>
                <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span><span class="o">+</span><span class="n">xmax</span><span class="p">,</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span><span class="o">+</span><span class="n">xmax</span><span class="o">+</span><span class="mi">90</span><span class="p">])</span>
                <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">mymap</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                   <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>

                <span class="c1"># Mask above plot</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="o">+</span><span class="mi">180</span>
                <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span><span class="o">+</span><span class="n">xmin</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span>
                                       <span class="n">xmax</span><span class="o">+</span><span class="mi">90</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">pts</span><span class="p">)])</span>
                <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">+</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span><span class="o">+</span><span class="mi">89</span><span class="p">])</span>
                <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">mymap</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                   <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>

                <span class="c1"># Mask below plot</span>
                <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">+</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span><span class="o">-</span><span class="mi">89</span><span class="p">])</span>
                <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">mymap</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                   <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>

                <span class="c1"># Add some labels</span>
                <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
                    <span class="n">mymap</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">()</span>
                    <span class="n">mymap</span><span class="o">.</span><span class="n">drawparallels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">80.</span><span class="p">,</span> <span class="mf">81.</span><span class="p">,</span> <span class="mf">20.</span><span class="p">))</span>
                    <span class="n">mymap</span><span class="o">.</span><span class="n">drawmeridians</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span> <span class="mf">181.</span><span class="p">,</span> <span class="mf">20.</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                        <span class="n">lons</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="o">*</span><span class="mi">20</span><span class="o">-</span><span class="mi">180</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">lon</span> <span class="o">&gt;=</span> <span class="n">xmin</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">&lt;=</span> <span class="n">xmax</span><span class="p">:</span>
                                <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">ymin</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span><span class="o">+</span><span class="n">ymin</span><span class="o">-</span><span class="mi">3</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span><span class="o">+</span><span class="n">ymax</span><span class="o">+</span><span class="mi">3</span>
                        <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">mymap</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xpts</span><span class="p">)):</span>
                            <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">pt</span><span class="p">]))</span>
                            <span class="k">if</span> <span class="n">lons</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">label</span> <span class="o">=</span> <span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;W&#39;</span>
                            <span class="k">if</span> <span class="n">lons</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">label</span> <span class="o">=</span> <span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;E&#39;</span>
                            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">pt</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">pt</span><span class="p">],</span> <span class="n">label</span><span class="p">,</span>
                                               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                               <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                        <span class="n">lats</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">*</span><span class="mi">20</span><span class="o">-</span><span class="mi">80</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">lat</span> <span class="o">&gt;=</span> <span class="n">ymin</span> <span class="ow">and</span> <span class="n">lat</span> <span class="o">&lt;=</span> <span class="n">ymax</span><span class="p">:</span>
                                <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
                        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span><span class="o">+</span><span class="n">xmin</span><span class="o">-</span><span class="mi">3</span>
                        <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">mymap</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xpts</span><span class="p">)):</span>
                            <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">pt</span><span class="p">]))</span>
                            <span class="k">if</span> <span class="n">lats</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">label</span> <span class="o">=</span> <span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;S&#39;</span>
                            <span class="k">if</span> <span class="n">lats</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">label</span> <span class="o">=</span> <span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;N&#39;</span>
                            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">pt</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">pt</span><span class="p">],</span> <span class="n">label</span><span class="p">,</span>
                                               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
                                               <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                               <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1"># reset plot limits if not a user plot</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">()</span>

    <span class="c1">###############################################</span>
    <span class="c1"># Latitude, longitude or time vs pressure plots</span>
    <span class="c1">###############################################</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;con - making a latitude-pressure plot&#39;</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;con - making a longitude-pressure plot&#39;</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;con - making a time-pressure plot&#39;</span>

        <span class="c1"># Work out which way is up</span>
        <span class="n">positive</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">),</span> <span class="s1">&#39;positive&#39;</span><span class="p">):</span>
                <span class="n">positive</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">positive</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> cf-plot - data error </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;data needs a vertical coordinate direction&#39;</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39; as required in CF data conventions&#39;</span>
                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">positive</span> <span class="o">=</span> <span class="s1">&#39;down&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;theta&#39;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
                <span class="n">positive</span> <span class="o">=</span> <span class="s1">&#39;up&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;height&#39;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
                <span class="n">positive</span> <span class="o">=</span> <span class="s1">&#39;up&#39;</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Set plot limits</span>
        <span class="n">user_gset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>
        <span class="k">if</span> <span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Program selected data plot limits</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">80</span> <span class="ow">and</span> <span class="n">xmin</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
                <span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xmax</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="ow">and</span> <span class="n">xmax</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
                <span class="n">xmax</span> <span class="o">=</span> <span class="mi">90</span>

            <span class="k">if</span> <span class="n">positive</span> <span class="o">==</span> <span class="s1">&#39;down&#39;</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ymax</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="n">ymax</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Use user specified plot limits</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

        <span class="n">xstep</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">==</span> <span class="o">-</span><span class="mi">90</span> <span class="ow">and</span> <span class="n">xmax</span> <span class="o">==</span> <span class="mi">90</span><span class="p">):</span>
            <span class="n">xstep</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">ystep</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">15000</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">5000</span>

        <span class="c1"># Work out ticks and tick labels</span>
        <span class="k">if</span> <span class="n">ylog</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">or</span> <span class="n">ylog</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">heightticks</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span>
                <span class="n">dmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span>
                    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="n">dmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span>
                    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="n">ystep</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tick</span> <span class="o">&gt;=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tick</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">):</span>
                    <span class="n">heightticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tick</span><span class="p">)</span>
        <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">heightticks</span>

        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">heightticks</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
            <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">heightticks</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">xaxis</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span>
                    <span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># lat-pressure</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span>
                    <span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># lon-pressure</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="c1"># time-pressure</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

                    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">tmin</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dtarray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">tmax</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dtarray</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Use user set values if present</span>
                        <span class="n">tmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
                        <span class="n">tmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>

                    <span class="c1"># Change plotvars.xmin and plotvars.xmax from a date string</span>
                    <span class="c1"># to a number</span>
                    <span class="n">ref_time</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span>
                    <span class="n">ref_calendar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">calendar</span>
                    <span class="n">ref_time_origin</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Units</span><span class="o">.</span><span class="n">reftime</span><span class="p">)</span>
                    <span class="n">time_units</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">ref_calendar</span><span class="p">)</span>

                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">xmin</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">xmax</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>

                    <span class="n">taxis</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmin</span><span class="p">),</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmax</span><span class="p">)],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">time_ticks</span><span class="p">,</span> <span class="n">time_labels</span><span class="p">,</span> <span class="n">tlabel</span> <span class="o">=</span> <span class="n">timeaxis</span><span class="p">(</span><span class="n">taxis</span><span class="p">)</span>

                    <span class="c1"># Use user supplied labels if present</span>
                    <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">tlabel</span>
                    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">xticks</span> <span class="o">=</span> <span class="n">time_ticks</span>
                    <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">time_labels</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Not a CF field</span><span class="se">\n</span><span class="s1">Please use ptype=0 and &#39;</span>
                    <span class="n">errstr</span> <span class="o">=</span> <span class="n">srrstr</span> <span class="o">+</span> <span class="s1">&#39;specify axis labels manually</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="c1"># Set plot limits</span>
        <span class="k">if</span> <span class="n">ylog</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">or</span> <span class="n">ylog</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">(</span>
                <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
                <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
                <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ymax</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Avoid zero in a log plot</span>
            <span class="n">gset</span><span class="p">(</span>
                <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
                <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
                <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                <span class="n">ylog</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>

        <span class="c1"># Label axes</span>
        <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="n">heightticks</span><span class="p">,</span>
                  <span class="n">yticklabels</span><span class="o">=</span><span class="n">heightlabels</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="c1"># Get colour scale for use in contouring</span>
        <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
        <span class="c1"># from 1 to ncols-2.  The colours for the colour bar extensions are</span>
        <span class="c1"># then changed on the colourbar and plot after the plot is made</span>
        <span class="n">cscale_ncols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>

        <span class="c1"># Filled contours</span>
        <span class="k">if</span> <span class="n">fill</span> <span class="ow">or</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">cfill</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span>
                                           <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                                           <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">,</span>
                                           <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>

        <span class="c1"># Block fill</span>
        <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">),</span> <span class="s1">&#39;hasbounds&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;pressure&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">bfill</span><span class="p">(</span>
                        <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span>
                        <span class="n">fmult</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span>
                        <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                        <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">bound</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bfill</span><span class="p">(</span>
                        <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span>
                        <span class="n">fmult</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span>
                        <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                        <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">bfill</span><span class="p">(</span>
                    <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span>
                    <span class="n">fmult</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span>
                    <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                    <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Contour lines and labels</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line_labels</span><span class="p">:</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%1.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f&#39;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span>
                    <span class="n">cs</span><span class="p">,</span>
                    <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span>
                    <span class="n">fontweight</span><span class="o">=</span><span class="n">text_fontweight</span><span class="p">)</span>

                <span class="c1"># Thick zero contour line</span>
                <span class="k">if</span> <span class="n">zero_thick</span><span class="p">:</span>
                    <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                                               <span class="p">[</span><span class="o">-</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                               <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>

        <span class="c1"># Colorbar</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.15</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.25</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.3</span>
            <span class="k">if</span> <span class="n">colorbar_position</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cfill</span><span class="p">,</span>
                                                     <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">,</span>
                                                     <span class="n">aspect</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span>
                                                     <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span>
                                                     <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span>
                                                     <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">colorbar_position</span><span class="p">)</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
                    <span class="n">cfill</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">)</span>
                <span class="n">gpos</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span>
                <span class="n">colorbar_title</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>
            <span class="c1"># Bug in Matplotlib colorbar labelling</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colorbar_labels</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
                <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">text_fontsize</span><span class="p">)</span>
                <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">text_fontweight</span><span class="p">)</span>

        <span class="c1"># Title</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span>
                                <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>

        <span class="c1"># Reset plot limits to those supplied by the user</span>
        <span class="k">if</span> <span class="n">user_gset</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">tmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                 <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>

        <span class="c1"># reset plot limits if not a user plot</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">()</span>

    <span class="c1">#################</span>
    <span class="c1"># Hovmuller plots</span>
    <span class="c1">#################</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ptype</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;con - making a Hovmuller plot&#39;</span>
        <span class="n">yplotlabel</span> <span class="o">=</span> <span class="s1">&#39;Time&#39;</span>
        <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="s1">&#39;Longitude&#39;</span>
        <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="s1">&#39;Latitude&#39;</span>
        <span class="n">user_gset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>

        <span class="c1"># Time strings set to None initially</span>
        <span class="n">tmin</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">tmax</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># Set plot limits</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span>
               <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">]):</span>
            <span class="c1"># Store time strings for later use</span>
            <span class="n">tmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

            <span class="c1"># Check data has CF attributes needed</span>
            <span class="n">check_units</span> <span class="o">=</span> <span class="n">check_units</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">check_calendar</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">check_Units_reftime</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">),</span> <span class="s1">&#39;units&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                <span class="n">check_units</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">),</span> <span class="s1">&#39;calendar&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                <span class="n">check_calendar</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Units</span><span class="p">,</span> <span class="s1">&#39;reftime&#39;</span><span class="p">):</span>
                    <span class="n">check_Units_reftime</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">check_Units_reftime</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">False</span> <span class="ow">in</span> <span class="p">[</span><span class="n">check_units</span><span class="p">,</span> <span class="n">check_calendar</span><span class="p">,</span> <span class="n">check_Units_reftime</span><span class="p">]:</span>
                <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The required CF time information to make the plot&#39;</span>
                <span class="k">print</span> <span class="s1">&#39;is not available please fix the following before&#39;</span>
                <span class="k">print</span> <span class="s1">&#39;trying to plot again&#39;</span>
                <span class="k">if</span> <span class="n">check_units</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s1">&#39;Time axis missing: units&#39;</span>
                <span class="k">if</span> <span class="n">check_calendar</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s1">&#39;Time axis missing: calendar&#39;</span>
                <span class="k">if</span> <span class="n">check_Units_reftime</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s1">&#39;Time axis missing: Units.reftime&#39;</span>
                <span class="k">return</span>

            <span class="c1"># Change from date string in ymin and ymax to date as a float</span>
            <span class="n">ref_time</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span>
            <span class="n">ref_calendar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">calendar</span>
            <span class="n">ref_time_origin</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Units</span><span class="o">.</span><span class="n">reftime</span><span class="p">)</span>

            <span class="n">time_units</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">ref_calendar</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># Set plot limits</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>

        <span class="c1"># Revert to time strings if set</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">]):</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="n">tmin</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">tmax</span>

        <span class="c1"># Extract axis labels</span>
        <span class="n">time_ticks</span><span class="p">,</span> <span class="n">time_labels</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="n">timeaxis</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">lonlatticks</span><span class="p">,</span> <span class="n">lonlatlabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">lonlatticks</span><span class="p">,</span> <span class="n">lonlatlabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">lonlatticks</span> <span class="o">=</span> <span class="n">xticks</span>
                    <span class="n">lonlatlabels</span> <span class="o">=</span> <span class="n">xticks</span>
                    <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">lonlatlabels</span> <span class="o">=</span> <span class="n">xticklabels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lonlatticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">timeticks</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="n">timelabels</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">timelabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timeticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">latticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">timeticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">yplotlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">xlabel</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
        <span class="k">if</span> <span class="n">ylabel</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">yplotlabel</span> <span class="o">=</span> <span class="n">ylabel</span>

        <span class="c1"># Use the automatically generated labels if none are supplied</span>
        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">yplotlabel</span> <span class="o">=</span> <span class="n">time_axis_label</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time_ticks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">timeticks</span> <span class="o">=</span> <span class="n">time_ticks</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time_labels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">timelabels</span> <span class="o">=</span> <span class="n">time_labels</span>

        <span class="c1"># Set and label axes</span>
        <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">lonlatticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">lonlatlabels</span><span class="p">,</span>
                  <span class="n">yticks</span><span class="o">=</span><span class="n">timeticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">timelabels</span><span class="p">,</span>
                  <span class="n">xlabel</span><span class="o">=</span><span class="n">xplotlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">yplotlabel</span><span class="p">)</span>

        <span class="c1"># Get colour scale for use in contouring</span>
        <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
        <span class="c1"># from 1 to ncols-2.  The colours for the colour bar extensions are</span>
        <span class="c1"># then changed on the colourbar and plot after the plot is made</span>
        <span class="n">cscale_ncols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>

        <span class="c1"># Filled contours</span>
        <span class="k">if</span> <span class="n">fill</span> <span class="ow">or</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">cfill</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span>
                                           <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                                           <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">,</span>
                                           <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>

        <span class="c1"># Block fill</span>
        <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hasbounds</span><span class="p">:</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">bfill</span><span class="p">(</span>
                        <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span>
                        <span class="n">fmult</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span>
                        <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                        <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">bound</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bfill</span><span class="p">(</span>
                        <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span>
                        <span class="n">fmult</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span>
                        <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                        <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">bfill</span><span class="p">(</span>
                    <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span>
                    <span class="n">fmult</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span>
                    <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                    <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Contour lines and labels</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line_labels</span><span class="p">:</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%1.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f&#39;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                     <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span>
                                     <span class="n">fontweight</span><span class="o">=</span><span class="n">text_fontweight</span><span class="p">)</span>

                <span class="c1"># Thick zero contour line</span>
                <span class="k">if</span> <span class="n">zero_thick</span><span class="p">:</span>
                    <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                                               <span class="p">[</span><span class="o">-</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                               <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>

        <span class="c1"># Colorbar</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.15</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.25</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.3</span>
            <span class="k">if</span> <span class="n">colorbar_position</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cfill</span><span class="p">,</span>
                                                     <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">,</span>
                                                     <span class="n">aspect</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span>
                                                     <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span>
                                                     <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span>
                                                     <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">colorbar_position</span><span class="p">)</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
                    <span class="n">cfill</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">)</span>
                <span class="n">gpos</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span>
                <span class="n">colorbar_title</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>
            <span class="c1"># Bug in Matplotlib colorbar labelling</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colorbar_labels</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
                <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">text_fontsize</span><span class="p">)</span>
                <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">text_fontweight</span><span class="p">)</span>

        <span class="c1"># Title</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="n">title</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>

        <span class="c1"># reset plot limits if not a user plot</span>
        <span class="k">if</span> <span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">()</span>

    <span class="c1">#############</span>
    <span class="c1"># Rotated pole</span>
    <span class="c1">#############</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="c1"># Rotated pole plots use a regularly spaced grid</span>
        <span class="c1"># The x and y points from the data are used to make the rotated axes</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;con - making a rotated pole plot&#39;</span>
        <span class="n">user_gset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Set plot limits</span>
        <span class="n">gset</span><span class="p">(</span>
            <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>

        <span class="c1"># Get colour scale for use in contouring</span>
        <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
        <span class="c1"># from 1 to ncols-2.  The colours for the colour bar extensions are</span>
        <span class="c1"># then changed on the colourbar and plot after the plot is made</span>
        <span class="n">cscale_ncols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>

        <span class="c1"># Filled contours</span>
        <span class="k">if</span> <span class="n">fill</span> <span class="ow">or</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">cfill</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span>
                                           <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                                           <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">,</span>
                                           <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>

        <span class="c1"># Block fill</span>
        <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="n">bfill</span><span class="p">(</span>
                <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span>
                <span class="n">fmult</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span>
                <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Contour lines and labels</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line_labels</span><span class="p">:</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%1.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f&#39;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                     <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span>
                                     <span class="n">fontweight</span><span class="o">=</span><span class="n">text_fontweight</span><span class="p">)</span>

            <span class="c1"># Thick zero contour line</span>
            <span class="k">if</span> <span class="n">zero_thick</span><span class="p">:</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                                           <span class="p">[</span><span class="o">-</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                           <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>

        <span class="c1"># Colorbar</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.15</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.25</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.3</span>
            <span class="k">if</span> <span class="n">colorbar_position</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cfill</span><span class="p">,</span>
                                                     <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">,</span>
                                                     <span class="n">aspect</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span>
                                                     <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span>
                                                     <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span>
                                                     <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">colorbar_position</span><span class="p">)</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
                    <span class="n">cfill</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">)</span>
                <span class="n">gpos</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span>
                <span class="n">colorbar_title</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>
            <span class="c1"># Bug in Matplotlib colorbar labelling</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colorbar_labels</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
                <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">text_fontsize</span><span class="p">)</span>
                <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">text_fontweight</span><span class="p">)</span>

        <span class="c1"># Rotated grid axes</span>
        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="n">rgaxes</span><span class="p">(</span><span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="p">[</span><span class="mi">100000000</span><span class="p">],</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">],</span>
                      <span class="n">yticks</span><span class="o">=</span><span class="p">[</span><span class="mi">100000000</span><span class="p">],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">],</span>
                      <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Title</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="n">title</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>

        <span class="c1"># reset plot limits if not a user plot</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">()</span>

    <span class="c1">############</span>
    <span class="c1"># Other plots</span>
    <span class="c1">############</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;con - making an other plot&#39;</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">user_gset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>

        <span class="c1"># Work out axes if none are supplied</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span>
               <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">]):</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

        <span class="n">xstep</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10.0</span>
        <span class="n">ystep</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10.0</span>

        <span class="c1"># Set plot limits and set default plot labels</span>
        <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>

        <span class="n">xaxisticks</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span>
            <span class="n">dmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
            <span class="n">dmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
            <span class="n">mystep</span><span class="o">=</span><span class="p">(</span>
                <span class="n">xmax</span> <span class="o">-</span>
                <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span>
            <span class="mf">10.0</span><span class="p">,</span>
            <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xaxislabels</span> <span class="o">=</span> <span class="n">xaxisticks</span>
        <span class="k">if</span> <span class="n">ymin</span> <span class="o">&lt;</span> <span class="n">ymax</span><span class="p">:</span>
            <span class="n">yaxisticks</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span>
                <span class="n">dmin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ymax</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">:</span>
            <span class="n">yaxisticks</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span>
                <span class="n">dmin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">ymin</span> <span class="o">-</span> <span class="n">ymax</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yaxislabels</span> <span class="o">=</span> <span class="n">yaxisticks</span>
        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">yplotlabel</span> <span class="o">=</span> <span class="n">ylabel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yplotlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># Draw axes</span>
        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">xaxisticks</span> <span class="o">=</span> <span class="n">xticks</span>
                    <span class="n">xaxislabels</span> <span class="o">=</span> <span class="n">xticks</span>
                    <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">xaxislabels</span> <span class="o">=</span> <span class="n">xticklabels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xaxisticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">yaxisticks</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="n">yaxislabels</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">yaxislabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yaxisticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">xplotticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">xplotticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xaxisticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xaxislabels</span><span class="p">,</span>
                  <span class="n">yticks</span><span class="o">=</span><span class="n">yaxisticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yaxislabels</span><span class="p">,</span>
                  <span class="n">xlabel</span><span class="o">=</span><span class="n">xplotlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">yplotlabel</span><span class="p">)</span>

        <span class="c1"># Get colour scale for use in contouring</span>
        <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
        <span class="c1"># then from 1 to ncols-2.  The colours for the colour bar extensions</span>
        <span class="c1"># are changed on the colourbar and plot after the plot is made</span>
        <span class="n">cscale_ncols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>

        <span class="c1"># Filled contours</span>
        <span class="k">if</span> <span class="n">fill</span> <span class="ow">or</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">cfill</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span>
                                           <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                                           <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">,</span>
                                           <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>

        <span class="c1"># Block fill</span>
        <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="n">bfill</span><span class="p">(</span>
                <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span>
                <span class="n">fmult</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span>
                <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Contour lines and labels</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line_labels</span><span class="p">:</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%1.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f&#39;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                     <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span>
                                     <span class="n">fontweight</span><span class="o">=</span><span class="n">text_fontweight</span><span class="p">)</span>

            <span class="c1"># Thick zero contour line</span>
            <span class="k">if</span> <span class="n">zero_thick</span><span class="p">:</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                           <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                           <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>

        <span class="c1"># Colorbar</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.15</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.25</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.3</span>
            <span class="k">if</span> <span class="n">colorbar_position</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cfill</span><span class="p">,</span>
                                                     <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">,</span>
                                                     <span class="n">aspect</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span>
                                                     <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span>
                                                     <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span>
                                                     <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">colorbar_position</span><span class="p">)</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
                    <span class="n">cfill</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">)</span>
                <span class="n">gpos</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span>
                <span class="n">colorbar_title</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>
            <span class="c1"># Bug in Matplotlib colorbar labelling</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colorbar_labels</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
                <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">text_fontsize</span><span class="p">)</span>
                <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">text_fontweight</span><span class="p">)</span>

        <span class="c1"># Title</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="n">title</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>

        <span class="c1"># reset plot limits if not a user plot</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">()</span>

    <span class="c1">##################</span>
    <span class="c1"># Save or view plot</span>
    <span class="c1">##################</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;con - saving or viewing plot&#39;</span>

        <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="o">**</span><span class="n">old_settings</span><span class="p">)</span>  <span class="c1"># reset to default numpy error settings</span>

        <span class="n">gclose</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="mapset"><a class="viewcode-back" href="../mapset.html#cfplot.mapset">[docs]</a><span class="k">def</span> <span class="nf">mapset</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lonmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">latmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">latmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;cyl&#39;</span><span class="p">,</span>
           <span class="n">boundinglat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">user_mapset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
           <span class="n">width</span><span class="o">=</span><span class="mi">12000000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">9000000</span><span class="p">,</span> <span class="n">lat_1</span><span class="o">=</span><span class="mf">45.</span><span class="p">,</span> <span class="n">lat_2</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span> <span class="n">plimits</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | mapset sets the mapping parameters.</span>
<span class="sd">     |</span>
<span class="sd">     | lonmin=lonmin - minimum longitude</span>
<span class="sd">     | lonmax=lonmax - maximum longitude</span>
<span class="sd">     | latmin=latmin - minimum latitude</span>
<span class="sd">     | latmax=latmax - maximum latitude</span>
<span class="sd">     | proj=proj - &#39;cyl&#39; for cylindrical projection. &#39;npstere&#39; or &#39;spstere&#39;</span>
<span class="sd">     |      for northern hemisphere or southern hemisphere polar stereographic</span>
<span class="sd">     |      projection. Use&#39;moll&#39; for the mollweide projection.</span>
<span class="sd">     | boundinglat=boundinglat - edge of the viewable latitudes in a</span>
<span class="sd">     |      stereographic plot</span>
<span class="sd">     | lon_0=0 - longitude centre of desired map domain in polar</span>
<span class="sd">     |           stereographic and orthogrphic plots</span>
<span class="sd">     | lat_0=40 - latitude centre of desired map domain in orthogrphic plots</span>
<span class="sd">     | resolution=resolution - the map resolution - can be one of &#39;c&#39; (crude),</span>
<span class="sd">     |      &#39;l&#39; (low), &#39;i&#39; (intermediate), &#39;h&#39; (high), &#39;f&#39; (full) or &#39;None&#39;</span>
<span class="sd">     | user_mapset=user_mapset - variable to indicate whether a user call</span>
<span class="sd">     |      to mapset has been made.</span>
<span class="sd">     | lat_1=45 - first standard parallel</span>
<span class="sd">     | lat_2=55 - second standard parallel</span>
<span class="sd">     | width=12000000 - width of Lambert Conformal Projection, lcc</span>
<span class="sd">     | height=9000000 - height of Lambert Conformal Projection, lcc</span>
<span class="sd">     | plimits=None - plot limits [lonmin, lonmax, latmin, latmax] for lcc plot</span>
<span class="sd">     |</span>
<span class="sd">     | The default map plotting projection is the cyclindrical equidistant</span>
<span class="sd">     | projection from-180 to 180 in longitude and -90 to 90 in latitude.</span>
<span class="sd">     | To change the map view in this projection to over the United Kingdom,</span>
<span class="sd">     | for example, you would use</span>
<span class="sd">     | mapset(lonmin=-6, lonmax=3, latmin=50, latmax=60)</span>
<span class="sd">     | or mapset(-6, 3, 50, 60)</span>
<span class="sd">     |</span>
<span class="sd">     | The limits are -360 to 720 in longitude so to look at the equatorial</span>
<span class="sd">     | Pacific you could use</span>
<span class="sd">     | mapset(lonmin=90, lonmax=300, latmin=-30, latmax=30)</span>
<span class="sd">     | or</span>
<span class="sd">     | mapset(lonmin=-270, lonmax=-60, latmin=-30, latmax=30)</span>
<span class="sd">     |</span>
<span class="sd">     | The proj parameter for the present accepts just two values - &#39;npstere&#39;</span>
<span class="sd">     | and &#39;spstere&#39; for northern hemisphere or southern hemisphere polar</span>
<span class="sd">     | stereographic projections. In addition to these the boundinglat</span>
<span class="sd">     | parameter sets the edge of the viewable latitudes and lat_0 sets the</span>
<span class="sd">     | centre of desired map domain.</span>
<span class="sd">     |</span>
<span class="sd">     | Map settings are persistent until a new call to mapset is made. To</span>
<span class="sd">     | reset to the default map settings use mapset().</span>

<span class="sd">     :Returns:</span>
<span class="sd">      None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set the continent resolution</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span>
           <span class="n">lonmin</span><span class="p">,</span> <span class="n">lonmax</span><span class="p">,</span> <span class="n">latmin</span><span class="p">,</span> <span class="n">latmax</span><span class="p">])</span> <span class="ow">and</span> <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">=</span> <span class="mi">180</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="s1">&#39;cyl&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lat_1</span> <span class="o">=</span> <span class="mi">45</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lat_2</span> <span class="o">=</span> <span class="mi">55</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lcc_width</span> <span class="o">=</span> <span class="mi">12000000</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lcc_heith</span> <span class="o">=</span> <span class="mi">9000000</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lcc_plimits</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">lonmin</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span>
    <span class="k">if</span> <span class="n">lonmax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="mi">180</span>
    <span class="k">if</span> <span class="n">latmin</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="k">if</span> <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;merc&#39;</span><span class="p">:</span>
            <span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">80</span>
    <span class="k">if</span> <span class="n">latmax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="k">if</span> <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;merc&#39;</span><span class="p">:</span>
            <span class="n">latmax</span> <span class="o">=</span> <span class="mi">80</span>

    <span class="k">if</span> <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;moll&#39;</span><span class="p">:</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">-</span> <span class="mi">180</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">+</span> <span class="mi">180</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">=</span> <span class="n">lonmin</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">=</span> <span class="n">lonmax</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span> <span class="o">=</span> <span class="n">latmin</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">=</span> <span class="n">latmax</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="n">proj</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span> <span class="o">=</span> <span class="n">boundinglat</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span> <span class="o">=</span> <span class="n">lon_0</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">lat_0</span> <span class="o">=</span> <span class="n">lat_0</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">lcc_width</span> <span class="o">=</span> <span class="n">width</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">lcc_height</span> <span class="o">=</span> <span class="n">height</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">lat_1</span> <span class="o">=</span> <span class="n">lat_1</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">lat_2</span> <span class="o">=</span> <span class="n">lat_2</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">lcc_plimits</span> <span class="o">=</span> <span class="n">plimits</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">=</span> <span class="n">user_mapset</span>
    <span class="n">set_map</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="levs"><a class="viewcode-back" href="../levs.html#cfplot.levs">[docs]</a><span class="k">def</span> <span class="nf">levs</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">manual</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | The levs command manually sets the contour levels.</span>

<span class="sd">     | min=min - minimum level</span>
<span class="sd">     | max=max - maximum level</span>
<span class="sd">     | step=step - step between levels</span>
<span class="sd">     | manual= manual - set levels manually</span>
<span class="sd">     | extend=&#39;neither&#39;, &#39;both&#39;, &#39;min&#39;, or &#39;max&#39; - colour bar limit extensions.</span>

<span class="sd">     | Use the levs command when a predefined set of levels is required. The</span>
<span class="sd">     | min, max and step parameters are all needed to define a set of  levels.</span>
<span class="sd">     | These can take integer or floating point numbers. If colour filled</span>
<span class="sd">     | contours are plotted then the default is to extend the minimum and</span>
<span class="sd">     | maximum contours coloured for out of range values - extend=&#39;both&#39;.</span>

<span class="sd">     | Once a user call is made to levs the levels are persistent.</span>
<span class="sd">     | i.e. the next plot will use the same set of levels.</span>
<span class="sd">     | Use levs() to reset to undefined levels.</span>

<span class="sd">     :Returns:</span>
<span class="sd">      None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">manual</span><span class="p">]):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_min</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_max</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">=</span> <span class="s1">&#39;both&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">manual</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">manual</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_min</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_max</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Set the normalization object as we are using potentially unevenly</span>
        <span class="c1"># spaced levels</span>
        <span class="n">ncolors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
            <span class="n">ncolors</span> <span class="o">=</span> <span class="n">ncolors</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span>
            <span class="n">boundaries</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="n">ncolors</span><span class="o">=</span><span class="n">ncolors</span><span class="p">)</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">step</span><span class="p">]):</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> levs error&#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> min, max and step or manual need to be passed&#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> to levs to generate a set of contour levels</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_min</span> <span class="o">=</span> <span class="nb">min</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_max</span> <span class="o">=</span> <span class="nb">max</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="o">=</span> <span class="n">step</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">))</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">step</span><span class="p">]):</span>
                <span class="n">lstep</span> <span class="o">=</span> <span class="n">step</span> <span class="o">*</span> <span class="mf">1e-10</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span> <span class="o">+</span> <span class="n">lstep</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="p">((</span><span class="n">levs</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="p">(</span><span class="n">levs</span> <span class="o">/</span> <span class="mf">1e10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">levs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lstep</span> <span class="o">=</span> <span class="n">step</span> <span class="o">*</span> <span class="mf">1e-10</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span> <span class="o">+</span> <span class="n">lstep</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="p">(</span><span class="n">levs</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="n">levs</span> <span class="o">/</span> <span class="mf">1e10</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">levs</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># Check for spurious decimal places due to numeric representation</span>
            <span class="c1"># and fix if found</span>
            <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">)):</span>
                <span class="n">ndecs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">pt</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ndecs</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">pt</span><span class="p">],</span> <span class="mi">7</span><span class="p">)</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">=</span> <span class="n">extend</span>

</div>
<div class="viewcode-block" id="mapaxis"><a class="viewcode-back" href="../mapaxis.html#cfplot.mapaxis">[docs]</a><span class="k">def</span> <span class="nf">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | mapaxis is used to work out a sensible set of longitude and latitude</span>
<span class="sd">     | tick marks and labels.  This is an internal routine and is not used</span>
<span class="sd">     | by the user.</span>

<span class="sd">     | min=None - minimum axis value</span>
<span class="sd">     | max=None - maximum axis value</span>
<span class="sd">     | type=None - 1 = longitude, 2 = latitude</span>

<span class="sd">     :Returns:</span>
<span class="sd">      longtitude/latitude ticks and longitude/latitude tick labels</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="nb">min</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="nb">max</span>
        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span>
        <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">:</span>
            <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
            <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">720</span><span class="p">,</span> <span class="mi">720</span> <span class="o">+</span> <span class="n">lonstep</span><span class="p">,</span> <span class="n">lonstep</span><span class="p">)</span>
        <span class="n">lonticks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lons</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lon</span> <span class="o">&gt;=</span> <span class="n">lonmin</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">&lt;=</span> <span class="n">lonmax</span><span class="p">:</span>
                <span class="n">lonticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>

        <span class="n">lonlabels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lonticks</span><span class="p">:</span>
            <span class="n">lon2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">lon</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>
            <span class="k">if</span> <span class="n">lon2</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lon2</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">180</span><span class="p">:</span>
                <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">lon2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;W&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lon2</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lon2</span> <span class="o">&lt;</span> <span class="mi">180</span><span class="p">:</span>
                <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lon2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lon2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lon2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">180</span><span class="p">:</span>
                <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;180&#39;</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">lonticks</span><span class="p">,</span> <span class="n">lonlabels</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="nb">min</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="nb">max</span>
        <span class="n">latrange</span> <span class="o">=</span> <span class="n">latmax</span> <span class="o">-</span> <span class="n">latmin</span>
        <span class="n">latstep</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
            <span class="n">latstep</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">latstep</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">latstep</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">latstep</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span> <span class="o">+</span> <span class="n">latstep</span><span class="p">,</span> <span class="n">latstep</span><span class="p">)</span>
        <span class="n">latticks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lats</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">&gt;=</span> <span class="n">latmin</span> <span class="ow">and</span> <span class="n">lat</span> <span class="o">&lt;=</span> <span class="n">latmax</span><span class="p">:</span>
                <span class="n">latticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>

        <span class="n">latlabels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">latticks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">latlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;S&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">latlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;N&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">latlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">latticks</span><span class="p">,</span> <span class="n">latlabels</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">timeaxis</span><span class="p">(</span><span class="n">dtimes</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | timeaxis is used to work out a sensible set of time labels and tick</span>
<span class="sd">     | marks given a time span  This is an internal routine and is not used</span>
<span class="sd">     | by the user.</span>

<span class="sd">     | dtimes=None - data times as a CF variable</span>

<span class="sd">     :Returns:</span>
<span class="sd">      time ticks and labels</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">time_units</span> <span class="o">=</span> <span class="n">dtimes</span><span class="o">.</span><span class="n">Units</span>

    <span class="n">time_ticks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">time_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Time&#39;</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">yearmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dtimes</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
        <span class="n">yearmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dtimes</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
        <span class="n">tmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dtimes</span><span class="o">.</span><span class="n">dtarray</span><span class="p">)</span>
        <span class="n">tmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dtimes</span><span class="o">.</span><span class="n">dtarray</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
            <span class="n">yearmin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
            <span class="n">yearmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
            <span class="n">tmin</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
            <span class="n">yearmin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
            <span class="n">yearmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
            <span class="n">tmin</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span>

    <span class="c1"># Years</span>
    <span class="n">span</span> <span class="o">=</span> <span class="n">yearmax</span> <span class="o">-</span> <span class="n">yearmin</span>
    <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">span</span> <span class="o">&lt;</span> <span class="mi">3000</span><span class="p">:</span>
        <span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Time (year)&#39;</span>
        <span class="n">tvals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">160</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">300</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">600</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">1300</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">200</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_year</span>

        <span class="n">years</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yearmax</span> <span class="o">/</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span>
        <span class="n">tvals</span> <span class="o">=</span> <span class="n">years</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">years</span> <span class="o">&gt;=</span> <span class="n">yearmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">years</span> <span class="o">&lt;=</span> <span class="n">yearmax</span><span class="p">))]</span>

        <span class="c1"># Catch tvals if not properly defined and use gvals to generate some</span>
        <span class="c1"># year tick marks</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">tvals</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">tvals</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">yearmin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">yearmax</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">tvals</span><span class="p">:</span>
            <span class="n">time_ticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
                <span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;-01-01 00:00:00&#39;</span><span class="p">),</span>
                 <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)))</span>
            <span class="n">time_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)))</span>

    <span class="c1"># Months</span>
    <span class="k">if</span> <span class="n">yearmax</span> <span class="o">-</span> <span class="n">yearmin</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>

        <span class="n">time_label</span> <span class="o">=</span> <span class="s1">&#39;Time (month and year)&#39;</span>
        <span class="n">months</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;Jan&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Feb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Mar&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Apr&#39;</span><span class="p">,</span>
            <span class="s1">&#39;May&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Jun&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Jul&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Aug&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Sep&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Oct&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Nov&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Dec&#39;</span><span class="p">]</span>

        <span class="c1"># Check number of labels with 1 month steps</span>
        <span class="n">tsteps</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yearmax</span> <span class="o">-</span> <span class="n">yearmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">yearmin</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
                <span class="n">mytime</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span>
                               <span class="nb">str</span><span class="p">(</span><span class="n">month</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-01 00:00:00&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mytime</span> <span class="o">&gt;=</span> <span class="n">tmin</span> <span class="ow">and</span> <span class="n">mytime</span> <span class="o">&lt;=</span> <span class="n">tmax</span><span class="p">:</span>
                    <span class="n">tsteps</span> <span class="o">=</span> <span class="n">tsteps</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">tsteps</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">:</span>
            <span class="n">mvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tsteps</span> <span class="o">&gt;=</span> <span class="mi">17</span><span class="p">:</span>
            <span class="n">mvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span>

        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yearmax</span> <span class="o">-</span> <span class="n">yearmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">yearmin</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">mvals</span><span class="p">:</span>
                <span class="n">mytime</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span>
                               <span class="nb">str</span><span class="p">(</span><span class="n">month</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-01 00:00:00&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mytime</span> <span class="o">&gt;=</span> <span class="n">tmin</span> <span class="ow">and</span> <span class="n">mytime</span> <span class="o">&lt;=</span> <span class="n">tmax</span><span class="p">:</span>
                    <span class="n">time_ticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">mytime</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)))</span>
                    <span class="n">time_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">months</span><span class="p">[</span><span class="n">month</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)))</span>

    <span class="c1"># Days and hours</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time_ticks</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">myday</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tmin</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmin</span><span class="o">.</span><span class="n">month</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmin</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>

        <span class="n">not_found</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">hour_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">span</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">not_found</span> <span class="o">&lt;=</span> <span class="mi">48</span><span class="p">:</span>
            <span class="n">mydate</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">myday</span><span class="p">,</span> <span class="n">dtimes</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span> <span class="o">+</span> \
                <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">hour_counter</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mydate</span> <span class="o">&gt;=</span> <span class="n">tmin</span> <span class="ow">and</span> <span class="n">mydate</span> <span class="o">&lt;=</span> <span class="n">tmax</span><span class="p">:</span>
                <span class="n">span</span> <span class="o">=</span> <span class="n">span</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">not_found</span> <span class="o">=</span> <span class="n">not_found</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">hour_counter</span> <span class="o">=</span> <span class="n">hour_counter</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">13</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">13</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">24</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">400</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">48</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">800</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">96</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_hour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_hour</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_day</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_day</span> <span class="o">*</span> <span class="mi">24</span>

        <span class="n">not_found</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">hour_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">span</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Time (day)&#39;</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;=</span> <span class="mi">24</span><span class="p">:</span>
            <span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Time (day and hour)&#39;</span>
        <span class="n">time_ticks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">time_labels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="n">not_found</span> <span class="o">&lt;=</span> <span class="mi">48</span><span class="p">:</span>
            <span class="n">mytime</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">myday</span><span class="p">,</span> <span class="n">dtimes</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span> <span class="o">+</span> \
                <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">hour_counter</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mytime</span> <span class="o">&gt;=</span> <span class="n">tmin</span> <span class="ow">and</span> <span class="n">mytime</span> <span class="o">&lt;=</span> <span class="n">tmax</span><span class="p">:</span>
                <span class="n">time_ticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mytime</span><span class="o">.</span><span class="n">array</span><span class="p">))</span>
                <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mytime</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> \
                    <span class="nb">str</span><span class="p">(</span><span class="n">mytime</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mytime</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">step</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">!=</span> <span class="n">step</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mytime</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:00:00&#39;</span>
                <span class="n">time_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">not_found</span> <span class="o">=</span> <span class="n">not_found</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">hour_counter</span> <span class="o">=</span> <span class="n">hour_counter</span> <span class="o">+</span> <span class="n">step</span>

    <span class="k">return</span><span class="p">(</span><span class="n">time_ticks</span><span class="p">,</span> <span class="n">time_labels</span><span class="p">,</span> <span class="n">axis_label</span><span class="p">)</span>


<div class="viewcode-block" id="ndecs"><a class="viewcode-back" href="../ndecs.html#cfplot.ndecs">[docs]</a><span class="k">def</span> <span class="nf">ndecs</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | ndecs finds the number of decimal places in an array.  Needed to make the</span>
<span class="sd">    | colour bar match the contour line labelling.</span>

<span class="sd">    | data=data - imput array of values</span>

<span class="sd">    :Returns:</span>
<span class="sd">    |  maximum number of necimal places</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">maxdecs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">number_decs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">number_decs</span> <span class="o">&gt;</span> <span class="n">maxdecs</span><span class="p">:</span>
                <span class="n">maxdecs</span> <span class="o">=</span> <span class="n">number_decs</span>

    <span class="k">return</span> <span class="n">maxdecs</span>

</div>
<div class="viewcode-block" id="axes"><a class="viewcode-back" href="../axes.html#cfplot.axes">[docs]</a><span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
         <span class="n">xstep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ystep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | axes is a function to set axes plotting parameters. The xstep and ystep</span>
<span class="sd">     | parameters are used to label the axes starting at the left hand side and</span>
<span class="sd">     | bottom of the plot respectively. For tighter control over labelling use</span>
<span class="sd">     | xticks, yticks to specify the tick positions and xticklabels,</span>
<span class="sd">     | yticklabels to specify the associated labels.</span>

<span class="sd">     | xstep=xstep - x axis step</span>
<span class="sd">     | ystep=ystep - y axis step</span>
<span class="sd">     | xlabel=xlabel - label for the x-axis</span>
<span class="sd">     | ylabel=ylabel - label for the y-axis</span>
<span class="sd">     | xticks=xticks - values for x ticks</span>
<span class="sd">     | xticklabels=xticklabels - labels for x tick marks</span>
<span class="sd">     | yticks=yticks - values for y ticks</span>
<span class="sd">     | yticklabels=yticklabels - labels for y tick marks</span>
<span class="sd">     | title=None - set title</span>
<span class="sd">     |</span>
<span class="sd">     | Use axes() to reset all the axes plotting attributes to the default.</span>

<span class="sd">     :Returns:</span>
<span class="sd">      None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span>
           <span class="n">xticks</span><span class="p">,</span> <span class="n">yticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="p">,</span> <span class="n">yticklabels</span><span class="p">,</span> <span class="n">xstep</span><span class="p">,</span> <span class="n">ystep</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span>
           <span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="p">]):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xstep</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ystep</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="o">=</span> <span class="n">xticks</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="o">=</span> <span class="n">yticks</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticklabels</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">xstep</span> <span class="o">=</span> <span class="n">xstep</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">ystep</span> <span class="o">=</span> <span class="n">ystep</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>

</div>
<span class="k">def</span> <span class="nf">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
              <span class="n">xstep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ystep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | axes_plot is a system function to specify axes plotting parameters.</span>
<span class="sd">     | The xstep and ystep parameters are used to label the axes starting at</span>
<span class="sd">     | the left hand side and bottom of the plot respectively. For tighter</span>
<span class="sd">     | control over labelling use xticks, yticks to specify the tick</span>
<span class="sd">     | positions and xticklabels, yticklabels to specify the associated</span>
<span class="sd">     | labels.</span>

<span class="sd">     | xstep=xstep - x axis step</span>
<span class="sd">     | ystep=ystep - y axis step</span>
<span class="sd">     | xlabel=xlabel - label for the x-axis</span>
<span class="sd">     | ylabel=ylabel - label for the y-axis</span>
<span class="sd">     | xticks=xticks - values for x ticks</span>
<span class="sd">     | xticklabels=xticklabels - labels for x tick marks</span>
<span class="sd">     | yticks=yticks - values for y ticks</span>
<span class="sd">     | yticklabels=yticklabels - labels for y tick marks</span>
<span class="sd">     | title=None - set title</span>
<span class="sd">     |</span>

<span class="sd">     :Returns:</span>
<span class="sd">      None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

    <span class="c1"># Retrieve any user set axes parameters</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">xticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xstep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">xstep</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xstep</span>
        <span class="n">xticks</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">xticklabels</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ystep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ystep</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ystep</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">yticklabels</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span>
    <span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span>
    <span class="n">axis_label_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span>
    <span class="k">if</span> <span class="n">title_fontsize</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">title_fontsize</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="k">if</span> <span class="n">text_fontsize</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">text_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="k">if</span> <span class="n">axis_label_fontsize</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">axis_label_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">axis_label_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span>
    <span class="n">title_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span>
    <span class="n">text_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span>

    <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                                 <span class="n">fontweight</span><span class="o">=</span><span class="n">axis_label_fontweight</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                                 <span class="n">fontweight</span><span class="o">=</span><span class="n">axis_label_fontweight</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xstep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ticks</span><span class="p">,</span> <span class="n">mult</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span>
                            <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="n">xstep</span><span class="p">)</span>

        <span class="n">plot_xticks</span> <span class="o">=</span> <span class="n">ticks</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">mult</span>
        <span class="n">plot_xticks_labels</span> <span class="o">=</span> <span class="n">plot_xticks</span>

    <span class="k">if</span> <span class="n">ystep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ticks</span><span class="p">,</span> <span class="n">mult</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span>
                            <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="n">ystep</span><span class="p">)</span>
        <span class="n">plot_yticks</span> <span class="o">=</span> <span class="n">ticks</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">mult</span>
        <span class="n">plot_yticks_labels</span> <span class="o">=</span> <span class="n">plot_yticks</span>

    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plot_xticks</span> <span class="o">=</span> <span class="n">xticks</span>
        <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">plot_xticks_labels</span> <span class="o">=</span> <span class="n">xticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_xticks_labels</span> <span class="o">=</span> <span class="n">xticks</span>

    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plot_yticks</span> <span class="o">=</span> <span class="n">yticks</span>
        <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">plot_yticks_labels</span> <span class="o">=</span> <span class="n">yticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_yticks_labels</span> <span class="o">=</span> <span class="n">yticks</span>

    <span class="c1"># Set the ticks and tick labels</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span>
            <span class="n">xticklabels</span><span class="p">,</span>
            <span class="n">rotation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_rotation</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_align</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span>
            <span class="n">yticklabels</span><span class="p">,</span>
            <span class="n">rotation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_rotation</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_align</span><span class="p">)</span>

    <span class="c1"># Set font size and weight</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">():</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">axis_label_fontsize</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">axis_label_fontweight</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">():</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">axis_label_fontsize</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">axis_label_fontweight</span><span class="p">)</span>

    <span class="c1"># Title</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="n">title</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>


<div class="viewcode-block" id="gset"><a class="viewcode-back" href="../gset.html#cfplot.gset">[docs]</a><span class="k">def</span> <span class="nf">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
         <span class="n">xlog</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | Set plot limits for all non longitude-latitide plots.</span>
<span class="sd">     | xmin, xmax, ymin, ymax are all needed to set the plot limits.</span>
<span class="sd">     | Set xlog/ylog to True or 1 to get a log axis.</span>
<span class="sd">     |</span>
<span class="sd">     | xmin=None - x minimum</span>
<span class="sd">     | xmax=None - x maximum</span>
<span class="sd">     | ymin=None - y minimum</span>
<span class="sd">     | ymax=None - y maximum</span>
<span class="sd">     | xlog=False - log x</span>
<span class="sd">     | ylog=False - log y</span>
<span class="sd">     |</span>
<span class="sd">     | Once a user call is made to gset the plot limits are persistent.</span>
<span class="sd">     | i.e. the next plot will use the same set of plot limits.</span>
<span class="sd">     | Use gset() to reset to undefined plot limits i.e. the full range</span>
<span class="sd">     | of the data.</span>
<span class="sd">     |</span>
<span class="sd">     | To set date axes use date strings i.e.</span>
<span class="sd">     | cfp.gset(xmin = &#39;170-1-1&#39;, xmax = &#39;300-1-1&#39;, ymin = 285,</span>
<span class="sd">     |          ymax = 295)</span>
<span class="sd">     |</span>

<span class="sd">     :Returns:</span>
<span class="sd">      None</span>

<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">=</span> <span class="n">user_gset</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xlog</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]):</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;gset error</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;xmin, xmax, ymin, ymax all need to be passed to gset</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;to set the plot limits</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="n">xmax</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="n">ymin</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">ymax</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">xlog</span> <span class="o">=</span> <span class="n">xlog</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span> <span class="o">=</span> <span class="n">ylog</span>

    <span class="c1"># Check if any axes are time strings</span>
    <span class="n">time_xstr</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">time_ystr</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">float</span><span class="p">(</span><span class="n">xmin</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">time_xstr</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">float</span><span class="p">(</span><span class="n">ymin</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">time_ystr</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c1"># Set plot limits</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">time_xstr</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">time_ystr</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span>
                <span class="p">[</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlog</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gopen"><a class="viewcode-back" href="../gopen.html#cfplot.gopen">[docs]</a><span class="k">def</span> <span class="nf">gopen</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">user_plot</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">,</span>
          <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;landscape&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">11.7</span><span class="p">,</span> <span class="mf">8.3</span><span class="p">],</span>
          <span class="n">left</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.92</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.92</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
          <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | gopen is used to open a graphic file.</span>
<span class="sd">     |</span>
<span class="sd">     | rows=1 - number of plot rows on the page</span>
<span class="sd">     | columns=1 - number of plot columns on the page</span>
<span class="sd">     | user_plot=1 - internal plot variable - do not use.</span>
<span class="sd">     | file=&#39;python&#39; - default file name</span>
<span class="sd">     | orientation=&#39;landscape&#39; - orientation - also takes &#39;portrait&#39;</span>
<span class="sd">     | figsize=[11.7, 8.3]  - figure size in inches</span>
<span class="sd">     | left=0.12 - left margin in normalised coordinates</span>
<span class="sd">     | right=0.92 - right margin in normalised coordinates</span>
<span class="sd">     | top=0.92 - top margin in normalised coordinates</span>
<span class="sd">     | bottom=0.08 - bottom margin in normalised coordinates</span>
<span class="sd">     | wspace=0.2 - width reserved for blank space between subplots</span>
<span class="sd">     | hspace=0.2 - height reserved for white space between subplots</span>



<span class="sd">     :Returns:</span>
<span class="sd">      None</span>

<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set values in globals</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
    <span class="k">if</span> <span class="nb">file</span> <span class="o">!=</span> <span class="s1">&#39;python&#39;</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="nb">file</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">orientation</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">=</span> <span class="n">user_plot</span>

    <span class="k">if</span> <span class="n">orientation</span> <span class="o">!=</span> <span class="s1">&#39;landscape&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">orientation</span> <span class="o">!=</span> <span class="s1">&#39;portrait&#39;</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;gopen error</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;orientation incorrectly set</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;input value was &#39;</span> <span class="o">+</span> <span class="n">orientation</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;Valid options are portrait or landscape</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Set master plot size</span>
    <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;landscape&#39;</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="c1"># Set margins</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
        <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
        <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
        <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span>
        <span class="n">bottom</span><span class="o">=</span><span class="n">bottom</span><span class="p">,</span>
        <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span>
        <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>

    <span class="c1"># Set initial subplot</span>
    <span class="n">gpos</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Change tick length for plots &gt; 2x2</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.major.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.major.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

</div>
<div class="viewcode-block" id="gclose"><a class="viewcode-back" href="../gclose.html#cfplot.gclose">[docs]</a><span class="k">def</span> <span class="nf">gclose</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | gclose saves a graphics file.  The default is to view the file as well</span>
<span class="sd">     | - use view=0 to turn this off.</span>

<span class="sd">     | view=True - view graphics file</span>

<span class="sd">     :Returns:</span>
<span class="sd">      None</span>

<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Reset the user_plot variable to off</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nb">file</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">file</span>
    <span class="k">if</span> <span class="nb">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">file</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.ps&#39;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.eps&#39;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.png&#39;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="nb">file</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
            <span class="nb">file</span><span class="p">,</span> <span class="n">papertype</span><span class="o">=</span><span class="s1">&#39;a4&#39;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">==</span> <span class="s1">&#39;display&#39;</span><span class="p">:</span>
            <span class="c1"># Use Imagemagick display command if this exists</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">disp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">tfile</span> <span class="o">=</span> <span class="s1">&#39;cfplot.png&#39;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                    <span class="n">tfile</span><span class="p">,</span> <span class="n">papertype</span><span class="o">=</span><span class="s1">&#39;a4&#39;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">disp</span><span class="p">,</span> <span class="n">tfile</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="s1">&#39;matplotlib&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Reset plotting</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="bp">None</span>

</div>
<span class="k">def</span> <span class="nf">showplot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="n">data</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1"># dir(plot)</span>
        <span class="c1"># plot=args[0]</span>


<div class="viewcode-block" id="gpos"><a class="viewcode-back" href="../gpos.html#cfplot.gpos">[docs]</a><span class="k">def</span> <span class="nf">gpos</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | Set plot position. Plots start at top left and increase by one each plot</span>
<span class="sd">     | to the right. When the end of the row has been reached then the next</span>
<span class="sd">     | plot will bed the leftmost plot on the next row down.</span>

<span class="sd">     | pos=pos - plot position</span>

<span class="sd">     :Returns:</span>
<span class="sd">      None</span>

<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check inputs are okay</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">*</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;pos error - pos out of range:</span><span class="se">\n</span><span class="s1"> range = 1 - &#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">*</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> input pos was &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">)</span>

    <span class="c1"># Set osition in global variables</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>

    <span class="c1"># if plotvars.user_plot == 0:</span>
    <span class="c1">#   if plotvars.user_gset == 1: gset(user_gset=plotvars.user_gset)</span>
    <span class="c1">#   gset(user_gset=plotvars.user_gset)</span>


<span class="c1">#######################################</span>
<span class="c1"># pcon - convert mb to km and vice-versa</span>
<span class="c1">#######################################</span>
</div>
<div class="viewcode-block" id="pcon"><a class="viewcode-back" href="../pcon.html#cfplot.pcon">[docs]</a><span class="k">def</span> <span class="nf">pcon</span><span class="p">(</span><span class="n">mb</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">km</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">7.0</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | pcon is a function for converting pressure to height in kilometers and</span>
<span class="sd">     | vice-versa. This function uses the equation P=P0exp(-z/H) to translate</span>
<span class="sd">     | between pressure and height. In pcon the surface pressure P0 is set to</span>
<span class="sd">     | 1000.0mb and the scale height H is set to 7.0. The value of H can vary</span>
<span class="sd">     | from 6.0 in the polar regions to 8.5 in the tropics as well as</span>
<span class="sd">     | seasonally. The value of P0 could also be said to be 1013.25mb rather</span>
<span class="sd">     | than 1000.0mb.</span>

<span class="sd">     | As this relationship is approximate:</span>
<span class="sd">     | (i) Only use this for making the axis labels on y axis pressure plots</span>
<span class="sd">     | (ii) Put the converted axis on the right hand side to indicate that</span>
<span class="sd">     |      this isn&#39;t the primary unit of measure</span>

<span class="sd">     | print cfp.pcon(mb=[1000, 300, 100, 30, 10, 3, 1, 0.3])</span>
<span class="sd">     | [0. 8.42780963 16.11809565 24.54590528 32.2361913</span>
<span class="sd">     |  40.66400093 48.35428695, 56.78209658]</span>

<span class="sd">     | mb=None - input pressure</span>
<span class="sd">     | km=None - input height</span>
<span class="sd">     | h=7.0 - default value for h</span>
<span class="sd">     | p0=1000 - default value for p0</span>

<span class="sd">     :Returns:</span>
<span class="sd">      | pressure(mb) if height(km) input,</span>
<span class="sd">      | height(km) if pressure(mb) input</span>
<span class="sd">     &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mb</span><span class="p">,</span> <span class="n">km</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;pcon error - pcon must have mb or km input</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mb</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">km</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">km</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p0</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="supscr"><a class="viewcode-back" href="../supscr.html#cfplot.supscr">[docs]</a><span class="k">def</span> <span class="nf">supscr</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | supscr - add superscript text formatting for ** and ^</span>
<span class="sd">     | This is an internal routine used in titles and colour bars</span>
<span class="sd">     | and not used by the user.</span>
<span class="sd">     | text=None - input text</span>

<span class="sd">     :Returns:</span>
<span class="sd">      Formatted text</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> supscr error - supscr must have text input</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="n">tform</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="n">sup</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;^&#39;</span><span class="p">):</span>
            <span class="n">sup</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">):</span>
            <span class="n">sup</span> <span class="o">=</span> <span class="n">sup</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">sup</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="n">i</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sup</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;*&#39;</span><span class="p">):</span>
                <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="n">i</span>
                <span class="n">sup</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sup</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="s1">&#39;-0123456789&#39;</span><span class="p">:</span>
                <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="n">i</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="s1">&#39;}$&#39;</span> <span class="o">+</span> <span class="n">i</span>
                <span class="n">sup</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sup</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="s1">&#39;$^{&#39;</span>
            <span class="n">sup</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">sup</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="s1">&#39;}$&#39;</span>

    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;m$^{2}$&#39;</span><span class="p">)</span>
    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;m3&#39;</span><span class="p">,</span> <span class="s1">&#39;m$^{3}$&#39;</span><span class="p">)</span>
    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;m-2&#39;</span><span class="p">,</span> <span class="s1">&#39;m$^{-2}$&#39;</span><span class="p">)</span>
    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;m-3&#39;</span><span class="p">,</span> <span class="s1">&#39;m$^{-3}$&#39;</span><span class="p">)</span>
    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;s-1&#39;</span><span class="p">,</span> <span class="s1">&#39;s$^{-1}$&#39;</span><span class="p">)</span>
    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;s-2&#39;</span><span class="p">,</span> <span class="s1">&#39;s$^{-2}$&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tform</span>

</div>
<div class="viewcode-block" id="gvals"><a class="viewcode-back" href="../gvals.html#cfplot.gvals">[docs]</a><span class="k">def</span> <span class="nf">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | gvals - work out a sensible set of values between two limits</span>
<span class="sd">     | This is an internal routine used for contour levels and axis</span>
<span class="sd">     | labelling and is not used by the user.</span>

<span class="sd">     | dmin=None - minimum</span>
<span class="sd">     | dmax=None - maximum</span>
<span class="sd">     | tight=0 - return values tight to input min and max</span>
<span class="sd">     | mystep=None - use this step</span>
<span class="sd">     | mod=1 - modify data to make use of a multipler</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> gvals error - gvals must have dmin and dmax input</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Return some values if dmin = dmax</span>
    <span class="k">if</span> <span class="n">dmin</span> <span class="o">==</span> <span class="n">dmax</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">dmin</span> <span class="o">-</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">dmin</span><span class="p">,</span> <span class="n">dmin</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">]</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">vals</span><span class="p">,</span> <span class="n">mult</span>

    <span class="c1"># Copies of inputs</span>
    <span class="n">dmin1</span> <span class="o">=</span> <span class="n">dmin</span>
    <span class="n">dmax1</span> <span class="o">=</span> <span class="n">dmax</span>
    <span class="n">dmin2</span> <span class="o">=</span> <span class="n">dmin</span>
    <span class="n">dmax2</span> <span class="o">=</span> <span class="n">dmax</span>

    <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># field multiplyer</span>

    <span class="c1"># Generate an inital step</span>
    <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">dmax</span> <span class="o">-</span> <span class="n">dmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">16.0</span>

    <span class="c1"># Don&#39;t modify if dmin1 and dmax1 are both negative as this will create a</span>
    <span class="c1"># race condition</span>
    <span class="k">if</span> <span class="n">dmin1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dmax1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">mod</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mystep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">mystep</span>

        <span class="k">if</span> <span class="n">step</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">dmax1</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">*</span> <span class="mf">10.0</span>
                <span class="n">dmin1</span> <span class="o">=</span> <span class="n">dmin1</span> <span class="o">*</span> <span class="mf">10.0</span>
                <span class="n">dmax1</span> <span class="o">=</span> <span class="n">dmax1</span> <span class="o">*</span> <span class="mf">10.0</span>
                <span class="n">mult</span> <span class="o">=</span> <span class="n">mult</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">dmax2</span> <span class="o">-</span> <span class="n">dmin2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span>
                        <span class="mi">2500</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">25000</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span>
                        <span class="mi">200000</span><span class="p">,</span> <span class="mi">250000</span><span class="p">,</span> <span class="mi">500000</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">]:</span>

                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">dmax2</span> <span class="o">-</span> <span class="n">dmin2</span><span class="p">)</span> <span class="o">/</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># print val, step, int(dmax2-dmin2)/val</span>

            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">dmax2</span> <span class="o">-</span> <span class="n">dmin2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000000</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">dmax2</span> <span class="o">-</span> <span class="n">dmin2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">16.0</span>

    <span class="c1"># Reset to user or mone zero values</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mystep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">mystep</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Make integer step</span>
    <span class="k">if</span> <span class="n">tight</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dmin1</span><span class="p">)</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">dmin1</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">step</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">dmax1</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">step</span><span class="p">)</span>

    <span class="c1"># Remove upper and lower limits if tight=0 - i.e. a contour plot</span>
    <span class="k">if</span> <span class="n">tight</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">dmax1</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">dmin1</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="c1"># Return values if inputs are integers</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dmin1</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dmax1</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">vals</span><span class="p">,</span> <span class="n">mult</span>

    <span class="k">if</span> <span class="n">mystep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">mystep</span><span class="p">)</span> <span class="o">==</span> <span class="n">mystep</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">vals</span><span class="p">,</span> <span class="n">mult</span>

    <span class="c1"># Floating point step</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mult</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">dmax1</span> <span class="o">-</span> <span class="n">dmin1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">16</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">vals</span><span class="p">,</span> <span class="n">mult</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">dmax1</span> <span class="o">-</span> <span class="n">dmin1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">16</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">dmax1</span> <span class="o">-</span> <span class="n">dmin1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">16</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mi">9</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mi">8</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mi">7</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span>
    <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mi">6</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span>
    <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span>
    <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mi">09</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mi">08</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mo">07</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mo">06</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mo">04</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mo">03</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="o">.</span><span class="mo">02</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">dmax1</span> <span class="o">-</span> <span class="n">dmin1</span> <span class="o">==</span> <span class="n">step</span><span class="p">):</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">/</span> <span class="mf">10.</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dmin1</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span><span class="p">))</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">step</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">dmax1</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">step</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">tight</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">dmax1</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">dmin1</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">vals</span><span class="p">,</span> <span class="n">mult</span>

</div>
<div class="viewcode-block" id="cf_data_assign"><a class="viewcode-back" href="../cf_data_assign.html#cfplot.cf_data_assign">[docs]</a><span class="k">def</span> <span class="nf">cf_data_assign</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | Check cf input data is okay and return data for contour plot.</span>
<span class="sd">     | This is an internal routine not used by the user.</span>
<span class="sd">     | f=None - input cf field</span>
<span class="sd">     | colorbar_title=None - input colour bar title</span>
<span class="sd">     | verbose=None - set to 1 to get a verbose idea of what the</span>
<span class="sd">     |          cf_data_assign is doing</span>

<span class="sd">     :Returns:</span>
<span class="sd">      | f - data for contouring</span>
<span class="sd">      | x - x coordinates of data (optional)</span>
<span class="sd">      | y - y coordinates of data (optional)</span>
<span class="sd">      | ptype - plot type</span>
<span class="sd">      | colorbar_title - colour bar title</span>
<span class="sd">      | xlabel - x label for plot</span>
<span class="sd">      | ylabel - y label for plot</span>
<span class="sd">      |</span>
<span class="sd">      |</span>
<span class="sd">      |</span>
<span class="sd">      |</span>
<span class="sd">      |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check input data has the correct number of dimensions</span>
    <span class="c1"># Take into account rotated pole fields having extra dimensions</span>
    <span class="n">ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;rotated_latitude_longitude&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">print</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;cf_data_assign error - data has too many dimensions&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;cf_data_assign error - data has too few dimensions&#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> cf-plot requires one or two dimensional data</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">sn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
                <span class="n">ln</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;long_name&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sn</span><span class="p">:</span>
                    <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> \
                        <span class="nb">str</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> \
                        <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ln</span><span class="p">:</span>
                        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> \
                            <span class="nb">str</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> \
                            <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Set up data arrays and variables</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">height</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">time</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">has_lons</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">has_lats</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">has_height</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">has_time</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">xpole</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">ypole</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">ptype</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># Extract coordinate data if a matching CF standard_name or axis is found</span>
    <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">sn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">,</span> <span class="s1">&#39;NoName&#39;</span><span class="p">)</span>
        <span class="n">an</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;axis&#39;</span><span class="p">,</span> <span class="s1">&#39;NoName&#39;</span><span class="p">)</span>

        <span class="n">standard_name_x</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="s1">&#39;cf_data_assign standard_name, axis - assigned &#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sn</span> <span class="ow">in</span> <span class="n">standard_name_x</span> <span class="ow">or</span> <span class="n">an</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">vs</span> <span class="o">+</span> <span class="s1">&#39;lons -&#39;</span><span class="p">,</span> <span class="n">sn</span><span class="p">,</span> <span class="n">an</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

        <span class="n">standard_name_y</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sn</span> <span class="ow">in</span> <span class="n">standard_name_y</span> <span class="ow">or</span> <span class="n">an</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">vs</span> <span class="o">+</span> <span class="s1">&#39;lats -&#39;</span><span class="p">,</span> <span class="n">sn</span><span class="p">,</span> <span class="n">an</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

        <span class="n">standard_name_z</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">,</span> <span class="s1">&#39;air_pressure&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="s1">&#39;depth&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sn</span> <span class="ow">in</span> <span class="n">standard_name_z</span> <span class="ow">or</span> <span class="n">an</span> <span class="o">==</span> <span class="s1">&#39;Z&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">vs</span> <span class="o">+</span> <span class="s1">&#39;height -&#39;</span><span class="p">,</span> <span class="n">sn</span><span class="p">,</span> <span class="n">an</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

        <span class="n">standard_name_t</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sn</span> <span class="ow">in</span> <span class="n">standard_name_t</span> <span class="ow">or</span> <span class="n">an</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">vs</span> <span class="o">+</span> <span class="s1">&#39;time -&#39;</span><span class="p">,</span> <span class="n">sn</span><span class="p">,</span> <span class="n">an</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

    <span class="c1"># CF defined units</span>
    <span class="n">lon_units</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;degrees_east&#39;</span><span class="p">,</span>
        <span class="s1">&#39;degree_east&#39;</span><span class="p">,</span>
        <span class="s1">&#39;degree_E&#39;</span><span class="p">,</span>
        <span class="s1">&#39;degrees_E&#39;</span><span class="p">,</span>
        <span class="s1">&#39;degreeE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;degreesE&#39;</span><span class="p">]</span>
    <span class="n">lat_units</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;degrees_north&#39;</span><span class="p">,</span>
        <span class="s1">&#39;degree_north&#39;</span><span class="p">,</span>
        <span class="s1">&#39;degree_N&#39;</span><span class="p">,</span>
        <span class="s1">&#39;degrees_N&#39;</span><span class="p">,</span>
        <span class="s1">&#39;degreeN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;degreesN&#39;</span><span class="p">]</span>
    <span class="n">height_units</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mb&#39;</span><span class="p">,</span> <span class="s1">&#39;mbar&#39;</span><span class="p">,</span> <span class="s1">&#39;millibar&#39;</span><span class="p">,</span> <span class="s1">&#39;decibar&#39;</span><span class="p">,</span> <span class="s1">&#39;atmosphere&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;atm&#39;</span><span class="p">,</span> <span class="s1">&#39;pascal&#39;</span><span class="p">,</span> <span class="s1">&#39;Pa&#39;</span><span class="p">,</span> <span class="s1">&#39;hPa&#39;</span><span class="p">,</span> <span class="s1">&#39;meter&#39;</span><span class="p">,</span> <span class="s1">&#39;metre&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;kilometer&#39;</span><span class="p">,</span> <span class="s1">&#39;kilometre&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">]</span>
    <span class="n">time_units</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;hours&#39;</span><span class="p">,</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;minute&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;minutes&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;mins&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">,</span> <span class="s1">&#39;sec&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;secs&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">]</span>

    <span class="c1"># Extract coordinate data if a matching CF set of units is found</span>
    <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">units</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="n">lon_units</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lons</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s1">&#39;cf_data_assign units - assigned lons -&#39;</span><span class="p">,</span> <span class="n">units</span>
                <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="n">lat_units</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lats</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s1">&#39;cf_data_assign units - assigned lats -&#39;</span><span class="p">,</span> <span class="n">units</span>
                <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="n">height_units</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s1">&#39;cf_data_assign units - assigned height -&#39;</span><span class="p">,</span> <span class="n">units</span>
                <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="n">time_units</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s1">&#39;cf_data_assign units - assigned time -&#39;</span><span class="p">,</span> <span class="n">units</span>
                <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

    <span class="c1"># Extract coordinate data from variable name if not already assigned</span>
    <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">mydim</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;dim&#39;</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="s1">&#39;cf_data_assign dimension name - assigned &#39;</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lons</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span> <span class="n">vs</span> <span class="o">+</span> <span class="n">lons</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">name</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lats</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span> <span class="n">vs</span><span class="o">+</span><span class="n">lats</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">name</span>
                    <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;theta&#39;</span> <span class="ow">or</span>
                    <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span> <span class="ow">or</span>
                    <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;air_pressure&#39;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                                <span class="k">print</span> <span class="n">vs</span><span class="o">+</span><span class="n">height</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">name</span>
                            <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span> <span class="n">vs</span><span class="o">+</span><span class="n">time</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">name</span>
                    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">has_lons</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">has_lats</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">has_height</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">has_time</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># assign field data</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

    <span class="c1"># Check what plot type is required.</span>
    <span class="c1"># 0=simple contour plot, 1=map plot, 2=latitude-height plot,</span>
    <span class="c1"># 3=longitude-time plot, 4=latitude-time plot.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lons</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">lats</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lats</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">height</span>
        <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span>
                <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">xunits</span> <span class="ow">in</span> <span class="n">lat_units</span><span class="p">):</span>
                    <span class="n">xunits</span> <span class="o">=</span> <span class="s1">&#39;degrees&#39;</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">xunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span> <span class="ow">or</span> <span class="n">name</span><span class="p">[</span>
                    <span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;theta&#39;</span> <span class="ow">or</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span>
                <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">yunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lons</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">height</span>
        <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span>
                <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">xunits</span> <span class="ow">in</span> <span class="n">lon_units</span><span class="p">):</span>
                    <span class="n">xunits</span> <span class="o">=</span> <span class="s1">&#39;degrees&#39;</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">xunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span> <span class="ow">or</span> <span class="n">name</span><span class="p">[</span>
                    <span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;theta&#39;</span> <span class="ow">or</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span>
                <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">yunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lons</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">time</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lats</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">time</span>

    <span class="c1"># Rotated pole</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;rotated_latitude_longitude&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="n">rotated_pole</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;rotated_latitude_longitude&#39;</span><span class="p">)</span>
        <span class="n">xpole</span> <span class="o">=</span> <span class="n">rotated_pole</span><span class="p">[</span><span class="s1">&#39;grid_north_pole_longitude&#39;</span><span class="p">]</span>
        <span class="n">ypole</span> <span class="o">=</span> <span class="n">rotated_pole</span><span class="p">[</span><span class="s1">&#39;grid_north_pole_latitude&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">mydim</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;dim&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                           <span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">))[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                    <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                           <span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">))[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                    <span class="c1"># Flip y and data if reversed</span>
                    <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                    <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="n">yunits</span>

    <span class="c1"># time height plot</span>
    <span class="k">if</span> <span class="n">has_height</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">has_time</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">mydim</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;dim&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                           <span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">))[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                    <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="n">xunits</span>

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                           <span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">))[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                    <span class="n">yunits</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="n">yunits</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>
                    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="n">yunits</span>

        <span class="c1"># Rotate array to get it as time vs height</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="c1"># None of the above</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">mydim</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;dim&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                           <span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">))[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                    <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="n">xunits</span>

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                           <span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">))[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                    <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="n">yunits</span>

    <span class="c1"># Assign colorbar_title</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">colorbar_title</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;No Name&#39;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">):</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">id</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;ncvar&#39;</span><span class="p">):</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">ncvar</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;short_name&#39;</span><span class="p">):</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">short_name</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">):</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">long_name</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">):</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">standard_name</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;Units&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">colorbar_title</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">colorbar_title</span> <span class="o">+</span> \
                    <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">supscr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Units</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

    <span class="c1"># Return data</span>
    <span class="k">return</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="check_data"><a class="viewcode-back" href="../check_data.html#cfplot.check_data">[docs]</a><span class="k">def</span> <span class="nf">check_data</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | check_data - check user input contour data is correct.</span>
<span class="sd">     | This is an internal routine and is not used by the user.</span>
<span class="sd">     |</span>
<span class="sd">     | field=None - field</span>
<span class="sd">     | x=None - x points for field</span>
<span class="sd">     | y=None - y points for field</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Input error trapping</span>
    <span class="n">args</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;con error - a field for contouring must be &#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;passed with the f= flag</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;con error - x coordinates must be passed &#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;with the x= flag</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;con error - y coordinates must be passed &#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;with the y= flag</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Check input dimensions look okay.</span>
    <span class="c1"># All inputs 2D</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">xpts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">xpts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">ypts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">ypts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span>

    <span class="c1"># Field x and y all 1D</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span>

    <span class="c1"># Field 2D, x and y 1D</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;Input arguments incorrectly shaped:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;x has shape:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;y has shape:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;field has shape&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;Expected x=xpts, y=ypts, field=(ypts,xpts)</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;x=npts, y=npts, field=npts</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> \
            <span class="s1">&#39;or x=[ypts, xpts], y=[ypts, xpts], field=[ypts, xpts]</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="cscale"><a class="viewcode-back" href="../cscale.html#cfplot.cscale">[docs]</a><span class="k">def</span> <span class="nf">cscale</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">white</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">below</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
           <span class="n">above</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">uniform</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | cscale - choose and manipulate colour maps.  Around 200 colour scales are</span>
<span class="sd">    |          available - see the gallery section for more details.</span>
<span class="sd">    |</span>
<span class="sd">    | cmap=None - name of colour map</span>
<span class="sd">    | ncols=None - number of colours for colour map</span>
<span class="sd">    | white=None - change these colours to be white</span>
<span class="sd">    | below=None - change the number of colours below the mid point of</span>
<span class="sd">    |               the colour scale to be this</span>
<span class="sd">    | above=None - change the number of colours above the mid point of</span>
<span class="sd">    |               the colour scale to be this</span>
<span class="sd">    | reverse=False - reverse the colour scale</span>
<span class="sd">    | uniform=False - produce a uniform colour scale.</span>
<span class="sd">    |                 For example: if below=3 and above=10 are specified</span>
<span class="sd">    |                 then initially below=10 and above=10 are used.  The</span>
<span class="sd">    |                 colour scale is then cropped to use scale colours</span>
<span class="sd">    |                 6 to 19.</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    | Personal colour maps are available by saving the map as red green blue</span>
<span class="sd">    | to a file with a set of values on each line.</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    | Use cscale() To reset to the default settings.</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">        None</span>

<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># If no map requested reset to default</span>
    <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;scale1&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cs_user</span> <span class="o">=</span> <span class="n">cmap</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">ncols</span><span class="p">,</span> <span class="n">white</span><span class="p">,</span> <span class="n">below</span><span class="p">,</span> <span class="n">above</span><span class="p">,</span> <span class="n">reverse</span><span class="p">,</span> <span class="n">uniform</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">):</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s1">&#39;scale1&#39;</span> <span class="ow">or</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s1">&#39;scale1&#39;</span><span class="p">:</span>
            <span class="n">myscale</span> <span class="o">=</span> <span class="n">cscale1</span>
        <span class="k">if</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s1">&#39;viridis&#39;</span><span class="p">:</span>
            <span class="n">myscale</span> <span class="o">=</span> <span class="n">viridis</span>
        <span class="c1"># convert cscale1 or viridis from hex to rgb</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">myhex</span> <span class="ow">in</span> <span class="n">myscale</span><span class="p">:</span>
            <span class="n">myhex</span> <span class="o">=</span> <span class="n">myhex</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
            <span class="n">mylen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">myhex</span><span class="p">)</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">myhex</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">mylen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mylen</span><span class="p">,</span> <span class="n">mylen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">distutils.sysconfig</span> <span class="kn">as</span> <span class="nn">sysconfig</span>

        <span class="n">package_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">package_path</span><span class="p">,</span> <span class="s1">&#39;colourmaps/&#39;</span> <span class="o">+</span> <span class="n">cmap</span> <span class="o">+</span> <span class="s1">&#39;.rgb&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">cscale error - colour scale not found:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;File &#39;</span> <span class="o">+</span> <span class="nb">file</span> <span class="o">+</span> <span class="s1">&#39; not found</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;File &#39;</span> <span class="o">+</span> <span class="n">cmap</span> <span class="o">+</span> <span class="s1">&#39; not found</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">file</span> <span class="o">=</span> <span class="n">cmap</span>

        <span class="c1"># Read in rgb values and convert to hex</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">hex</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="c1"># Reverse the colour scale if requested</span>
    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Interpolate to a new number of colours if requested</span>
    <span class="k">if</span> <span class="n">ncols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">f_red</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">f_green</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
        <span class="n">f_blue</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">f_red</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">f_green</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">f_blue</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>

    <span class="c1"># Change the number of colours below and above the mid-point if requested</span>
    <span class="k">if</span> <span class="n">below</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">above</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

        <span class="c1"># Mid-point of colour scale</span>
        <span class="n">npoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Below mid point x locations</span>
        <span class="n">x_below</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">below</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x_below</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">below</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">below</span>
        <span class="k">if</span> <span class="n">below</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">npoints</span>
        <span class="k">if</span> <span class="n">below</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">uniform</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">above</span><span class="p">,</span> <span class="n">below</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lower</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">x_below</span> <span class="o">=</span> <span class="p">((</span><span class="n">npoints</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">lower</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>

        <span class="c1"># Above mid point x locations</span>
        <span class="n">x_above</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">above</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x_above</span> <span class="o">=</span> <span class="n">npoints</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">above</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">above</span>
        <span class="k">if</span> <span class="n">above</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">npoints</span>
        <span class="k">if</span> <span class="n">above</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">uniform</span><span class="p">:</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">above</span><span class="p">,</span> <span class="n">below</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">upper</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">x_above</span> <span class="o">=</span> <span class="p">((</span><span class="n">npoints</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span> <span class="o">+</span> <span class="n">npoints</span>

        <span class="c1"># Append new colour positions</span>
        <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_below</span><span class="p">,</span> <span class="n">x_above</span><span class="p">)</span>

        <span class="c1"># Interpolate to new colour scale</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        <span class="n">f_red</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">f_green</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
        <span class="n">f_blue</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">f_red</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">f_green</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">f_blue</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>

        <span class="c1"># Reset colours if uniform is set</span>
        <span class="k">if</span> <span class="n">uniform</span><span class="p">:</span>
            <span class="n">mid_pt</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">below</span><span class="p">,</span> <span class="n">above</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">mid_pt</span> <span class="o">-</span> <span class="n">below</span><span class="p">:</span><span class="n">mid_pt</span> <span class="o">+</span> <span class="n">above</span><span class="p">]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">mid_pt</span> <span class="o">-</span> <span class="n">below</span><span class="p">:</span><span class="n">mid_pt</span> <span class="o">+</span> <span class="n">above</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">mid_pt</span> <span class="o">-</span> <span class="n">below</span><span class="p">:</span><span class="n">mid_pt</span> <span class="o">+</span> <span class="n">above</span><span class="p">]</span>

    <span class="c1"># Convert to hex</span>
    <span class="nb">hex</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">)):</span>
        <span class="nb">hex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#</span><span class="si">%02x%02x%02x</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">col</span><span class="p">]))</span>

    <span class="c1"># White requested colour positions</span>
    <span class="k">if</span> <span class="n">white</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ccols</span> <span class="o">=</span> <span class="n">white</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">white</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">hex</span><span class="p">[</span><span class="n">white</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">white</span><span class="p">:</span>
                <span class="nb">hex</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span>

    <span class="c1"># Set colour scale</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="nb">hex</span>

</div>
<div class="viewcode-block" id="cscale_get_map"><a class="viewcode-back" href="../cscale_get_map.html#cfplot.cscale_get_map">[docs]</a><span class="k">def</span> <span class="nf">cscale_get_map</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | cscale_get_map - return colour map for use in contour plots.</span>
<span class="sd">    |                   This depends on the colour bar extensions</span>
<span class="sd">    | This is an internal routine and is not used by the user.</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">        colour map</span>

<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cscale_ncols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">cscale_ncols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">):</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">):</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[:</span><span class="n">cscale_ncols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;neither&#39;</span><span class="p">):</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">colmap</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="bfill"><a class="viewcode-back" href="../bfill.html#cfplot.bfill">[docs]</a><span class="k">def</span> <span class="nf">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | bfill - block fill a field with colour rectangles</span>
<span class="sd">     | This is an internal routine and is not used by the user.</span>
<span class="sd">     |</span>
<span class="sd">     | f=None - field</span>
<span class="sd">     | x=None - x points for field</span>
<span class="sd">     | y=None - y points for field</span>
<span class="sd">     | clevs=None - levels for filling</span>
<span class="sd">     | lonlat=False - lonlat data</span>
<span class="sd">     | bound=False - x and y are cf data boundaries</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">        None</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Assign f to field as this may be modified in lat-lon plots</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">f</span>

    <span class="c1"># Add in extra levels for colour bar extensions if present.</span>
    <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">levs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1e30</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">levs</span><span class="p">,</span> <span class="mf">1e30</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">bound</span><span class="p">:</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">y</span>

    <span class="k">if</span> <span class="n">bound</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Find x box boundaries</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>

        <span class="c1"># Find y box boundaries</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>

    <span class="c1"># Shift lon grid if needed</span>
    <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>

        <span class="c1"># Extract upper bound and original rhs of box longitude bounding points</span>
        <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">ypts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xpts_orig</span> <span class="o">=</span> <span class="n">xpts</span>
        <span class="n">ypts_orig</span> <span class="o">=</span> <span class="n">ypts</span>

        <span class="c1"># Reduce xpts and ypts by 1 or shiftgrid fails</span>
        <span class="c1"># The last points are the right / upper bounds for the last data box</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">):</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span> <span class="o">-</span> <span class="mi">360</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">):</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span> <span class="o">+</span> <span class="mi">360</span>

        <span class="c1"># Add cyclic information if missing.</span>
        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
            <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span> <span class="o">=</span> <span class="n">addcyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">)</span>

        <span class="c1"># shiftgrid on lons and data</span>
        <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span> <span class="o">=</span> <span class="n">shiftgrid</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">)</span>

        <span class="n">right_bound</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

        <span class="c1"># Add end x and y end points</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">right_bound</span><span class="p">)</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>

    <span class="c1"># Make plot</span>
    <span class="c1"># Set colour map</span>
    <span class="n">cmin</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
        <span class="n">cmin</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
        <span class="n">cmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">cmin</span><span class="p">:</span><span class="n">cmax</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
        <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
        <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="n">ncolors</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="regrid"><a class="viewcode-back" href="../regrid.html#cfplot.regrid">[docs]</a><span class="k">def</span> <span class="nf">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | regrid - bilinear interpolation of a grid to new grid locations</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |     f=None - original field</span>
<span class="sd">     |     x=None - original field x values</span>
<span class="sd">     |     y=None - original field y values</span>
<span class="sd">     |     xnew=None - new x points</span>
<span class="sd">     |     ynew=None - new y points</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">        field values at requested locations</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># reassign input arrays</span>
    <span class="n">regrid_f</span> <span class="o">=</span> <span class="n">f</span>
    <span class="n">regrid_x</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">regrid_y</span> <span class="o">=</span> <span class="n">y</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

    <span class="n">fieldout</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Reverse xpts and field if necessary</span>
    <span class="k">if</span> <span class="n">regrid_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">regrid_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">regrid_x</span> <span class="o">=</span> <span class="n">regrid_x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">regrid_f</span><span class="p">)</span>

    <span class="c1"># Reverse ypts and field if necessary</span>
    <span class="k">if</span> <span class="n">regrid_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">regrid_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">regrid_y</span> <span class="o">=</span> <span class="n">regrid_y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">regrid_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">regrid_f</span><span class="p">)</span>

    <span class="c1"># Iterate over the new grid to get the new grid values.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xnew</span><span class="p">)):</span>

        <span class="n">xval</span> <span class="o">=</span> <span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">yval</span> <span class="o">=</span> <span class="n">ynew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Find position of new grid point in the x and y arrays</span>
        <span class="n">myxpos</span> <span class="o">=</span> <span class="n">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">regrid_x</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">xval</span><span class="p">)</span>
        <span class="n">myypos</span> <span class="o">=</span> <span class="n">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">regrid_y</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">yval</span><span class="p">)</span>

        <span class="n">myxpos2</span> <span class="o">=</span> <span class="n">myxpos</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">myypos2</span> <span class="o">=</span> <span class="n">myypos</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">myxpos2</span> <span class="o">!=</span> <span class="n">myxpos</span><span class="p">):</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos</span><span class="p">])</span> <span class="o">/</span> \
                <span class="p">(</span><span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos2</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1E-30</span>

        <span class="n">newval1</span> <span class="o">=</span> <span class="p">(</span><span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos</span><span class="p">,</span> <span class="n">myxpos</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos</span><span class="p">,</span> <span class="n">myxpos2</span><span class="p">])</span>
        <span class="n">newval1</span> <span class="o">=</span> <span class="n">newval1</span> <span class="o">*</span> <span class="n">alpha</span>
        <span class="n">newval1</span> <span class="o">=</span> <span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos</span><span class="p">,</span> <span class="n">myxpos</span><span class="p">]</span> <span class="o">-</span> <span class="n">newval1</span>

        <span class="n">newval2</span> <span class="o">=</span> <span class="p">(</span><span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos2</span><span class="p">,</span> <span class="n">myxpos</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos2</span><span class="p">,</span> <span class="n">myxpos2</span><span class="p">])</span>
        <span class="n">newval2</span> <span class="o">=</span> <span class="n">newval2</span> <span class="o">*</span> <span class="n">alpha</span>
        <span class="n">newval2</span> <span class="o">=</span> <span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos2</span><span class="p">,</span> <span class="n">myxpos</span><span class="p">]</span> <span class="o">-</span> <span class="n">newval2</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">myypos2</span> <span class="o">!=</span> <span class="n">myypos</span><span class="p">):</span>
            <span class="n">alpha2</span> <span class="o">=</span> <span class="p">(</span><span class="n">ynew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos</span><span class="p">])</span>
            <span class="n">alpha2</span> <span class="o">=</span> <span class="n">alpha2</span> <span class="o">/</span> <span class="p">(</span><span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos2</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha2</span> <span class="o">=</span> <span class="p">(</span><span class="n">ynew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1E-30</span>

        <span class="n">newval3</span> <span class="o">=</span> <span class="n">newval1</span> <span class="o">-</span> <span class="p">(</span><span class="n">newval1</span> <span class="o">-</span> <span class="n">newval2</span><span class="p">)</span> <span class="o">*</span> <span class="n">alpha2</span>

        <span class="n">fieldout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fieldout</span><span class="p">,</span> <span class="n">newval3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fieldout</span>

</div>
<div class="viewcode-block" id="stipple"><a class="viewcode-back" href="../stipple.html#cfplot.stipple">[docs]</a><span class="k">def</span> <span class="nf">stipple</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | stipple - put dots on the plot to indicate value of interest</span>
<span class="sd">     |</span>
<span class="sd">     | f=None - cf field or field</span>
<span class="sd">     | x=None - x points for field</span>
<span class="sd">     | y=None - y points for field</span>
<span class="sd">     | min=None - minimum threshold for stipple</span>
<span class="sd">     | max=None - maximum threshold for stipple</span>
<span class="sd">     | size=80 - default size for stipples</span>
<span class="sd">     | color=&#39;k&#39; - default colour for stipples</span>
<span class="sd">     | pts=50 - number of points in the x direction</span>
<span class="sd">     | marker=&#39;.&#39; - default marker for stipples</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">        None</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Extract required data for contouring</span>
    <span class="c1"># If a cf-python field</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> \
            <span class="n">ypole</span> <span class="o">=</span> <span class="n">cf_data_assign</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">f</span>  <span class="c1"># field data passed in as f</span>
        <span class="n">check_data</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">y</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Cylindrical projection</span>
        <span class="c1"># Add cyclic information if missing.</span>
        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
            <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span> <span class="o">=</span> <span class="n">addcyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">)</span>

        <span class="c1"># Shift grid if needed</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">):</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span> <span class="o">-</span> <span class="mi">360</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">):</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span> <span class="o">+</span> <span class="mi">360</span>

        <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span> <span class="o">=</span> <span class="n">shiftgrid</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
            <span class="c1"># Calculate interpolation points</span>
            <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span> <span class="o">=</span> <span class="n">stipple_points</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span>
                                        <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span>
                                        <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ypts</span><span class="p">),</span>
                                        <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ypts</span><span class="p">),</span>
                                        <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Calculate points in map space</span>
            <span class="n">xnew_map</span><span class="p">,</span> <span class="n">ynew_map</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
            <span class="c1"># Calculate interpolation points</span>
            <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">,</span> <span class="n">xnew_map</span><span class="p">,</span> <span class="n">ynew_map</span> <span class="o">=</span> <span class="n">polar_regular_grid</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># Calculate interpolation points</span>

        <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span> <span class="o">=</span> <span class="n">stipple_points</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span>
                                    <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span>
                                    <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ypts</span><span class="p">),</span>
                                    <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ypts</span><span class="p">),</span>
                                    <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Get values at the new points</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>

    <span class="c1"># Work out which of the points are valid</span>
    <span class="n">valid_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">vals</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">min</span> <span class="ow">and</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">:</span>
            <span class="n">valid_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_points</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">xnew_map</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span>
            <span class="n">ynew_map</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">xnew</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span>
            <span class="n">ynew</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="stipple_points"><a class="viewcode-back" href="../stipple_points.html#cfplot.stipple_points">[docs]</a><span class="k">def</span> <span class="nf">stipple_points</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                   <span class="n">ymax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | stipple_points - calculate interpolation points</span>
<span class="sd">     |</span>
<span class="sd">     | xmin=None - plot x minimum</span>
<span class="sd">     | ymax=None - plot x maximum</span>
<span class="sd">     | ymin=None - plot y minimum</span>
<span class="sd">     | ymax=None - plot x maximum</span>
<span class="sd">     | pts=None -  number of points in the x and y directions</span>
<span class="sd">     |             one number gives the same in both directions</span>
<span class="sd">     |</span>
<span class="sd">     | stype=None - type of grid.  1=regular, 2=offset</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">        stipple locations in x and y</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Work out number of points in x and y directions</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">pts_x</span> <span class="o">=</span> <span class="n">pts</span>
        <span class="n">pts_y</span> <span class="o">=</span> <span class="n">pts</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">pts_x</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pts_y</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Create regularly spaced points</span>
    <span class="n">xstep</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">pts_x</span><span class="p">)</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span> <span class="o">+</span> <span class="n">xstep</span> <span class="o">/</span> <span class="mi">4</span><span class="p">]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xstep</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">xmax</span> <span class="o">-</span> <span class="n">xstep</span> <span class="o">/</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xstep</span><span class="p">)</span>
    <span class="n">nxpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>

    <span class="n">x2</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span> <span class="o">+</span> <span class="n">xstep</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span><span class="p">]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span> <span class="o">+</span> <span class="n">xstep</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">xmax</span> <span class="o">-</span> <span class="n">xstep</span> <span class="o">/</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span> <span class="o">+</span> <span class="n">xstep</span><span class="p">)</span>

    <span class="n">ystep</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">pts_y</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">ymin</span> <span class="o">+</span> <span class="n">ystep</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span> <span class="o">+</span> <span class="n">ystep</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ymax</span> <span class="o">-</span> <span class="n">ystep</span> <span class="o">/</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span> <span class="o">+</span> <span class="n">ystep</span><span class="p">)</span>

    <span class="c1"># Create interpolation points</span>
    <span class="n">xnew</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ynew</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">iy</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">y1</span><span class="p">:</span>
        <span class="n">iy</span> <span class="o">=</span> <span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">stype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x1</span><span class="p">))</span>
            <span class="n">y2</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">ynew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynew</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">stype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">iy</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x1</span><span class="p">))</span>
                <span class="n">y2</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">ynew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynew</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">iy</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x2</span><span class="p">))</span>
                <span class="n">y2</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">ynew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynew</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span>

</div>
<div class="viewcode-block" id="find_pos_in_array"><a class="viewcode-back" href="../find_pos_in_array.html#cfplot.find_pos_in_array">[docs]</a><span class="k">def</span> <span class="nf">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | find_pos_in_array - find the position of a point in an array</span>
<span class="sd">     |</span>
<span class="sd">     | vals - array values</span>
<span class="sd">     | val - value to find position of</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">       position in array</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">above</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">myval</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">myval</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">above</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">myval</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="n">myval</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">pos</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">pos</span>

</div>
<div class="viewcode-block" id="vect"><a class="viewcode-back" href="../vect.html#cfplot.vect">[docs]</a><span class="k">def</span> <span class="nf">vect</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
         <span class="n">key_length</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">key_label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
         <span class="n">width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">headlength</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">headaxislength</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
         <span class="n">pivot</span><span class="o">=</span><span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="n">key_location</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06</span><span class="p">],</span> <span class="n">key_show</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
         <span class="n">xaxis</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
         <span class="n">yticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | vect - plot vectors</span>
<span class="sd">     |</span>
<span class="sd">     | u=None - u wind</span>
<span class="sd">     | v=None - v wind</span>
<span class="sd">     | x=None - x locations of u and v</span>
<span class="sd">     | y=None - y locations of u and v</span>
<span class="sd">     | scale=None - data units per arrow length unit.  A smaller values gives</span>
<span class="sd">     |              a larger vector. Generally takes one value but in the case</span>
<span class="sd">     |              of two supplied values the second vector scaling applies to</span>
<span class="sd">     |              the v field.</span>
<span class="sd">     | stride=None - plot vector every stride points. Can take two values one</span>
<span class="sd">     |               for x and one for y.</span>
<span class="sd">     | pts=None - use bilinear interpolation to interpolate vectors onto a new</span>
<span class="sd">     |            grid - takes one or two values.</span>
<span class="sd">     |            If one value is passed then this is used for both the x and</span>
<span class="sd">     |            y axes.</span>
<span class="sd">     | key_length=None - length of the key.  Generally takes one value but in</span>
<span class="sd">     |                   the case of two supplied values the second vector</span>
<span class="sd">     |                   scaling applies to the v field.</span>
<span class="sd">     | key_label=None - label for the key. Generally takes one value but in the</span>
<span class="sd">     |                  case of two supplied values the second vector scaling</span>
<span class="sd">     |                  applies to the v field.</span>
<span class="sd">     | key_location=[0.9, -0.06] - location of the vector key relative to the</span>
<span class="sd">     |                             plot in normalised coordinates.</span>
<span class="sd">     | key_show=True - draw the key.  Set to False if not required.</span>
<span class="sd">     | ptype=0 - plot type - not needed for cf fields.</span>
<span class="sd">     |                       0 = no specific plot type,</span>
<span class="sd">     |                       1 = longitude-latitude,</span>
<span class="sd">     |                       2 = latitude - height,</span>
<span class="sd">     |                       3 = longitude - height,</span>
<span class="sd">     |                       4 = latitude - time,</span>
<span class="sd">     |                       5 = longitude - time</span>
<span class="sd">     |                       6 = rotated pole</span>
<span class="sd">     |</span>
<span class="sd">     | title=None - plot title</span>
<span class="sd">     | width=0.005 - shaft width in arrow units; default is 0.005 times the</span>
<span class="sd">     |               width of the plot</span>
<span class="sd">     | headwidth=3 - head width as multiple of shaft width, default is 3</span>
<span class="sd">     | headlength=5 - head length as multiple of shaft width, default is 5</span>
<span class="sd">     | headaxislength=4.5 - head length at shaft intersection, default is 4.5</span>
<span class="sd">     | pivot=&#39;middle&#39; - the part of the arrow that is at the grid point; the</span>
<span class="sd">     |                  arrow rotates about this point</span>
<span class="sd">                        takes &#39;tail&#39;, &#39;middle&#39;, &#39;tip&#39;</span>
<span class="sd">     | axes=True - plot x and y axes</span>
<span class="sd">     | xaxis=True - plot xaxis</span>
<span class="sd">     | yaxis=True - plot y axis</span>
<span class="sd">     | xticks=None - xtick positions</span>
<span class="sd">     | xticklabels=None - xtick labels</span>
<span class="sd">     | yticks=None - y tick positions</span>
<span class="sd">     | yticklabels=None - ytick labels</span>
<span class="sd">     | xlabel=None - label for x axis</span>
<span class="sd">     | ylabel=None - label for y axis</span>
<span class="sd">     | ylog=False - log y axis</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      None</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span>
    <span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
    <span class="n">continent_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
    <span class="k">if</span> <span class="n">text_fontsize</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">text_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
    <span class="c1"># ylog=plotvars.ylog</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span>
    <span class="n">title_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span>
    <span class="k">if</span> <span class="n">title_fontsize</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">title_fontsize</span> <span class="o">=</span> <span class="mi">15</span>

    <span class="c1"># Set potential user axis labels</span>
    <span class="n">user_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
    <span class="n">user_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>

    <span class="c1"># Extract required data for contouring</span>
    <span class="c1"># If a cf-python field</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> \
            <span class="n">ypole</span> <span class="o">=</span> <span class="n">cf_data_assign</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># field=f #field data passed in as f</span>
        <span class="n">check_data</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">u_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">u_x</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">u_y</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span><span class="p">,</span> <span class="n">v_y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> \
            <span class="n">ypole</span> <span class="o">=</span> <span class="n">cf_data_assign</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># field=f #field data passed in as f</span>
        <span class="n">check_data</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">v_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">v_x</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">v_y</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Reset xlabel and ylabel values with user defined labels in specified</span>
    <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">user_xlabel</span>
    <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">user_ylabel</span>

    <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_data</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span>

    <span class="k">if</span> <span class="n">key_length</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">key_length</span> <span class="o">=</span> <span class="n">scale</span>

    <span class="c1"># Open a new plot if necessary</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Set plot type if user specified</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ptype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="n">ptype</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Set up mapping</span>
        <span class="n">set_map</span><span class="p">()</span>
        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>

        <span class="c1"># add cyclic and shift grid</span>
        <span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span> <span class="o">=</span> <span class="n">addcyclic</span><span class="p">(</span><span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span><span class="p">)</span>
        <span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span> <span class="o">=</span> <span class="n">addcyclic</span><span class="p">(</span><span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">):</span>
            <span class="n">u_x</span> <span class="o">=</span> <span class="n">u_x</span> <span class="o">-</span> <span class="mf">360.0</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">v_x</span><span class="p">):</span>
            <span class="n">v_x</span> <span class="o">=</span> <span class="n">v_x</span> <span class="o">-</span> <span class="mf">360.0</span>
        <span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span> <span class="o">=</span> <span class="n">shiftgrid</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span><span class="p">)</span>
        <span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span> <span class="o">=</span> <span class="n">shiftgrid</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span><span class="p">)</span>

    <span class="c1"># stride data points to reduce vector density</span>
    <span class="k">if</span> <span class="n">stride</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">stride</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xstride</span> <span class="o">=</span> <span class="n">stride</span>
            <span class="n">ystride</span> <span class="o">=</span> <span class="n">stride</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">stride</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">xstride</span> <span class="o">=</span> <span class="n">stride</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ystride</span> <span class="o">=</span> <span class="n">stride</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">iskip</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">u_x</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">iskip</span> <span class="o">!=</span> <span class="n">xstride</span><span class="p">:</span>
                <span class="n">u_x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
            <span class="n">iskip</span> <span class="o">=</span> <span class="n">iskip</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">iskip</span> <span class="o">&gt;</span> <span class="n">xstride</span><span class="p">:</span>
                <span class="n">iskip</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">iskip</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">u_y</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">iskip</span> <span class="o">!=</span> <span class="n">ystride</span><span class="p">:</span>
                <span class="n">u_y</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
            <span class="n">iskip</span> <span class="o">=</span> <span class="n">iskip</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">iskip</span> <span class="o">&gt;</span> <span class="n">ystride</span><span class="p">:</span>
                <span class="n">iskip</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Use bilinear interpolation to find new vector positions and values on a</span>
    <span class="c1"># map</span>
    <span class="k">if</span> <span class="n">pts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">!=</span> <span class="s1">&#39;npstere&#39;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">!=</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
            <span class="c1"># Calculate interpolation points and values</span>
            <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span> <span class="o">=</span> <span class="n">stipple_points</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span>
                                        <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span>
                                        <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span>
                                        <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span>
                                        <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">u_vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">u_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>
            <span class="n">v_vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">v_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>

            <span class="c1"># Plot vectors</span>
            <span class="n">quiv</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">,</span> <span class="n">u_vals</span><span class="p">,</span> <span class="n">v_vals</span><span class="p">,</span>
                                         <span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">,</span>
                                         <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                                         <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                         <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                                         <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                                         <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Polar grid</span>
            <span class="c1"># Calculate interpolation points and values</span>

            <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">,</span> <span class="n">xnew_map</span><span class="p">,</span> <span class="n">ynew_map</span> <span class="o">=</span> <span class="n">polar_regular_grid</span><span class="p">(</span><span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">)</span>

            <span class="n">u_vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">u_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>
            <span class="n">v_vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">v_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>

            <span class="c1"># Rotate vector values</span>
            <span class="n">hem</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Northern hemisphere</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
                <span class="n">hem</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">u_vals</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">hem</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">newu</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">-</span>
                            <span class="n">hem</span> <span class="o">*</span> <span class="n">v_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                    <span class="n">newv</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="n">hem</span> <span class="o">*</span>
                            <span class="n">u_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">newu</span> <span class="o">=</span> <span class="p">(</span><span class="n">hem</span> <span class="o">*</span> <span class="n">u_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span>
                            <span class="n">hem</span> <span class="o">*</span> <span class="n">v_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                    <span class="n">newv</span> <span class="o">=</span> <span class="p">(</span><span class="n">hem</span> <span class="o">*</span> <span class="n">v_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">-</span>
                            <span class="n">hem</span> <span class="o">*</span> <span class="n">u_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>

                <span class="n">u_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">newu</span>
                <span class="n">v_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">newv</span>

            <span class="c1"># Plot vectors</span>
            <span class="n">quiv</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">xnew_map</span><span class="p">,</span> <span class="n">ynew_map</span><span class="p">,</span> <span class="n">u_vals</span><span class="p">,</span> <span class="n">v_vals</span><span class="p">,</span>
                                         <span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">,</span>
                                         <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                         <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                                         <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                                         <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">)</span>

        <span class="c1"># Make key_label if none exists</span>
        <span class="k">if</span> <span class="n">key_label</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">key_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_length</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                <span class="n">key_label</span> <span class="o">=</span> <span class="n">supscr</span><span class="p">(</span><span class="n">key_label</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key_show</span><span class="p">:</span>
            <span class="n">quiv_key</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span><span class="n">quiv</span><span class="p">,</span> <span class="n">key_location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                               <span class="n">key_location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">key_length</span><span class="p">,</span>
                                               <span class="n">key_label</span><span class="p">,</span> <span class="n">labelpos</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>

    <span class="c1"># Map vectors</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">pts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># convert lons, lats into map coordinates</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">))</span>

            <span class="c1"># plot vectors and key</span>
            <span class="n">quiv</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">u_data</span><span class="p">,</span> <span class="n">v_data</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">,</span>
                                         <span class="n">units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                                         <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                                         <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                                         <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">)</span>

            <span class="c1"># Make key_label if none exists</span>
            <span class="k">if</span> <span class="n">key_label</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">key_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_length</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                <span class="n">key_label</span> <span class="o">=</span> <span class="n">supscr</span><span class="p">(</span><span class="n">key_label</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key_show</span><span class="p">:</span>
                <span class="n">quiv_key</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span><span class="n">quiv</span><span class="p">,</span> <span class="n">key_location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                   <span class="n">key_location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">key_length</span><span class="p">,</span>
                                                   <span class="n">key_label</span><span class="p">,</span> <span class="n">labelpos</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>

        <span class="c1"># axes</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
            <span class="n">lonticks</span><span class="p">,</span> <span class="n">lonlabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span>
                <span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">latticks</span><span class="p">,</span> <span class="n">latlabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span>
                <span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">lonticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">lonlabels</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticks</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">axes_plot</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">latticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">latlabels</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">axes_plot</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticks</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">axes_plot</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">user_xlabel</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">user_ylabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
            <span class="n">latstep</span> <span class="o">=</span> <span class="mi">30</span>
            <span class="k">if</span> <span class="mi">90</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">:</span>
                <span class="n">latstep</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">mymap</span><span class="o">.</span><span class="n">drawmeridians</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                                <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span>
                                <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">mymap</span><span class="o">.</span><span class="n">drawmeridians</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">mymap</span><span class="o">.</span><span class="n">drawparallels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="n">latstep</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">mymap</span><span class="o">.</span><span class="n">drawparallels</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>

        <span class="c1"># Coastlines and title</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">(</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">continent_color</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                <span class="n">title</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>

    <span class="c1">###########</span>
    <span class="c1"># Zonal plot</span>
    <span class="c1">###########</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>

        <span class="n">user_gset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>
        <span class="k">if</span> <span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Program selected data plot limits</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">80</span> <span class="ow">and</span> <span class="n">xmin</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
                <span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xmax</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="ow">and</span> <span class="n">xmax</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
                <span class="n">xmax</span> <span class="o">=</span> <span class="mi">90</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ymin</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># User specified plot limits</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>

        <span class="n">xstep</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">==</span> <span class="o">-</span><span class="mi">90</span> <span class="ow">and</span> <span class="n">xmax</span> <span class="o">==</span> <span class="mi">90</span><span class="p">):</span>
            <span class="n">xstep</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">ystep</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">):</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">==</span> <span class="mi">100000</span><span class="p">):</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">10000</span>

        <span class="n">ytype</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># pressure or similar y axis</span>
        <span class="k">if</span> <span class="s1">&#39;theta&#39;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
            <span class="n">ytype</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="s1">&#39;height&#39;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
            <span class="n">ytype</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">:</span>
                <span class="n">ystep</span> <span class="o">=</span> <span class="mf">500.0</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>
                <span class="n">ystep</span> <span class="o">=</span> <span class="mf">1000.0</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50000</span><span class="p">:</span>
                <span class="n">ystep</span> <span class="o">=</span> <span class="mf">10000.0</span>

        <span class="c1"># Set plot limits and draw axes</span>
        <span class="k">if</span> <span class="n">ylog</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ytype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">gset</span><span class="p">(</span>
                    <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
                    <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
                    <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                    <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                    <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gset</span><span class="p">(</span>
                    <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
                    <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
                    <span class="n">ymin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                    <span class="n">ymax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                    <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>

            <span class="c1"># Set default axis labels</span>
            <span class="n">latticks</span><span class="p">,</span> <span class="n">latlabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">yaxisticks</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span>
                <span class="n">dmin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                <span class="n">dmax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">mystep</span><span class="o">=</span><span class="n">ystep</span><span class="p">,</span>
                <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">heightticks</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span>
                <span class="n">dmin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                <span class="n">dmax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">mystep</span><span class="o">=</span><span class="n">ystep</span><span class="p">,</span>
                <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">heightticks</span>

            <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">latticks</span> <span class="o">=</span> <span class="n">xticks</span>
                        <span class="n">latlabels</span> <span class="o">=</span> <span class="n">xticks</span>
                        <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">latlabels</span> <span class="o">=</span> <span class="n">xticklabels</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">latticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                    <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">heightticks</span> <span class="o">=</span> <span class="n">yticks</span>
                        <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticks</span>
                        <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                    <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">latticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">latticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">latlabels</span><span class="p">,</span>
                      <span class="n">yticks</span><span class="o">=</span><span class="n">heightticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">heightlabels</span><span class="p">,</span>
                      <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="c1"># Log y axis</span>
        <span class="k">if</span> <span class="n">ylog</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ymin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># reset zero mb/height input to a small value</span>
            <span class="n">gset</span><span class="p">(</span>
                <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
                <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
                <span class="n">ymin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                <span class="n">ymax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                <span class="n">ylog</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>
            <span class="n">latticks</span><span class="p">,</span> <span class="n">latlabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">latticks</span> <span class="o">=</span> <span class="n">xticks</span>
                        <span class="n">latlabels</span> <span class="o">=</span> <span class="n">xticks</span>
                        <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">latlabels</span> <span class="o">=</span> <span class="n">xticklabels</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">latticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                    <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">heightticks</span> <span class="o">=</span> <span class="n">yticks</span>
                        <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticks</span>
                        <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                    <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">axes_plot</span><span class="p">(</span>
                        <span class="n">xticks</span><span class="o">=</span><span class="n">latticks</span><span class="p">,</span>
                        <span class="n">xticklabels</span><span class="o">=</span><span class="n">latlabels</span><span class="p">,</span>
                        <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
                        <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">latticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">latlabels</span><span class="p">,</span>
                              <span class="n">yticks</span><span class="o">=</span><span class="n">heightticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">heightlabels</span><span class="p">,</span>
                              <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="c1"># Regrid the data if requested</span>
        <span class="k">if</span> <span class="n">pts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span> <span class="o">=</span> <span class="n">stipple_points</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span> <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span>
                                        <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span> <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span>
                                        <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">u_vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">u_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>
            <span class="n">v_vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">v_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>

            <span class="n">u_x</span> <span class="o">=</span> <span class="n">xnew</span>
            <span class="n">u_y</span> <span class="o">=</span> <span class="n">ynew</span>
            <span class="n">u_data</span> <span class="o">=</span> <span class="n">u_vals</span>
            <span class="n">v_data</span> <span class="o">=</span> <span class="n">v_vals</span>

        <span class="c1"># set scale and key lengths</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">scale_u</span> <span class="o">=</span> <span class="n">scale</span>
            <span class="n">scale_v</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale_u</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">scale_v</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">key_length</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">key_length_u</span> <span class="o">=</span> <span class="n">key_length</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">key_length_v</span> <span class="o">=</span> <span class="n">key_length</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># scale v data</span>
            <span class="n">v_data</span> <span class="o">=</span> <span class="n">v_data</span> <span class="o">*</span> <span class="n">scale_u</span> <span class="o">/</span> <span class="n">scale_v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key_length_u</span> <span class="o">=</span> <span class="n">key_length</span>

        <span class="c1"># Plot the vectors</span>
        <span class="n">quiv</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">u_data</span><span class="p">,</span> <span class="n">v_data</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">,</span>
                                    <span class="n">units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale_u</span><span class="p">,</span>
                                    <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                                    <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                                    <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">)</span>

        <span class="c1"># Plot single key</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Single scale vector</span>
            <span class="k">if</span> <span class="n">key_label</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">key_label_u</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_length_u</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                    <span class="n">key_label_u</span> <span class="o">=</span> <span class="n">supscr</span><span class="p">(</span><span class="n">key_label_u</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key_label_u</span> <span class="o">=</span> <span class="n">key_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">key_show</span><span class="p">:</span>
                <span class="n">quiv_key</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span><span class="n">quiv</span><span class="p">,</span> <span class="n">key_location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                   <span class="n">key_location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                   <span class="n">key_length_u</span><span class="p">,</span> <span class="n">key_label_u</span><span class="p">,</span>
                                                   <span class="n">labelpos</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>

        <span class="c1"># Plot two keys</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># translate from normalised units to plot units</span>
            <span class="n">xpos</span> <span class="o">=</span> <span class="n">key_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> \
                <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="o">+</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">ypos</span> <span class="o">=</span> <span class="n">key_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> \
                <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span> <span class="o">+</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>

            <span class="c1"># horizontal and vertical spacings for offsetting vector reference</span>
            <span class="c1"># text</span>
            <span class="n">xoffset</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span>
            <span class="n">yoffset</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span>

            <span class="c1"># Assign key labels if necessary</span>
            <span class="k">if</span> <span class="n">key_label</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">key_label_u</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_length_u</span><span class="p">)</span>
                <span class="n">key_label_v</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_length_v</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                    <span class="n">key_label_u</span> <span class="o">=</span> <span class="n">supscr</span><span class="p">(</span><span class="n">key_label_u</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                    <span class="n">key_label_v</span> <span class="o">=</span> <span class="n">supscr</span><span class="p">(</span><span class="n">key_label_v</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key_label_u</span> <span class="o">=</span> <span class="n">supscr</span><span class="p">(</span><span class="n">key_label</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">key_label_v</span> <span class="o">=</span> <span class="n">supscr</span><span class="p">(</span><span class="n">key_label</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Plot reference vectors and keys</span>
            <span class="k">if</span> <span class="n">key_show</span><span class="p">:</span>
                <span class="n">quiv1</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">key_length</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                                             <span class="n">pivot</span><span class="o">=</span><span class="s1">&#39;tail&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">,</span>
                                             <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">,</span>
                                             <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                                             <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                                             <span class="n">clip_on</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">quiv2</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">key_length</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="n">pivot</span><span class="o">=</span><span class="s1">&#39;tail&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">,</span>
                                             <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">,</span>
                                             <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                                             <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                                             <span class="n">clip_on</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="n">xpos</span><span class="p">,</span>
                    <span class="n">ypos</span> <span class="o">+</span> <span class="n">yoffset</span><span class="p">,</span>
                    <span class="n">key_label_u</span><span class="p">,</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="n">xpos</span> <span class="o">-</span> <span class="n">xoffset</span><span class="p">,</span>
                    <span class="n">ypos</span><span class="p">,</span>
                    <span class="n">key_label_v</span><span class="p">,</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                <span class="n">title</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>

    <span class="c1">##########</span>
    <span class="c1"># Save plot</span>
    <span class="c1">##########</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gset</span><span class="p">()</span>
        <span class="n">cscale</span><span class="p">()</span>
        <span class="n">gclose</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="set_map"><a class="viewcode-back" href="../set_map.html#cfplot.set_map">[docs]</a><span class="k">def</span> <span class="nf">set_map</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | set_map - set map and write into plotvars.mymap</span>
<span class="sd">     |</span>
<span class="sd">     | No inputs</span>
<span class="sd">     | This is an internal routine and not used by the user</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      None</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set up mapping</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;merc&#39;</span><span class="p">:</span>
        <span class="n">lon_mid</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">lat_mid</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">mymap</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span><span class="p">,</span> <span class="n">llcrnrlon</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span>
                        <span class="n">urcrnrlon</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span> <span class="n">llcrnrlat</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span>
                        <span class="n">urcrnrlat</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="n">lon_mid</span><span class="p">,</span>
                        <span class="n">lat_0</span><span class="o">=</span><span class="n">lat_mid</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span><span class="p">:</span>
        <span class="n">mymap</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;npstere&#39;</span><span class="p">,</span> <span class="n">boundinglat</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">,</span>
                        <span class="nb">round</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                        <span class="n">resolution</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
        <span class="n">mymap</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;spstere&#39;</span><span class="p">,</span> <span class="n">boundinglat</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">,</span>
                        <span class="nb">round</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span>
                        <span class="n">resolution</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;ortho&#39;</span><span class="p">:</span>
        <span class="n">mymap</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span>  <span class="n">lon_0</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">,</span>
                        <span class="n">lat_0</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lat_0</span><span class="p">,</span>
                        <span class="n">resolution</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;moll&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;robin&#39;</span><span class="p">:</span>
        <span class="n">mymap</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span>
            <span class="n">projection</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span><span class="p">,</span>
            <span class="n">lon_0</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">,</span>
            <span class="n">resolution</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;lcc&#39;</span><span class="p">:</span>
        <span class="n">mymap</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span>
            <span class="n">projection</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span><span class="p">,</span>
            <span class="n">lon_0</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lat_0</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lcc_height</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lcc_width</span><span class="p">,</span>
            <span class="n">rsphere</span><span class="o">=</span><span class="p">(</span><span class="mf">6378137.00</span><span class="p">,</span> <span class="mf">6356752.3142</span><span class="p">),</span> <span class="n">area_thresh</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">resolution</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>

    <span class="c1"># Store map</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span> <span class="o">=</span> <span class="n">mymap</span>

</div>
<div class="viewcode-block" id="polar_regular_grid"><a class="viewcode-back" href="../polar_regular_grid.html#cfplot.polar_regular_grid">[docs]</a><span class="k">def</span> <span class="nf">polar_regular_grid</span><span class="p">(</span><span class="n">pts</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | polar_regular_grid - return a regular grid over a polar</span>
<span class="sd">     |                      stereographic area</span>
<span class="sd">     |</span>
<span class="sd">     | pts=50 - number  of grid points in the x and y directions</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      lons, lats of grid in degrees</span>
<span class="sd">      x, y locations of lons and lats</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>

    <span class="n">boundinglat</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
    <span class="n">lon_0</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="n">mymap</span><span class="p">(</span><span class="n">lon_0</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">mymap</span><span class="p">(</span><span class="n">lon_0</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="n">mymap</span><span class="p">(</span><span class="n">lon_0</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">mymap</span><span class="p">(</span><span class="n">lon_0</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">)</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mymap</span><span class="p">(</span><span class="n">lon_0</span> <span class="o">-</span> <span class="mi">90</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">)</span>
    <span class="n">xmax</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mymap</span><span class="p">(</span><span class="n">lon_0</span> <span class="o">+</span> <span class="mi">90</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">)</span>

    <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span> <span class="o">=</span> <span class="n">stipple_points</span><span class="p">(</span>
        <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">mymap</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c1"># Work out which of the points are valid</span>
    <span class="n">valid_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">boundinglat</span><span class="p">:</span>
                <span class="n">valid_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_points</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">boundinglat</span><span class="p">:</span>
                <span class="n">valid_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_points</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lons</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span> <span class="n">lats</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span> <span class="n">xnew</span><span class="p">[</span>
        <span class="n">valid_points</span><span class="p">],</span> <span class="n">ynew</span><span class="p">[</span><span class="n">valid_points</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="cf_var_name"><a class="viewcode-back" href="../cf_var_name.html#cfplot.cf_var_name">[docs]</a><span class="k">def</span> <span class="nf">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | cf_var_name - return the name from a supplied dimension</span>
<span class="sd">     |               in the following order</span>
<span class="sd">     |               ncvar</span>
<span class="sd">     |               short_name</span>
<span class="sd">     |               long_name</span>
<span class="sd">     |               standard_name</span>
<span class="sd">     |</span>
<span class="sd">     | field=None - field</span>
<span class="sd">     | dim=None - dimension required - &#39;dim0&#39;, &#39;dim1&#39; etc.</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      name</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">ncvar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s1">&#39;ncvar&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">short_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s1">&#39;short_name&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">long_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s1">&#39;long_name&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">standard_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;No Name&#39;</span>
    <span class="k">if</span> <span class="nb">id</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">id</span>
    <span class="k">if</span> <span class="n">ncvar</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">ncvar</span>
    <span class="k">if</span> <span class="n">short_name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">short_name</span>
    <span class="k">if</span> <span class="n">long_name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">long_name</span>
    <span class="k">if</span> <span class="n">standard_name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">standard_name</span>

    <span class="k">return</span> <span class="n">name</span>

</div>
<div class="viewcode-block" id="process_color_scales"><a class="viewcode-back" href="../process_color_scales.html#cfplot.process_color_scales">[docs]</a><span class="k">def</span> <span class="nf">process_color_scales</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | Process colour scales to generate images of them for the web</span>
<span class="sd">     | documentation and the rst code for inclusion in the</span>
<span class="sd">     | colour_scale.rst file.</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     | No inputs</span>
<span class="sd">     | This is an internal routine and not used by the user</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      None</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Define scale categories</span>
    <span class="n">uniform</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="s1">&#39;plasma&#39;</span><span class="p">,</span> <span class="s1">&#39;parula&#39;</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">]</span>

    <span class="n">ncl_large</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;amwg256&#39;</span><span class="p">,</span> <span class="s1">&#39;BkBlAqGrYeOrReViWh200&#39;</span><span class="p">,</span> <span class="s1">&#39;BlAqGrYeOrRe&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;BlAqGrYeOrReVi200&#39;</span><span class="p">,</span> <span class="s1">&#39;BlGrYeOrReVi200&#39;</span><span class="p">,</span> <span class="s1">&#39;BlRe&#39;</span><span class="p">,</span> <span class="s1">&#39;BlueRed&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;BlueRedGray&#39;</span><span class="p">,</span> <span class="s1">&#39;BlueWhiteOrangeRed&#39;</span><span class="p">,</span> <span class="s1">&#39;BlueYellowRed&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;BlWhRe&#39;</span><span class="p">,</span> <span class="s1">&#39;cmp_b2r&#39;</span><span class="p">,</span> <span class="s1">&#39;cmp_haxby&#39;</span><span class="p">,</span> <span class="s1">&#39;detail&#39;</span><span class="p">,</span> <span class="s1">&#39;extrema&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;GrayWhiteGray&#39;</span><span class="p">,</span> <span class="s1">&#39;GreenYellow&#39;</span><span class="p">,</span> <span class="s1">&#39;helix&#39;</span><span class="p">,</span> <span class="s1">&#39;helix1&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;hotres&#39;</span><span class="p">,</span> <span class="s1">&#39;matlab_hot&#39;</span><span class="p">,</span> <span class="s1">&#39;matlab_hsv&#39;</span><span class="p">,</span> <span class="s1">&#39;matlab_jet&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;matlab_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;ncl_default&#39;</span><span class="p">,</span> <span class="s1">&#39;ncview_default&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OceanLakeLandSnow&#39;</span><span class="p">,</span> <span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="s1">&#39;rainbow_white_gray&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;rainbow_white&#39;</span><span class="p">,</span> <span class="s1">&#39;rainbow_gray&#39;</span><span class="p">,</span> <span class="s1">&#39;tbr_240_300&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;tbr_stdev_0_30&#39;</span><span class="p">,</span> <span class="s1">&#39;tbr_var_0_500&#39;</span><span class="p">,</span> <span class="s1">&#39;tbrAvg1&#39;</span><span class="p">,</span> <span class="s1">&#39;tbrStd1&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;tbrVar1&#39;</span><span class="p">,</span> <span class="s1">&#39;thelix&#39;</span><span class="p">,</span> <span class="s1">&#39;ViBlGrWhYeOrRe&#39;</span><span class="p">,</span> <span class="s1">&#39;wh_bl_gr_ye_re&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;WhBlGrYeRe&#39;</span><span class="p">,</span> <span class="s1">&#39;WhBlReWh&#39;</span><span class="p">,</span> <span class="s1">&#39;WhiteBlue&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;WhiteBlueGreenYellowRed&#39;</span><span class="p">,</span> <span class="s1">&#39;WhiteGreen&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;WhiteYellowOrangeRed&#39;</span><span class="p">,</span> <span class="s1">&#39;WhViBlGrYeOrRe&#39;</span><span class="p">,</span> <span class="s1">&#39;WhViBlGrYeOrReWh&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;wxpEnIR&#39;</span><span class="p">,</span> <span class="s1">&#39;3gauss&#39;</span><span class="p">,</span> <span class="s1">&#39;3saw&#39;</span><span class="p">,</span> <span class="s1">&#39;BrBG&#39;</span><span class="p">]</span>

    <span class="n">ncl_meteoswiss</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hotcold_18lev&#39;</span><span class="p">,</span> <span class="s1">&#39;hotcolr_19lev&#39;</span><span class="p">,</span> <span class="s1">&#39;mch_default&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;perc2_9lev&#39;</span><span class="p">,</span> <span class="s1">&#39;percent_11lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip2_15lev&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;precip2_17lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip3_16lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip4_11lev&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;precip4_diff_19lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip_11lev&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;precip_diff_12lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip_diff_1lev&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;rh_19lev&#39;</span><span class="p">,</span> <span class="s1">&#39;spread_15lev&#39;</span><span class="p">]</span>

    <span class="n">ncl_color_blindness</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;StepSeq25&#39;</span><span class="p">,</span> <span class="s1">&#39;posneg_2&#39;</span><span class="p">,</span> <span class="s1">&#39;posneg_1&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;BlueDarkOrange18&#39;</span><span class="p">,</span> <span class="s1">&#39;BlueDarkRed18&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;GreenMagenta16&#39;</span><span class="p">,</span> <span class="s1">&#39;BlueGreen14&#39;</span><span class="p">,</span> <span class="s1">&#39;BrownBlue12&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;Cat12&#39;</span><span class="p">]</span>

    <span class="n">ncl_small</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;amwg&#39;</span><span class="p">,</span> <span class="s1">&#39;amwg_blueyellowred&#39;</span><span class="p">,</span> <span class="s1">&#39;BlueDarkRed18&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;BlueDarkOrange18&#39;</span><span class="p">,</span> <span class="s1">&#39;BlueGreen14&#39;</span><span class="p">,</span> <span class="s1">&#39;BrownBlue12&#39;</span><span class="p">,</span> <span class="s1">&#39;Cat12&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;cmp_flux&#39;</span><span class="p">,</span> <span class="s1">&#39;cosam12&#39;</span><span class="p">,</span> <span class="s1">&#39;cosam&#39;</span><span class="p">,</span> <span class="s1">&#39;GHRSST_anomaly&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;GreenMagenta16&#39;</span><span class="p">,</span> <span class="s1">&#39;hotcold_18lev&#39;</span><span class="p">,</span> <span class="s1">&#39;hotcolr_19lev&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;mch_default&#39;</span><span class="p">,</span> <span class="s1">&#39;nrl_sirkes&#39;</span><span class="p">,</span> <span class="s1">&#39;nrl_sirkes_nowhite&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;perc2_9lev&#39;</span><span class="p">,</span> <span class="s1">&#39;percent_11lev&#39;</span><span class="p">,</span> <span class="s1">&#39;posneg_2&#39;</span><span class="p">,</span> <span class="s1">&#39;prcp_1&#39;</span><span class="p">,</span> <span class="s1">&#39;prcp_2&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;prcp_3&#39;</span><span class="p">,</span> <span class="s1">&#39;precip_11lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip_diff_12lev&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;precip_diff_1lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip2_15lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip2_17lev&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;precip3_16lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip4_11lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip4_diff_19lev&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;radar&#39;</span><span class="p">,</span> <span class="s1">&#39;radar_1&#39;</span><span class="p">,</span> <span class="s1">&#39;rh_19lev&#39;</span><span class="p">,</span> <span class="s1">&#39;seaice_1&#39;</span><span class="p">,</span> <span class="s1">&#39;seaice_2&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;so4_21&#39;</span><span class="p">,</span> <span class="s1">&#39;spread_15lev&#39;</span><span class="p">,</span> <span class="s1">&#39;StepSeq25&#39;</span><span class="p">,</span> <span class="s1">&#39;sunshine_9lev&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;sunshine_diff_12lev&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_19lev&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_diff_18lev&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;temp_diff_1lev&#39;</span><span class="p">,</span> <span class="s1">&#39;topo_15lev&#39;</span><span class="p">,</span> <span class="s1">&#39;wgne15&#39;</span><span class="p">,</span> <span class="s1">&#39;wind_17lev&#39;</span><span class="p">]</span>

    <span class="n">orography</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;os250kmetres&#39;</span><span class="p">,</span> <span class="s1">&#39;wiki_1_0_2&#39;</span><span class="p">,</span> <span class="s1">&#39;wiki_1_0_3&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;wiki_2_0&#39;</span><span class="p">,</span> <span class="s1">&#39;wiki_2_0_reduced&#39;</span><span class="p">,</span> <span class="s1">&#39;arctic&#39;</span><span class="p">]</span>

    <span class="n">idl_guide</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">45</span><span class="p">):</span>
        <span class="n">idl_guide</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span> <span class="s1">&#39;ncl_meteoswiss&#39;</span><span class="p">,</span> <span class="s1">&#39;ncl_small&#39;</span><span class="p">,</span> <span class="s1">&#39;ncl_large&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;ncl_color_blindness&#39;</span><span class="p">,</span> <span class="s1">&#39;orography&#39;</span><span class="p">,</span> <span class="s1">&#39;idl_guide&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;uniform&#39;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">uniform</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s1">&#39;================== =====&#39;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Perceptually uniform colour maps for use with continuous &#39;</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;data&#39;</span>
            <span class="k">print</span> <span class="n">title</span>
            <span class="k">print</span> <span class="s1">&#39;----------------------------------------------&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;&#39;</span>
            <span class="k">print</span> <span class="n">div</span>
            <span class="k">print</span> <span class="s1">&#39;Name               Scale&#39;</span>
            <span class="k">print</span> <span class="n">div</span>

        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;ncl_meteoswiss&#39;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">ncl_meteoswiss</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s1">&#39;================== =====&#39;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">19</span>
            <span class="k">print</span> <span class="s1">&#39;NCAR Command Language - MeteoSwiss colour maps&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;----------------------------------------------&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;&#39;</span>
            <span class="k">print</span> <span class="n">div</span>
            <span class="k">print</span> <span class="s1">&#39;Name               Scale&#39;</span>
            <span class="k">print</span> <span class="n">div</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;ncl_small&#39;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">ncl_small</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s1">&#39;=================== =====&#39;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="k">print</span> <span class="s1">&#39;NCAR Command Language - small color maps (&lt;50 colours)&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;------------------------------------------------------&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;&#39;</span>
            <span class="k">print</span> <span class="n">div</span>
            <span class="k">print</span> <span class="s1">&#39;Name                Scale&#39;</span>
            <span class="k">print</span> <span class="n">div</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;ncl_large&#39;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">ncl_large</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s1">&#39;======================= =====&#39;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">24</span>
            <span class="k">print</span> <span class="s1">&#39;NCAR Command Language - large colour maps (&gt;50 colours)&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;-------------------------------------------------------&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;&#39;</span>
            <span class="k">print</span> <span class="n">div</span>
            <span class="k">print</span> <span class="s1">&#39;Name                    Scale&#39;</span>
            <span class="k">print</span> <span class="n">div</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;ncl_color_blindness&#39;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">ncl_color_blindness</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s1">&#39;================ =====&#39;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">17</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;NCAR Command Language - Enhanced to help with colour&#39;</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;blindness&#39;</span>
            <span class="k">print</span> <span class="n">title</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;-----------------------------------------------------&#39;</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;---------&#39;</span>
            <span class="k">print</span> <span class="n">title</span>
            <span class="k">print</span> <span class="s1">&#39;&#39;</span>
            <span class="k">print</span> <span class="n">div</span>
            <span class="k">print</span> <span class="s1">&#39;Name             Scale&#39;</span>
            <span class="k">print</span> <span class="n">div</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">17</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;orography&#39;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">orography</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s1">&#39;================ =====&#39;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">17</span>
            <span class="k">print</span> <span class="s1">&#39;Orography/bathymetry colour scales&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;----------------------------------&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;&#39;</span>
            <span class="k">print</span> <span class="n">div</span>
            <span class="k">print</span> <span class="s1">&#39;Name             Scale&#39;</span>
            <span class="k">print</span> <span class="n">div</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">17</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;idl_guide&#39;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">idl_guide</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s1">&#39;======= =====&#39;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="k">print</span> <span class="s1">&#39;IDL guide scales&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;----------------&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;&#39;</span>
            <span class="k">print</span> <span class="n">div</span>
            <span class="k">print</span> <span class="s1">&#39;Name    Scale&#39;</span>
            <span class="k">print</span> <span class="n">div</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">8</span>

        <span class="k">for</span> <span class="n">scale</span> <span class="ow">in</span> <span class="n">scales</span><span class="p">:</span>
            <span class="c1"># Make image of scale</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
            <span class="n">cscale</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
            <span class="n">cb1</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span>
                <span class="n">ax1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
            <span class="n">cb1</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
            <span class="n">cb1</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="s1">&#39;/home/swsheaps/cf-docs/cfplot_sphinx/images/&#39;</span>
            <span class="nb">file</span> <span class="o">+=</span> <span class="s1">&#39;colour_scales/&#39;</span> <span class="o">+</span> <span class="n">scale</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># Use covert to trim the png file to remove white space</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s2">&quot;convert&quot;</span><span class="p">,</span> <span class="s2">&quot;-trim&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="nb">file</span><span class="p">])</span>

            <span class="n">name_pad</span> <span class="o">=</span> <span class="n">scale</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_pad</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">chars</span><span class="p">:</span>
                <span class="n">name_pad</span> <span class="o">=</span> <span class="n">name_pad</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">name_pad</span> <span class="o">+</span> <span class="s1">&#39;.. image:: images/colour_scales/&#39;</span> <span class="o">+</span> <span class="n">scale</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
            <span class="k">print</span> <span class="n">fn</span>

        <span class="k">print</span> <span class="n">div</span>
        <span class="k">print</span> <span class="s1">&#39;&#39;</span>
        <span class="k">print</span> <span class="s1">&#39;&#39;</span>

</div>
<div class="viewcode-block" id="reset"><a class="viewcode-back" href="../reset.html#cfplot.reset">[docs]</a><span class="k">def</span> <span class="nf">reset</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | reset all plotting variables</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      name</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">axes</span><span class="p">()</span>
    <span class="n">cscale</span><span class="p">()</span>
    <span class="n">levs</span><span class="p">()</span>
    <span class="n">gset</span><span class="p">()</span>
    <span class="n">mapset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="setvars"><a class="viewcode-back" href="../setvars.html#cfplot.setvars">[docs]</a><span class="k">def</span> <span class="nf">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">text_fontsize</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">axis_label_fontsize</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title_fontweight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">text_fontweight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">axis_label_fontweight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">continent_thickness</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">continent_color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">viewer</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">tspace_year</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tspace_month</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tspace_day</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">tspace_hour</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xtick_label_rotation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">xtick_label_align</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ytick_label_rotation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">ytick_label_align</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">legend_text_weight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">legend_text_size</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cs_uniform</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | setvars - set plotting variables</span>
<span class="sd">     |</span>
<span class="sd">     | file=None - output file name</span>
<span class="sd">     | title_fontsize=None - title fontsize, default=15</span>
<span class="sd">     | text_fontsize=&#39;normal&#39; - text font size, default=11</span>
<span class="sd">     | axis_label_fontsize=None - axis label fontsize, default=11</span>
<span class="sd">     | title_fontweight=&#39;normal&#39; - title fontweight</span>
<span class="sd">     | text_fontweight=&#39;normal&#39; - text font weight</span>
<span class="sd">     | axis_label_fontweight=&#39;normal&#39; - axis font weight</span>
<span class="sd">     | continent_thickness=None - default=1.5</span>
<span class="sd">     | continent_color=None - default=&#39;k&#39; (black)</span>
<span class="sd">     | viewer=&#39;display&#39; - use ImageMagick display program to display</span>
<span class="sd">     |                    the pictures.  Set to &#39;matplotlib&#39; to use the</span>
<span class="sd">     |                    built in matplotlib viewer.  display is non-blocking</span>
<span class="sd">     |                    of the command prompt while the built in matplotlib</span>
<span class="sd">     |                    viewer is blocking.</span>
<span class="sd">     |</span>
<span class="sd">     | tspace_year=None - time axis spacing in years</span>
<span class="sd">     | tspace_month=None - time axis spacing in months</span>
<span class="sd">     | tspace_day=None - time axis spacing in days</span>
<span class="sd">     | tspace_hour=None - time axis spacing in hours</span>
<span class="sd">     | xtick_label_rotation=0 - rotation of xtick labels</span>
<span class="sd">     | xtick_label_align=&#39;center&#39; - alignment of xtick labels</span>
<span class="sd">     | ytick_label_rotation=0 - rotation of ytick labels</span>
<span class="sd">     | ytick_label_align=&#39;right&#39; - alignment of ytick labels</span>
<span class="sd">     | legend_text_size=None - legend text size</span>
<span class="sd">     | legend_text_weight=None - legend text weight</span>
<span class="sd">     | cs_uniform=None - make a uniform differential colour scale</span>
<span class="sd">     |</span>
<span class="sd">     | Use setvars() to reset to the defaults</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      name</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">file</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="p">,</span> <span class="n">text_fontsize</span><span class="p">,</span> <span class="n">axis_label_fontsize</span><span class="p">,</span>
            <span class="n">continent_thickness</span><span class="p">,</span> <span class="n">title_fontweight</span><span class="p">,</span> <span class="n">text_fontweight</span><span class="p">,</span>
            <span class="n">axis_label_fontweight</span><span class="p">,</span> <span class="n">fontweight</span><span class="p">,</span>  <span class="n">continent_color</span><span class="p">,</span> <span class="n">tspace_year</span><span class="p">,</span>
            <span class="n">tspace_month</span><span class="p">,</span> <span class="n">tspace_day</span><span class="p">,</span> <span class="n">tspace_hour</span><span class="p">,</span> <span class="n">xtick_label_rotation</span><span class="p">,</span>
            <span class="n">xtick_label_align</span><span class="p">,</span> <span class="n">ytick_label_rotation</span><span class="p">,</span> <span class="n">ytick_label_align</span><span class="p">,</span>
            <span class="n">legend_text_size</span><span class="p">,</span> <span class="n">legend_text_weight</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_year</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_month</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_day</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_hour</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_rotation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_align</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_rotation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_align</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_size</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_weight</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cs_uniform</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">if</span> <span class="nb">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="nb">file</span>
    <span class="k">if</span> <span class="n">title_fontsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">title_fontsize</span>
    <span class="k">if</span> <span class="n">axis_label_fontsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span> <span class="o">=</span> <span class="n">axis_label_fontsize</span>
    <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">continent_thickness</span>
    <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span> <span class="o">=</span> <span class="n">continent_color</span>
    <span class="k">if</span> <span class="n">text_fontsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">text_fontsize</span>
    <span class="k">if</span> <span class="n">text_fontweight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span> <span class="o">=</span> <span class="n">text_fontweight</span>
    <span class="k">if</span> <span class="n">axis_label_fontweight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span> <span class="o">=</span> <span class="n">axis_label_fontweight</span>
    <span class="k">if</span> <span class="n">title_fontweight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span> <span class="o">=</span> <span class="n">title_fontweight</span>
    <span class="k">if</span> <span class="n">viewer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="n">viewer</span>
    <span class="k">if</span> <span class="n">tspace_year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_year</span> <span class="o">=</span> <span class="n">tspace_year</span>
    <span class="k">if</span> <span class="n">tspace_month</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_month</span> <span class="o">=</span> <span class="n">tspace_month</span>
    <span class="k">if</span> <span class="n">tspace_day</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_day</span> <span class="o">=</span> <span class="n">tspace_day</span>
    <span class="k">if</span> <span class="n">tspace_hour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_hour</span> <span class="o">=</span> <span class="n">tspace_hour</span>
    <span class="k">if</span> <span class="n">xtick_label_rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_rotation</span> <span class="o">=</span> <span class="n">xtick_label_rotation</span>
    <span class="k">if</span> <span class="n">xtick_label_align</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_align</span> <span class="o">=</span> <span class="n">xtick_label_align</span>
    <span class="k">if</span> <span class="n">ytick_label_rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_rotation</span> <span class="o">=</span> <span class="n">ytick_label_rotation</span>
    <span class="k">if</span> <span class="n">ytick_label_align</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_align</span> <span class="o">=</span> <span class="n">ytick_label_align</span>
    <span class="k">if</span> <span class="n">legend_text_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_size</span> <span class="o">=</span> <span class="n">legend_text_size</span>
    <span class="k">if</span> <span class="n">legend_text_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_weight</span> <span class="o">=</span> <span class="n">legend_text_weight</span>
    <span class="k">if</span> <span class="n">cs_uniform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cs_uniform</span> <span class="o">=</span> <span class="n">cs_uniform</span>

</div>
<div class="viewcode-block" id="rgrot"><a class="viewcode-back" href="../rgrot.html#cfplot.rgrot">[docs]</a><span class="k">def</span> <span class="nf">rgrot</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xpole</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | rgrot - rotate longitude and latitude points onto a rotated grid</span>
<span class="sd">     |</span>
<span class="sd">     | xin=xin - longitude locations</span>
<span class="sd">     | yin=yin - latitude locations</span>
<span class="sd">     | xpole=xpole - xpole in degrees</span>
<span class="sd">     | ypole=ypole - ypole in degrees</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">       x and y points on rotated grid</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check input parameters</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xin</span><span class="p">,</span> <span class="n">yin</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="p">]):</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">rgrot error</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;xin, yin, xpole, ypole all need to be passed to rgrot to</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;generate rotated output points</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Define output arrays.</span>
    <span class="n">xout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xin</span><span class="p">))</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yin</span><span class="p">))</span>

    <span class="c1"># Tolerance limit.</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="mf">1.0E-6</span>

    <span class="c1"># Scale xpole to range -180 to 180.</span>
    <span class="n">xpole_orig</span> <span class="o">=</span> <span class="n">xpole</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">xpole</span> <span class="o">&gt;</span> <span class="mf">180.0</span><span class="p">):</span>
        <span class="n">xpole</span> <span class="o">=</span> <span class="n">xpole</span> <span class="o">-</span> <span class="mf">360.0</span>

    <span class="c1"># Latitude of zero meridian.</span>
    <span class="n">x_zero</span> <span class="o">=</span> <span class="n">xpole</span> <span class="o">+</span> <span class="mf">180.0</span>

    <span class="c1"># Sine and cosine of latitude of eq pole</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ypole</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="n">sin_ypole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ypole</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span>
        <span class="n">cos_ypole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ypole</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sin_ypole</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ypole</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span>
        <span class="n">cos_ypole</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ypole</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span>

    <span class="c1"># Transform to rotated grid.</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xin</span><span class="p">)):</span>

        <span class="c1"># Scale longitude to range -180 to +180 degs</span>
        <span class="n">xpt</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_zero</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">xpt</span> <span class="o">&gt;</span> <span class="mf">180.0</span><span class="p">):</span>
            <span class="n">xpt</span> <span class="o">=</span> <span class="n">xpt</span> <span class="o">-</span> <span class="mf">360.0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">xpt</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">180.0</span><span class="p">):</span>
            <span class="n">xpt</span> <span class="o">=</span> <span class="n">xpt</span> <span class="o">+</span> <span class="mf">360.0</span>

        <span class="c1"># Convert latitude &amp; longitude to radians</span>
        <span class="n">xpt</span> <span class="o">=</span> <span class="n">xpt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span>
        <span class="n">ypt</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span>

        <span class="c1"># Calculate latitude.</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="o">-</span><span class="n">cos_ypole</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">xpt</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ypt</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ypt</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin_ypole</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">arg</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">arg</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>
        <span class="n">ypt2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="n">yout</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">ypt2</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="c1"># Calculate longitude.</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ypt</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">xpt</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin_ypole</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ypt</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos_ypole</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ypt2</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t2</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">):</span>
            <span class="n">xpt2</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">/</span> <span class="n">t2</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">arg</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">arg</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>
            <span class="n">xpt2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">xpt</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">xpt2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xpt2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xpt2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xpt2</span><span class="p">)</span>

        <span class="c1"># Scale longitude to range 0 to 360 degs</span>
        <span class="n">xout</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">xpt2</span>

    <span class="c1"># Reset xpole</span>
    <span class="n">xpole</span> <span class="o">=</span> <span class="n">xpole_orig</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">xout</span><span class="p">,</span> <span class="n">yout</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="rgunrot"><a class="viewcode-back" href="../rgunrot.html#cfplot.rgunrot">[docs]</a><span class="k">def</span> <span class="nf">rgunrot</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xpole</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | rgunrot - translate points from a rotated grid to longitude/latitude</span>
<span class="sd">     |           grid</span>
<span class="sd">     |</span>
<span class="sd">     | xin=xin - longitude locations</span>
<span class="sd">     | yin=yin - latitude locations</span>
<span class="sd">     | xpole=xpole - xpole in degrees</span>
<span class="sd">     | ypole=ypole - ypole in degrees</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">       x and y points on longitude and latitude grid</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check input parameters</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xin</span><span class="p">,</span> <span class="n">yin</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="p">]):</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">rgurot error</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;xin, yin, xpole, ypole all need to be passed to rgrot</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;to generate rotated output points</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Define output arrays.</span>
    <span class="n">xout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xin</span><span class="p">))</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yin</span><span class="p">))</span>

    <span class="c1"># Tolerance limit.</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="mf">1.0E-6</span>

    <span class="c1"># Form x and y arrays to hold grid coordinates.</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
    <span class="n">ny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
        <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">xin</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
        <span class="n">y</span><span class="p">[:,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">yin</span>

    <span class="n">xpole_orig</span> <span class="o">=</span> <span class="n">xpole</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">xpole</span> <span class="o">&gt;</span> <span class="mf">180.0</span><span class="p">):</span>
        <span class="n">xpole</span> <span class="o">=</span> <span class="n">xpole</span> <span class="o">-</span> <span class="mf">360.0</span>

    <span class="c1"># Sine and cosine of latitude of eq pole</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ypole</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="n">sin_ypole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ypole</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span>
        <span class="n">cos_ypole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ypole</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sin_ypole</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ypole</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span>
        <span class="n">cos_ypole</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ypole</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span>

    <span class="c1"># Scale to -180 to 180</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">yy</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xx</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">)</span>
    <span class="n">xx</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">-</span> <span class="mf">360.0</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xx</span> <span class="o">&lt;</span> <span class="mi">180</span><span class="p">)</span>
    <span class="n">xx</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">xx</span> <span class="o">/</span> <span class="mf">180.0</span>
    <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">yy</span> <span class="o">/</span> <span class="mf">180.0</span>

    <span class="n">arg</span> <span class="o">=</span> <span class="n">cosypole</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span> <span class="o">*</span> <span class="n">sinypole</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">WHERE</span><span class="p">(</span><span class="n">arg</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">arg</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arg</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">arg</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
    <span class="n">ay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">ay</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">YY</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">XX</span><span class="p">)</span> <span class="o">*</span> <span class="n">sinypole</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">YY</span><span class="p">)</span> <span class="o">*</span> <span class="n">cosypole</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ay</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">])</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t2</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t2</span> <span class="o">&gt;=</span> <span class="n">tol</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">/</span> <span class="n">T2</span>
        <span class="n">pts2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arg</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">arg</span><span class="p">[</span><span class="n">pts2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">pts2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arg</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">arg</span><span class="p">[</span><span class="n">pts2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">arg</span>
        <span class="n">pts3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xx</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">pts3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">pts3</span><span class="p">])</span>
        <span class="n">pts3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xx</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">pts3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">pts3</span><span class="p">])</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="o">+</span> <span class="n">x0</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">ax</span>

    <span class="c1"># Reset xpole</span>
    <span class="n">xpole</span> <span class="o">=</span> <span class="n">xpole_orig</span>

    <span class="k">return</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="vloc"><a class="viewcode-back" href="../vloc.html#cfplot.vloc">[docs]</a><span class="k">def</span> <span class="nf">vloc</span><span class="p">(</span><span class="n">xvec</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lons</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | vloc is used to locate the positions of a set of points in a vector</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     | xvec=None - data longitudes</span>
<span class="sd">     | yvec=None - data latitudes</span>
<span class="sd">     | lons=None - required longitude positions</span>
<span class="sd">     | lats=None - required latitude positions</span>

<span class="sd">     :Returns:</span>
<span class="sd">      locations of user points in the longitude and latitude points</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

    <span class="c1"># Check input parameters</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">]):</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">vloc error</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;xvec, yvec, lons, lats all need to be passed to vloc to</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;generate a set of location points</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="n">xarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span>
    <span class="n">yarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span>

    <span class="c1"># Convert longitudes to -180 to 180.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">)):</span>
        <span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>
        <span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>

    <span class="c1"># Centre around 180 degrees longitude if needed.</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">)):</span>
            <span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.0</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xvec</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">xvec</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">xvec</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>
            <span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.0</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span>

    <span class="c1"># Find position in array</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">xvec</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">xvec</span><span class="p">))):</span>
            <span class="n">xpt</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">xvec</span><span class="p">)</span>
            <span class="n">xpt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">yvec</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">yvec</span><span class="p">))):</span>
            <span class="n">ypt</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">yvec</span><span class="p">)</span>
            <span class="n">ypt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ypts</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">xpt</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">xarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xpt</span> <span class="o">+</span> <span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xvec</span><span class="p">[</span><span class="n">xpt</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">xvec</span><span class="p">[</span><span class="n">xpt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xvec</span><span class="p">[</span><span class="n">xpt</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ypt</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ypt</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">yarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ypt</span> <span class="o">+</span> <span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">yvec</span><span class="p">[</span><span class="n">ypt</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">yvec</span><span class="p">[</span><span class="n">ypt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">yvec</span><span class="p">[</span><span class="n">ypt</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">yarr</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="rgaxes"><a class="viewcode-back" href="../rgaxes.html#cfplot.rgaxes">[docs]</a><span class="k">def</span> <span class="nf">rgaxes</span><span class="p">(</span><span class="n">xpole</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
           <span class="n">degspacing</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">continents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | rgaxes - label rotated grid plots</span>
<span class="sd">     |</span>
<span class="sd">     | xpole=None - location of xpole in degrees</span>
<span class="sd">     | ypole=None - location of ypole in degrees</span>
<span class="sd">     | xvec=None - location of x grid points</span>
<span class="sd">     | yvec=None - location of y grid points</span>
<span class="sd">     | spacing=10.0 - spacing of the grid for longitude and latitude (degrees)</span>
<span class="sd">     | degspacing=0.75 - spacing of the points along the grid (degrees)</span>
<span class="sd">     | continents=True - draw continents</span>
<span class="sd">     | grid=True - draw grid</span>
<span class="sd">     | labels=True - draw axis labels</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      name</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Invert y array if going from north to south</span>
    <span class="c1"># Otherwise this gives nans for all output</span>
    <span class="n">yvec_orig</span> <span class="o">=</span> <span class="n">yvec</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">yvec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yvec</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
        <span class="n">yvec</span> <span class="o">=</span> <span class="n">yvec</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Extract map continents</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;cyl&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>

    <span class="n">clines</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">clines</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()</span>
    <span class="n">npaths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>

    <span class="n">gset</span><span class="p">(</span>
        <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Set continent thickness and color if not already set</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>

    <span class="c1"># Draw continents</span>
    <span class="k">if</span> <span class="n">continents</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npaths</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">pvert</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">vertices</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">pvert</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">pvert</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">=</span> <span class="n">rgrot</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">pvert</span><span class="p">[</span>
                    <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">yin</span><span class="o">=</span><span class="n">pvert</span><span class="p">[</span>
                    <span class="p">:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="n">ypole</span><span class="p">)</span>
            <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">vloc</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="n">xout</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="n">yout</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">yvec</span><span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span>
                               <span class="n">color</span><span class="o">=</span><span class="n">continent_color</span><span class="p">)</span>

    <span class="c1"># Draw grid lines</span>
    <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">360</span> <span class="o">/</span> <span class="n">spacing</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">spacing</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">spacing</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">spacing</span>

        <span class="c1"># Longitudes</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lons</span><span class="p">:</span>
            <span class="n">ipts</span> <span class="o">=</span> <span class="mf">179.</span> <span class="o">/</span> <span class="n">degspacing</span>
            <span class="n">lona</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ipts</span><span class="p">)</span> <span class="o">+</span> <span class="n">lon</span>
            <span class="n">lata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ipts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">degspacing</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">=</span> <span class="n">rgrot</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="n">lona</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="n">lata</span><span class="p">,</span> <span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="n">ypole</span><span class="p">)</span>
            <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">vloc</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="n">xout</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="n">yout</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">yvec</span><span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ypts</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ypts</span> <span class="o">==</span> <span class="n">ymin</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">loc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">loc</span><span class="p">]):</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span> <span class="n">xpts</span><span class="p">[</span><span class="n">loc</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                        <span class="n">fw</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span>
                        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">lon</span><span class="p">),</span>
                                           <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                           <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                                           <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span><span class="p">,</span>
                                           <span class="n">fontweight</span><span class="o">=</span><span class="n">fw</span><span class="p">)</span>

        <span class="c1"># Latitudes</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lats</span><span class="p">:</span>
            <span class="n">ipts</span> <span class="o">=</span> <span class="mf">359.0</span> <span class="o">/</span> <span class="n">degspacing</span>
            <span class="n">lata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ipts</span><span class="p">)</span> <span class="o">+</span> <span class="n">lat</span>
            <span class="n">lona</span> <span class="o">=</span> <span class="o">-</span><span class="mf">180.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ipts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">degspacing</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">=</span> <span class="n">rgrot</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="n">lona</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="n">lata</span><span class="p">,</span> <span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="n">ypole</span><span class="p">)</span>
            <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">vloc</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="n">xout</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="n">yout</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">yvec</span><span class="p">)</span>

            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
                <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xpts</span> <span class="o">==</span> <span class="n">xmin</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">loc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ypts</span><span class="p">[</span><span class="n">loc</span><span class="p">]):</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">ypts</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">loc</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                            <span class="n">line</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                            <span class="n">fw</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span>
                            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">ypts</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span>
                                               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
                                               <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                               <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span><span class="p">,</span>
                                               <span class="n">fontweight</span><span class="o">=</span><span class="n">fw</span><span class="p">)</span>

    <span class="n">yvec</span> <span class="o">=</span> <span class="n">yvec_orig</span>

</div>
<div class="viewcode-block" id="lineplot"><a class="viewcode-back" href="../lineplot.html#cfplot.lineplot">[docs]</a><span class="k">def</span> <span class="nf">lineplot</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">line_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
             <span class="n">xlog</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">swap_xy</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">marker</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">legend_location</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">xunits</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yunits</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">xticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | lineplot is the interface to line plotting in cf-plot.</span>
<span class="sd">    | The minimum use is lineplot(f) where f is a CF field.</span>
<span class="sd">    | If x and y are passed then an appropriate plot is made allowing</span>
<span class="sd">    | x vs data and y vs data plots.</span>
<span class="sd">    |</span>
<span class="sd">    | f - CF data used to make a line plot</span>
<span class="sd">    | x - x locations of data in y</span>
<span class="sd">    | y - y locations of data in x</span>
<span class="sd">    | linestyle=&#39;-&#39; - line style</span>
<span class="sd">    | color=&#39;k - line color</span>
<span class="sd">    | linewidth=1.0 - line width</span>
<span class="sd">    | marker=None - marker for points along the line</span>
<span class="sd">    | markersize=5.0 - size of the marker</span>
<span class="sd">    | xlog=False - log x-axis</span>
<span class="sd">    | ylog=False - log y-axis</span>
<span class="sd">    | label=None - line label - label for line</span>
<span class="sd">    | legend_location=&#39;upper right&#39; - default location of legend</span>
<span class="sd">    | verbose=None - change to 1 to get a verbose listing of what lineplot</span>
<span class="sd">    |                is doing</span>
<span class="sd">    |</span>
<span class="sd">    | The following parameters override any CF data defaults:</span>
<span class="sd">    | title=None - plot title</span>
<span class="sd">    | xunits=None - x units</span>
<span class="sd">    | yunits=None - y units</span>
<span class="sd">    | xlabel=None - x name</span>
<span class="sd">    | ylabel=None - y name</span>
<span class="sd">    | xname=None - depreciated keyword</span>
<span class="sd">    | yname=None - depreciated keyword</span>
<span class="sd">    | xticks=None - x ticks</span>
<span class="sd">    | xticklabels=None - x tick labels</span>
<span class="sd">    | yticks=None - y ticks</span>
<span class="sd">    | yticklabels - y tick labels</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">&#39;lineplot - making a line plot&#39;</span>

    <span class="c1"># Catch depreciated keywords</span>
    <span class="k">if</span> <span class="n">xname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">yname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">lineplot error&#39;</span>
        <span class="k">print</span> <span class="s1">&#39;xname and yname are now depreciated keywords&#39;</span>
        <span class="k">print</span> <span class="s1">&#39;Please use xlabel and ylabel</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span>

    <span class="c1">##################</span>
    <span class="c1"># Open a new plot is necessary</span>
    <span class="c1">##################</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">##################</span>
    <span class="c1"># Extract required data</span>
    <span class="c1"># If a cf-python field</span>
    <span class="c1">##################</span>
    <span class="n">cf_field</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
            <span class="n">cf_field</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">if</span> <span class="n">cf_field</span><span class="p">:</span>
        <span class="c1"># Check if this is a cf.Fieldlist and reject if it is</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> cf_data_assign error - passed field is a &#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;cf.Fieldlist</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;Please pass one field for contouring</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;i.e. f[0]</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="c1"># Extract data</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;lineplot - CF field, extracting data&#39;</span>

        <span class="n">has_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">has_count</span> <span class="o">=</span> <span class="n">has_count</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xunits</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span>
                    <span class="n">xlabel</span> <span class="o">+=</span> <span class="n">xunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">):</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">id</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;ncvar&#39;</span><span class="p">):</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">ncvar</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;short_name&#39;</span><span class="p">):</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">short_name</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">):</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">long_name</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">):</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">standard_name</span>
                    <span class="k">if</span> <span class="n">yunits</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;Units&#39;</span><span class="p">):</span>
                            <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">yunits</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ylabel</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">yunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

        <span class="k">if</span> <span class="n">has_count</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> lineplot error - passed field is not suitable &#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;for plotting as a line</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">sn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
                <span class="n">ln</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;long_name&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sn</span><span class="p">:</span>
                    <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> \
                        <span class="nb">str</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> \
                        <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ln</span><span class="p">:</span>
                        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> \
                            <span class="nb">str</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> \
                            <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;lineplot - not a CF field, using passed data&#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">y</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;lineplot error- must define both x and y&#39;</span>
        <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;lineplot error- must define just x and y to make &#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;a lineplot&#39;</span>
        <span class="k">if</span> <span class="n">errstr</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Set data values</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">&#39;lineplot - setting data values&#39;</span>
    <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">minx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">miny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">maxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">maxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cf_field</span><span class="p">:</span>
        <span class="n">taxis</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

    <span class="c1"># Use user set values if present</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">minx</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
        <span class="n">miny</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
        <span class="n">maxx</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
        <span class="n">maxy</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

        <span class="c1"># Change from date string to a number if strings are passed</span>
        <span class="n">time_xstr</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">time_ystr</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">minx</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">time_xstr</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">miny</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">time_ystr</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">cf_field</span><span class="p">:</span>
            <span class="n">taxis</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">time_xstr</span> <span class="ow">or</span> <span class="n">time_ystr</span><span class="p">:</span>
                <span class="n">ref_time</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span>
                <span class="n">ref_calendar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">calendar</span>
                <span class="n">ref_time_origin</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Units</span><span class="o">.</span><span class="n">reftime</span><span class="p">)</span>
                <span class="n">time_units</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">ref_calendar</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">time_xstr</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">minx</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">minx</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">maxx</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">maxx</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">taxis</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">([</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">),</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span>
                        <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">)],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">time_ystr</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">miny</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">miny</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">maxy</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">maxy</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">taxis</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">([</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">),</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span>
                        <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">)],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>

    <span class="c1"># Set x and y labelling</span>
    <span class="n">mod</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">tight</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">tight</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span>
            <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span>
            <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cf_field</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="n">timeaxis</span><span class="p">(</span><span class="n">taxis</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">xticks</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">minx</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">maxx</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="n">tight</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>

    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">miny</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">maxy</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="n">tight</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">yticks</span>

    <span class="c1"># Z on y-axis</span>
    <span class="n">ztype</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">xunits</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mb&#39;</span><span class="p">,</span> <span class="s1">&#39;mbar&#39;</span><span class="p">,</span> <span class="s1">&#39;millibar&#39;</span><span class="p">,</span> <span class="s1">&#39;decibar&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;atmosphere&#39;</span><span class="p">,</span> <span class="s1">&#39;atm&#39;</span><span class="p">,</span> <span class="s1">&#39;pascal&#39;</span><span class="p">,</span> <span class="s1">&#39;Pa&#39;</span><span class="p">,</span> <span class="s1">&#39;hPa&#39;</span><span class="p">]:</span>
        <span class="n">swap_xy</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">ztype</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">xunits</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;meter&#39;</span><span class="p">,</span> <span class="s1">&#39;metre&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;kilometer&#39;</span><span class="p">,</span> <span class="s1">&#39;kilometre&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">]:</span>
        <span class="n">xtype</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">swap_xy</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;lineplot - swapping x and y&#39;</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">minx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">miny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">maxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">maxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">xlabel2</span> <span class="o">=</span> <span class="n">ylabel</span>
        <span class="n">ylabel2</span> <span class="o">=</span> <span class="n">xlabel</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xlabel2</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ylabel2</span>

    <span class="k">if</span> <span class="n">ztype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">miny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ypts</span><span class="p">)</span>
        <span class="n">maxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ypts</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ztype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">positive</span> <span class="o">==</span> <span class="s1">&#39;down&#39;</span><span class="p">:</span>
            <span class="n">miny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ypts</span><span class="p">)</span>
            <span class="n">maxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ypts</span><span class="p">)</span>

    <span class="c1"># Make graph</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">&#39;lineplot - making graph&#39;</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span><span class="p">])</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">swap_xy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span>
                <span class="n">xticklabels</span><span class="p">,</span>
                <span class="n">rotation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_rotation</span><span class="p">,</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_align</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span>
                <span class="n">yticklabels</span><span class="p">,</span>
                <span class="n">rotation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_rotation</span><span class="p">,</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_align</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span>
                <span class="n">xticklabels</span><span class="p">,</span>
                <span class="n">rotation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_rotation</span><span class="p">,</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_align</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span>
                <span class="n">xticklabels</span><span class="p">,</span>
                <span class="n">rotation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_rotation</span><span class="p">,</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_align</span><span class="p">)</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                       <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                       <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

    <span class="c1"># Time axes sometimes spill over the edge of the plot limits so</span>
    <span class="c1"># use tight_layout() to adjust these plots</span>
    <span class="k">if</span> <span class="n">cf_field</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Add a legend if needed</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">legend_properties</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_size</span><span class="p">,</span>
            <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_weight</span><span class="p">}</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_location</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">legend_properties</span><span class="p">)</span>

    <span class="c1"># Set title</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span><span class="p">,</span>
                                <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span><span class="p">)</span>

    <span class="c1">##################</span>
    <span class="c1"># Save or view plot</span>
    <span class="c1">##################</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;Saving or viewing plot&#39;</span>
        <span class="n">gclose</span><span class="p">()</span>

</div>
<span class="k">def</span> <span class="nf">regression_tests</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Test for cf-plot regressions</span>
<span class="sd">    | Run through some standard levs, gvals, lon and lat labelling</span>
<span class="sd">    | Make all the gallery plots and use Imagemaick to display them</span>
<span class="sd">    | alongside a reference plot</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">print</span> <span class="s1">&#39;==================&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;Regression testing&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;==================&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;&#39;</span>

    <span class="k">print</span> <span class="s1">&#39;------------------&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;Testing for levels&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;------------------&#39;</span>
    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
                  <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">65</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="n">levs_test</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">35</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">6.</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">,</span> <span class="mf">6.</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="n">levs_test</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">6</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50000</span><span class="p">,</span> <span class="mi">51000</span><span class="p">,</span> <span class="mi">52000</span><span class="p">,</span> <span class="mi">53000</span><span class="p">,</span> <span class="mi">54000</span><span class="p">,</span> <span class="mi">55000</span><span class="p">,</span> <span class="mi">56000</span><span class="p">,</span> <span class="mi">57000</span><span class="p">,</span>
                  <span class="mi">58000</span><span class="p">,</span> <span class="mi">59000</span><span class="p">,</span> <span class="mi">60000</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="n">levs_test</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span>
                   <span class="n">step</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">7000</span><span class="p">,</span> <span class="o">-</span><span class="mi">6500</span><span class="p">,</span> <span class="o">-</span><span class="mi">6000</span><span class="p">,</span> <span class="o">-</span><span class="mi">5500</span><span class="p">,</span> <span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="o">-</span><span class="mi">4500</span><span class="p">,</span> <span class="o">-</span><span class="mi">4000</span><span class="p">,</span> <span class="o">-</span><span class="mi">3500</span><span class="p">,</span>
                  <span class="o">-</span><span class="mi">3000</span><span class="p">,</span> <span class="o">-</span><span class="mi">2500</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span><span class="p">,</span> <span class="o">-</span><span class="mi">1500</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span><span class="p">,</span> <span class="o">-</span><span class="mi">500</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span>
        <span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span>
        <span class="n">levs_test</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=-</span><span class="mi">7000</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=-</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">step</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

    <span class="k">print</span> <span class="s1">&#39;&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;-----------------&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;Testing for gvals&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;-----------------&#39;</span>
    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="mi">281</span><span class="p">,</span> <span class="mi">282</span><span class="p">,</span> <span class="mi">283</span><span class="p">,</span> <span class="mi">284</span><span class="p">,</span> <span class="mi">285</span><span class="p">,</span> <span class="mi">286</span><span class="p">,</span> <span class="mi">287</span><span class="p">,</span> <span class="mi">288</span><span class="p">,</span> <span class="mi">289</span><span class="p">,</span> <span class="mi">290</span><span class="p">,</span> <span class="mi">291</span><span class="p">,</span> <span class="mi">292</span><span class="p">,</span>
                  <span class="mi">293</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">280.50619506835938</span><span class="p">,</span>
                   <span class="nb">max</span><span class="o">=</span><span class="mf">293.48431396484375</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">gvals_test</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.6</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">,</span> <span class="mf">5.8</span><span class="p">,</span>
                  <span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.2</span><span class="p">,</span> <span class="mf">6.4</span><span class="p">,</span> <span class="mf">6.6</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.356</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.675</span><span class="p">,</span> <span class="n">mult</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">gvals_test</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span>
                  <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">49.510975</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">53.206604</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="n">gvals_test</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="mi">47000</span><span class="p">,</span> <span class="mi">48000</span><span class="p">,</span> <span class="mi">49000</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">51000</span><span class="p">,</span> <span class="mi">52000</span><span class="p">,</span> <span class="mi">53000</span><span class="p">,</span> <span class="mi">54000</span><span class="p">,</span>
                  <span class="mi">55000</span><span class="p">,</span> <span class="mi">56000</span><span class="p">,</span> <span class="mi">57000</span><span class="p">,</span> <span class="mi">58000</span><span class="p">,</span> <span class="mi">59000</span><span class="p">,</span> <span class="mi">60000</span><span class="p">,</span> <span class="mi">61000</span><span class="p">,</span> <span class="mi">62000</span><span class="p">,</span>
                  <span class="mi">63000</span><span class="p">,</span> <span class="mi">64000</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">46956</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">64538</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="n">gvals_test</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">print</span> <span class="s1">&#39;&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;----------------------------------------&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;Testing for longitude/latitude labelling&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;----------------------------------------&#39;</span>
    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">([</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">120</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;180&#39;</span><span class="p">,</span> <span class="s1">&#39;120W&#39;</span><span class="p">,</span> <span class="s1">&#39;60W&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;60E&#39;</span><span class="p">,</span> <span class="s1">&#39;120E&#39;</span><span class="p">,</span> <span class="s1">&#39;180&#39;</span><span class="p">])</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">180</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">mapaxis_test</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">([</span><span class="mi">150</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">270</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;150E&#39;</span><span class="p">,</span> <span class="s1">&#39;180&#39;</span><span class="p">,</span> <span class="s1">&#39;150W&#39;</span><span class="p">,</span> <span class="s1">&#39;120W&#39;</span><span class="p">,</span> <span class="s1">&#39;90W&#39;</span><span class="p">])</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">135</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">280</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">mapaxis_test</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;10E&#39;</span><span class="p">,</span> <span class="s1">&#39;20E&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;30E&#39;</span><span class="p">,</span> <span class="s1">&#39;40E&#39;</span><span class="p">,</span> <span class="s1">&#39;50E&#39;</span><span class="p">,</span> <span class="s1">&#39;60E&#39;</span><span class="p">,</span> <span class="s1">&#39;70E&#39;</span><span class="p">,</span> <span class="s1">&#39;80E&#39;</span><span class="p">,</span> <span class="s1">&#39;90E&#39;</span><span class="p">])</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mapaxis_test</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">([</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;90S&#39;</span><span class="p">,</span> <span class="s1">&#39;60S&#39;</span><span class="p">,</span> <span class="s1">&#39;30S&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;30N&#39;</span><span class="p">,</span> <span class="s1">&#39;60N&#39;</span><span class="p">,</span> <span class="s1">&#39;90N&#39;</span><span class="p">])</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mapaxis_test</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;5N&#39;</span><span class="p">,</span> <span class="s1">&#39;10N&#39;</span><span class="p">,</span> <span class="s1">&#39;15N&#39;</span><span class="p">,</span> <span class="s1">&#39;20N&#39;</span><span class="p">,</span> <span class="s1">&#39;25N&#39;</span><span class="p">,</span> <span class="s1">&#39;30N&#39;</span><span class="p">])</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mapaxis_test</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">print</span> <span class="s1">&#39;&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;-----------------&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;Testing for plots&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;-----------------&#39;</span>

    <span class="c1"># Run through gallery examples and compare to reference plots</span>

    <span class="c1"># example1</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig1.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">15</span><span class="p">))</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># example2</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig2.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span> <span class="n">blockfill</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># example3</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig3.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=-</span><span class="mi">15</span><span class="p">,</span> <span class="n">lonmax</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">latmin</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span> <span class="n">latmax</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">levs</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">265</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">285</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">15</span><span class="p">))</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># example4</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig4.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;npstere&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">))</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># example5</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig5.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;spstere&#39;</span><span class="p">,</span> <span class="n">boundinglat</span><span class="o">=-</span><span class="mi">30</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">))</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># example6</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig6.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">9</span><span class="p">]</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="c1"># example7</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig7.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">))</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>

    <span class="c1"># example8</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig8.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">),</span> <span class="n">ylog</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>

    <span class="c1"># example9</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig9.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="mf">0.56074494</span><span class="p">))</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

    <span class="c1"># example10</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig10.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)</span>
    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">lines</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># example11</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig11.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)</span>
    <span class="n">gset</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;1960-1-1&#39;</span><span class="p">,</span> <span class="s1">&#39;1980-1-1&#39;</span><span class="p">)</span>
    <span class="n">levs</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">280</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">305</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">lines</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

    <span class="c1"># example12</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig12.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)</span>
    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">lines</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

    <span class="c1"># example13</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig13.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">vect</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">key_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>

    <span class="c1"># example14</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig14.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

    <span class="n">gopen</span><span class="p">()</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">lonmax</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">latmin</span><span class="o">=-</span><span class="mi">30</span><span class="p">,</span> <span class="n">latmax</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">levs</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">254</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">vect</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">key_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">gclose</span><span class="p">()</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>

    <span class="c1"># example15</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig15.png&#39;</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">9</span><span class="p">]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

    <span class="n">mapset</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;npstere&#39;</span><span class="p">)</span>
    <span class="n">vect</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">key_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
         <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Polar plot with regular point distribution&#39;</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># example16</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig16.png&#39;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/vaAMIPlcd_DJF.nc&#39;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">wi</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">wi</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">160</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: mean X: mean&#39;</span><span class="p">)</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/wapAMIPlcd_DJF.nc&#39;</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">wi</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">wi</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">160</span><span class="p">))</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: mean X: mean&#39;</span><span class="p">)</span>

    <span class="n">vect</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="o">=-</span><span class="n">g</span><span class="p">,</span> <span class="n">key_length</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>
         <span class="n">scale</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="n">key_location</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">])</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>

    <span class="c1"># example17</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig17.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">gopen</span><span class="p">()</span>
    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;magma&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">stipple</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">220</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">260</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#00ff00&#39;</span><span class="p">)</span>
    <span class="n">stipple</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">330</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#0000ff&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">gclose</span><span class="p">()</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>

    <span class="c1"># example18</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig18.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">gopen</span><span class="p">()</span>
    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;magma&#39;</span><span class="p">)</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;npstere&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">stipple</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">265</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">295</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#00ff00&#39;</span><span class="p">)</span>
    <span class="n">gclose</span><span class="p">()</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>

    <span class="c1"># example19</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig19.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">gopen</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">gpos</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">gpos</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;moll&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">gpos</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;npstere&#39;</span><span class="p">,</span> <span class="n">boundinglat</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">gpos</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;spstere&#39;</span><span class="p">,</span> <span class="n">boundinglat</span><span class="o">=-</span><span class="mi">30</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span> <span class="n">colorbar_position</span><span class="o">=</span><span class="p">[</span>
        <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">],</span> <span class="n">colorbar_orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
    <span class="n">gclose</span><span class="p">()</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span>

    <span class="c1"># example20</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig20.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/Geostropic_Adjustment.nc&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

    <span class="c1"># example21</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig21.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/Geostropic_Adjustment.nc&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;test data&#39;</span><span class="p">,</span>
        <span class="n">xticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span> <span class="o">+</span> <span class="mi">100000</span><span class="p">,</span>
        <span class="n">yticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2000</span> <span class="o">+</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;x-axis&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;z-axis&#39;</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>

    <span class="c1"># example22</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig22.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/rgp.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>

    <span class="c1"># example23</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig23.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/rgp.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">array</span>
    <span class="n">xvec</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;dim1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span>
    <span class="n">yvec</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s1">&#39;dim0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span>
    <span class="n">xpole</span> <span class="o">=</span> <span class="mi">160</span>
    <span class="n">ypole</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="n">gopen</span><span class="p">()</span>
    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
    <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">))</span>
    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">))</span>
    <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">levs</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">980</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1035</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">rgaxes</span><span class="p">(</span><span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">yvec</span><span class="p">)</span>
    <span class="n">gclose</span><span class="p">()</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>

    <span class="c1"># example24</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig24.png&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">matplotlib.mlab</span> <span class="kn">import</span> <span class="n">griddata</span>

    <span class="c1"># Arrays for data</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pressure</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Read data</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/synop_data.txt&#39;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">mysplit</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">mysplit</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">mysplit</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">mysplit</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">mysplit</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>

    <span class="c1"># Linearly interpolate data to a regular grid</span>
    <span class="n">lons_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">140</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">-</span> <span class="mf">11.0</span>
    <span class="n">lats_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">140</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">49.0</span>
    <span class="n">temp_new</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">lons_new</span><span class="p">,</span> <span class="n">lats_new</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;parula&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lons_new</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">lats_new</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">temp_new</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>

    <span class="c1"># example25</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig25.png&#39;</span><span class="p">)</span>
    <span class="n">gopen</span><span class="p">()</span>
    <span class="n">con</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lons_new</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">lats_new</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">temp_new</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                           <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                           <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

    <span class="n">gclose</span><span class="p">()</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>

    <span class="c1"># example26</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig26.png&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span> <span class="k">as</span> <span class="n">ncfile</span>
    <span class="kn">from</span> <span class="nn">matplotlib.mlab</span> <span class="kn">import</span> <span class="n">griddata</span>

    <span class="c1"># Get an Orca grid and flatten the arrays</span>
    <span class="n">nc</span> <span class="o">=</span> <span class="n">ncfile</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/orca2.nc&#39;</span><span class="p">)</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;sst&#39;</span><span class="p">])</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Add wrap around at both longitude limits</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">150</span><span class="p">))</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lats</span><span class="p">[</span><span class="n">pts</span><span class="p">])</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">temp</span><span class="p">[</span><span class="n">pts</span><span class="p">])</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="p">))</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">-</span> <span class="mi">360</span><span class="p">)</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lats</span><span class="p">[</span><span class="n">pts</span><span class="p">])</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">temp</span><span class="p">[</span><span class="n">pts</span><span class="p">])</span>

    <span class="n">lons_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">181</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span> <span class="o">-</span> <span class="mf">180.0</span>
    <span class="n">lats_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">91</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span> <span class="o">-</span> <span class="mf">90.0</span>
    <span class="n">temp_new</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">lons_new</span><span class="p">,</span> <span class="n">lats_new</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

    <span class="n">con</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lons_new</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">lats_new</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">temp_new</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span>

    <span class="c1"># example27</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig27.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;X: mean&#39;</span><span class="p">)</span>
    <span class="n">lineplot</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
             <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Zonal mean zonal wind at 100mb&#39;</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span>

    <span class="c1"># example28</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig28.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;X: mean&#39;</span><span class="p">)</span>
    <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">75</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>
    <span class="n">xticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;90S&#39;</span><span class="p">,</span> <span class="s1">&#39;75S&#39;</span><span class="p">,</span> <span class="s1">&#39;60S&#39;</span><span class="p">,</span> <span class="s1">&#39;45S&#39;</span><span class="p">,</span> <span class="s1">&#39;30S&#39;</span><span class="p">,</span> <span class="s1">&#39;15S&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;15N&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;30N&#39;</span><span class="p">,</span> <span class="s1">&#39;45N&#39;</span><span class="p">,</span> <span class="s1">&#39;60N&#39;</span><span class="p">,</span> <span class="s1">&#39;75N&#39;</span><span class="p">,</span> <span class="s1">&#39;90N&#39;</span><span class="p">]</span>
    <span class="n">xpts</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">]</span>
    <span class="n">ypts</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">]</span>

    <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">gopen</span><span class="p">()</span>
    <span class="n">lineplot</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
             <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Zonal mean zonal wind&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;100mb&#39;</span><span class="p">)</span>
    <span class="n">lineplot</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">200</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;200mb&#39;</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
             <span class="n">legend_location</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Region of interest&#39;</span><span class="p">,</span>
                       <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">gclose</span><span class="p">()</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span>

    <span class="c1"># example29</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fig29.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">wi</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="s1">&#39;1900-01-01&#39;</span><span class="p">),</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="s1">&#39;1980-01-01&#39;</span><span class="p">)))</span>
    <span class="n">temp_annual</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: mean&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">Y</span><span class="p">())</span>
    <span class="n">temp_annual_global</span> <span class="o">=</span> <span class="n">temp_annual</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;area: mean&#39;</span><span class="p">)</span>
    <span class="n">temp_annual_global</span><span class="o">.</span><span class="n">Units</span> <span class="o">-=</span> <span class="mf">273.15</span>
    <span class="n">lineplot</span><span class="p">(</span>
        <span class="n">temp_annual_global</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Global average annual temperature&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">29</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">compare_images</span><span class="p">(</span><span class="n">example</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Compare images and return an error string if they don&#39;t match</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">hashlib</span>
    <span class="n">disp</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">)</span>
    <span class="n">conv</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="s1">&#39;convert&#39;</span><span class="p">)</span>
    <span class="n">comp</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="s1">&#39;compare&#39;</span><span class="p">)</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="s1">&#39;fig&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">example</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
    <span class="n">file_new</span> <span class="o">=</span> <span class="s1">&#39;/home/swsheaps/cfplot.src/cfplot/&#39;</span> <span class="o">+</span> <span class="nb">file</span>
    <span class="n">file_ref</span> <span class="o">=</span> <span class="s1">&#39;/home/swsheaps/regression/&#39;</span> <span class="o">+</span> <span class="nb">file</span>

    <span class="c1"># Check md5 checksums are the same and display files if not</span>
    <span class="k">if</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">file_new</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">!=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">file_ref</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">():</span>
        <span class="k">print</span> <span class="s1">&#39;***Failed example &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">example</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;**&#39;</span>
        <span class="n">error_image</span> <span class="o">=</span> <span class="s1">&#39;/home/swsheaps/cfplot.src/cfplot/&#39;</span> <span class="o">+</span> <span class="s1">&#39;error_&#39;</span> <span class="o">+</span> <span class="nb">file</span>
        <span class="n">diff_image</span> <span class="o">=</span> <span class="s1">&#39;/home/swsheaps/cfplot.src/cfplot/&#39;</span> <span class="o">+</span> <span class="s1">&#39;difference_&#39;</span> <span class="o">+</span> <span class="nb">file</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">comp</span><span class="p">,</span> <span class="n">file_new</span><span class="p">,</span> <span class="n">file_ref</span><span class="p">,</span> <span class="n">diff_image</span><span class="p">])</span>
        <span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="n">p_status</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">conv</span><span class="p">,</span> <span class="s2">&quot;+append&quot;</span><span class="p">,</span> <span class="n">file_new</span><span class="p">,</span>
                             <span class="n">file_ref</span><span class="p">,</span> <span class="n">error_image</span><span class="p">])</span>
        <span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="n">p_status</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">disp</span><span class="p">,</span> <span class="n">diff_image</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">&#39;Passed example &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">levs_test</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">gvals_test</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                   <span class="n">mapaxis_test</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                   <span class="n">mult</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Compare arrays and return an error string if they don&#39;t match</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">anom</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">levs_test</span><span class="p">:</span>
        <span class="n">levs</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">):</span>
            <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ref</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">val</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">1e-6</span><span class="p">:</span>
                    <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">anom</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;***levs failure***&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;min, max, step are&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">step</span>
            <span class="k">print</span> <span class="s1">&#39;generated levels are:&#39;</span>
            <span class="k">print</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span>
            <span class="k">print</span> <span class="s1">&#39;expected levels:&#39;</span>
            <span class="k">print</span> <span class="n">ref</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pass_str</span> <span class="o">=</span> <span class="s1">&#39;Passed cfp.levs(min=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, max=&#39;</span>
            <span class="n">pass_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, step=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="k">print</span> <span class="n">pass_str</span>

    <span class="n">anom</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">gvals_test</span><span class="p">:</span>
        <span class="n">vals</span><span class="p">,</span> <span class="n">testmult</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
            <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ref</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">-</span> <span class="n">vals</span><span class="p">[</span><span class="n">val</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">1e-6</span><span class="p">:</span>
                    <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">mult</span> <span class="o">!=</span> <span class="n">testmult</span><span class="p">:</span>
            <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">anom</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;***gvals failure***&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;generated values are:&#39;</span><span class="p">,</span> <span class="n">vals</span>
            <span class="k">print</span> <span class="s1">&#39;with a  multiplier of &#39;</span><span class="p">,</span> <span class="n">testmult</span>
            <span class="k">print</span> <span class="s1">&#39;&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;expected values:&#39;</span><span class="p">,</span> <span class="n">ref</span>
            <span class="k">print</span> <span class="s1">&#39;with a  multiplier of &#39;</span><span class="p">,</span> <span class="n">mult</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pass_str</span> <span class="o">=</span> <span class="s1">&#39;Passed cfp.gvals(min=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, max=&#39;</span>
            <span class="n">pass_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="k">print</span> <span class="n">pass_str</span>

    <span class="n">anom</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">mapaxis_test</span><span class="p">:</span>
        <span class="n">ref_ticks</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ref_labels</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">test_ticks</span><span class="p">,</span> <span class="n">test_labels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">max</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">test_ticks</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ref_ticks</span><span class="p">):</span>
            <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ref_ticks</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ref_ticks</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">-</span> <span class="n">test_ticks</span><span class="p">[</span><span class="n">val</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">1e-6</span><span class="p">:</span>
                    <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">ref_labels</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">!=</span> <span class="n">test_labels</span><span class="p">[</span><span class="n">val</span><span class="p">]:</span>
                    <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">anom</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;***mapaxis failure***&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;scfp.mapaxis(min=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, max=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;, type=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;generated values are:&#39;</span><span class="p">,</span> <span class="n">test_ticks</span>
            <span class="k">print</span> <span class="s1">&#39;with labels:&#39;</span><span class="p">,</span> <span class="n">test_labels</span>
            <span class="k">print</span> <span class="s1">&#39;&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;expected ticks:&#39;</span><span class="p">,</span> <span class="n">ref_ticks</span>
            <span class="k">print</span> <span class="s1">&#39;with labels:&#39;</span><span class="p">,</span> <span class="n">ref_labels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pass_str</span> <span class="o">=</span> <span class="s1">&#39;Passed cfp.mapaxis(min=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, max=&#39;</span>
            <span class="n">pass_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, type=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="k">print</span> <span class="n">pass_str</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">

<h3><a href="http://ajheaps.github.io/cf-plot/#">Homepage</a><p></h3>
<h5><a href="http://ajheaps.github.io/cf-plot/gallery.html">Gallery</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/user_guide.html">User Guide</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/data.html">Data input</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/routines.html">Routines</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/internal_routines.html">Routines - internal</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/advanced.html">Advanced Use</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/versions.html">Versions</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/issues.html">Issues</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/download.html">Download/Install</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/license.html">License</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/search.html">Search</a><p></h5>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">cf-plot 2.1.12 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Andy Heaps.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>